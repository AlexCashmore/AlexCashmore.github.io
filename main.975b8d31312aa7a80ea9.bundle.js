(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1275:function(module,exports,__webpack_require__){"use strict";var _clientApi=__webpack_require__(83),_clientLogger=__webpack_require__(51),_configFilename=__webpack_require__(1276);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(_configFilename.args||_configFilename.argTypes)&&_clientLogger.logger.warn("Invalid args/argTypes in config, ignoring.",JSON.stringify({args:_configFilename.args,argTypes:_configFilename.argTypes})),_configFilename.decorators&&_configFilename.decorators.forEach((function(decorator){return(0,_clientApi.addDecorator)(decorator,!1)})),_configFilename.loaders&&_configFilename.loaders.forEach((function(loader){return(0,_clientApi.addLoader)(loader,!1)})),(_configFilename.parameters||_configFilename.globals||_configFilename.globalTypes)&&(0,_clientApi.addParameters)(_objectSpread(_objectSpread({},_configFilename.parameters),{},{globals:_configFilename.globals,globalTypes:_configFilename.globalTypes}),!1),_configFilename.argTypesEnhancers&&_configFilename.argTypesEnhancers.forEach((function(enhancer){return(0,_clientApi.addArgTypesEnhancer)(enhancer)}))},1276:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"parameters",(function(){return parameters}));var parameters={actions:{argTypesRegex:"^on[A-Z].*"}}},1277:function(module,exports,__webpack_require__){"use strict";(function(module){(0,__webpack_require__(317).configure)([__webpack_require__(1278),__webpack_require__(1288)],module,!1)}).call(this,__webpack_require__(70)(module))},1278:function(module,exports,__webpack_require__){var map={"./components/storybook/Components.stories.mdx":1279};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=1278},1279:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"__page",(function(){return __page}));__webpack_require__(0);var _mdx_js_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(109),_storybook_addon_docs_blocks__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(279);__webpack_require__(1280),__webpack_require__(1281),__webpack_require__(1282),__webpack_require__(1283),__webpack_require__(1284),__webpack_require__(1285),__webpack_require__(1286),__webpack_require__(1287);function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}const layoutProps={};function MDXContent({components:components,...props}){return Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.mdx)("wrapper",_extends({},layoutProps,props,{components:components,mdxType:"MDXLayout"}),Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.mdx)(_storybook_addon_docs_blocks__WEBPACK_IMPORTED_MODULE_2__.Meta,{title:"Advisory Portal/Components",mdxType:"Meta"}),Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.mdx)("style",null,"\n  .subheading {\n    --mediumdark: '#999999';\n    font-weight: 900;\n    font-size: 13px;\n    color: #999;\n    letter-spacing: 6px;\n    line-height: 24px;\n    text-transform: uppercase;\n    margin-bottom: 12px;\n    margin-top: 40px;\n  }\n\n  .link-list {\n    display: grid;\n    grid-template-columns: 1fr;\n    grid-template-rows: 1fr 1fr;\n    row-gap: 10px;\n  }\n\n  @media (min-width: 620px) {\n    .link-list {\n      row-gap: 20px;\n      column-gap: 20px;\n      grid-template-columns: 1fr 1fr;\n    }\n  }\n\n  @media all and (-ms-high-contrast:none) {\n  .link-list {\n      display: -ms-grid;\n      -ms-grid-columns: 1fr 1fr;\n      -ms-grid-rows: 1fr 1fr;\n    }\n  }\n\n  .link-item {\n    display: block;\n    padding: 20px 30px 20px 15px;\n    border: 1px solid #00000010;\n    border-radius: 5px;\n    transition: background 150ms ease-out, border 150ms ease-out, transform 150ms ease-out;\n    color: #333333;\n    display: flex;\n    align-items: flex-start;\n  }\n\n  .link-item:hover {\n    border-color: #1EA7FD50;\n    transform: translate3d(0, -3px, 0);\n    box-shadow: rgba(0, 0, 0, 0.08) 0 3px 10px 0;\n  }\n\n  .link-item:active {\n    border-color: #1EA7FD;\n    transform: translate3d(0, 0, 0);\n  }\n\n  .link-item strong {\n    font-weight: 700;\n    display: block;\n    margin-bottom: 2px;\n  }\n  \n  .link-item img {\n    height: 40px;\n    width: 40px;\n    margin-right: 15px;\n    flex: none;\n  }\n\n  .link-item span {\n    font-size: 14px;\n    line-height: 20px;\n  }\n\n  .tip {\n    display: inline-block;\n    border-radius: 1em;\n    font-size: 11px;\n    line-height: 12px;\n    font-weight: 700;\n    background: #E7FDD8;\n    color: #66BF3C;\n    padding: 4px 12px;\n    margin-right: 10px;\n    vertical-align: top;\n  }\n\n  .tip-wrapper {\n    font-size: 13px;\n    line-height: 20px;\n    margin-top: 40px;\n    margin-bottom: 40px;\n  }\n\n  .tip-wrapper code {\n    font-size: 12px;\n    display: inline-block;\n  }\n\n  \n"),Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.mdx)("h1",{id:"welcome-to-the-aider-advisory-portal-storybook"},"Welcome to the Aider Advisory Portal Storybook"))}MDXContent.isMDXComponent=!0;const __page=()=>{throw new Error("Docs-only story")};__page.parameters={docsOnly:!0};const componentMeta={title:"Advisory Portal/Components",includeStories:["__page"]},mdxStoryNameToKey={};componentMeta.parameters=componentMeta.parameters||{},componentMeta.parameters.docs={...componentMeta.parameters.docs||{},page:()=>Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.mdx)(_storybook_addon_docs_blocks__WEBPACK_IMPORTED_MODULE_2__.AddContext,{mdxStoryNameToKey:mdxStoryNameToKey,mdxComponentMeta:componentMeta},Object(_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__.mdx)(MDXContent,null))},__webpack_exports__.default=componentMeta},1280:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/code-brackets.d43eb968.svg"},1281:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/colors.8104e6f5.svg"},1282:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/comments.3f9a1398.svg"},1283:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/direction.d3dc567b.svg"},1284:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/flow.e3812c4f.svg"},1285:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/plugin.5ba97e9b.svg"},1286:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/repo.3452b916.svg"},1287:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/stackalt.66f4b748.svg"},1288:function(module,exports,__webpack_require__){var map={"./components/storybook/Button.stories.js":1289,"./components/storybook/Header.stories.js":1486};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=1288},1289:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"ButtonStory",(function(){return ButtonStory}));var C_Users_Alex_WebstormProjects_advisory_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(80),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__),_button__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(280),storybook_addon_designs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(281);__webpack_exports__.default={title:"Button",component:_button__WEBPACK_IMPORTED_MODULE_2__.a,decorators:[storybook_addon_designs__WEBPACK_IMPORTED_MODULE_3__.a]};var ButtonStory=function ButtonStory(){return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_button__WEBPACK_IMPORTED_MODULE_2__.a,null,"Action Button")};ButtonStory.parameters={design:{type:"figma",url:"https://www.figma.com/file/Lh4m51A56pHUS6hzIhb0yr/Advisor-Portal-(v3)?node-id=0%3A1155"}},ButtonStory.parameters=Object(C_Users_Alex_WebstormProjects_advisory_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__.a)({storySource:{source:"() => <Button>Action Button</Button>"}},ButtonStory.parameters),ButtonStory.__docgenInfo={description:"",methods:[],displayName:"ButtonStory"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\components\\storybook\\Button.stories.js"]={name:"ButtonStory",docgenInfo:ButtonStory.__docgenInfo,path:"src\\components\\storybook\\Button.stories.js"})},1290:function(module,exports,__webpack_require__){},1291:function(module,exports,__webpack_require__){},1354:function(module,exports){},1356:function(module,exports){},1366:function(module,exports){},1368:function(module,exports){},1396:function(module,exports){},1398:function(module,exports){},1399:function(module,exports){},1404:function(module,exports){},1406:function(module,exports){},1412:function(module,exports){},1414:function(module,exports){},1433:function(module,exports){},1445:function(module,exports){},1448:function(module,exports){},1486:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"LoggedIn",(function(){return Header_stories_LoggedIn})),__webpack_require__.d(__webpack_exports__,"LoggedOut",(function(){return Header_stories_LoggedOut}));var _dec,_dec2,_dec3,_dec4,_dec5,_dec6,_dec7,_dec8,_dec9,_dec10,_dec11,_dec12,_dec13,_dec14,_dec15,_dec16,_dec17,_dec18,_dec19,_dec20,_dec21,_dec22,_dec23,_dec24,_dec25,_dec26,_dec27,_dec28,_dec29,_dec30,_dec31,_dec32,_dec33,_dec34,_dec35,_dec36,_dec37,_dec38,_dec39,_dec40,_dec41,_dec42,_dec43,_dec44,_dec45,_dec46,_dec47,_dec48,_dec49,_dec50,_class,_descriptor,_descriptor2,_descriptor3,_descriptor4,_descriptor5,_descriptor6,_descriptor7,_descriptor8,_descriptor9,_descriptor10,_descriptor11,_descriptor12,_descriptor13,_descriptor14,_descriptor15,_descriptor16,_descriptor17,_descriptor18,_descriptor19,_descriptor20,_descriptor21,_descriptor22,_descriptor23,_descriptor24,_descriptor25,_descriptor26,_descriptor27,_descriptor28,_descriptor29,_descriptor30,_descriptor31,_descriptor32,_descriptor33,_descriptor34,_descriptor35,_descriptor36,_descriptor37,_descriptor38,_descriptor39,_descriptor40,_descriptor41,_descriptor42,_descriptor43,_descriptor44,conversationStore_dec,conversationStore_dec2,conversationStore_dec3,conversationStore_dec4,conversationStore_dec5,conversationStore_dec6,conversationStore_dec7,conversationStore_dec8,conversationStore_dec9,conversationStore_dec10,conversationStore_dec11,conversationStore_dec12,conversationStore_dec13,conversationStore_dec14,conversationStore_dec15,conversationStore_dec16,conversationStore_dec17,conversationStore_dec18,conversationStore_dec19,conversationStore_class,conversationStore_descriptor,conversationStore_descriptor2,conversationStore_descriptor3,conversationStore_descriptor4,conversationStore_descriptor5,conversationStore_descriptor6,conversationStore_descriptor7,conversationStore_descriptor8,conversationStore_descriptor9,conversationStore_descriptor10,conversationStore_descriptor11,conversationStore_descriptor12,conversationStore_descriptor13,conversationStore_descriptor14,conversationStore_descriptor15,conversationStore_descriptor16,objectSpread2=__webpack_require__(80),react=__webpack_require__(0),react_default=__webpack_require__.n(react),classCallCheck=__webpack_require__(45),createClass=__webpack_require__(46),inherits=__webpack_require__(184),createSuper=__webpack_require__(183),lib=__webpack_require__(75),mobxreact_esm=__webpack_require__(182),logo=__webpack_require__(283),logo_default=__webpack_require__.n(logo),initializerDefineProperty=__webpack_require__(7),applyDecoratedDescriptor=__webpack_require__(3),mobx_module=(__webpack_require__(214),__webpack_require__(1)),toConsumableArray=__webpack_require__(284),regenerator=__webpack_require__(2),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=__webpack_require__(6),js_cookie=__webpack_require__(11),js_cookie_default=__webpack_require__.n(js_cookie),firestorter_module=__webpack_require__(181),axios=__webpack_require__(23),axios_default=__webpack_require__.n(axios),esm=__webpack_require__(1502),qs_lib=__webpack_require__(42),qs_lib_default=__webpack_require__.n(qs_lib),jsonReponse=function jsonReponse(response){return response.text().then((function(text){return text?JSON.parse(text):{}}))},network_makeApiRequest=function makeApiRequest(url,method){var headers=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},body=arguments.length>3?arguments[3]:void 0,request={method:method,headers:Object(objectSpread2.a)({"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"},headers)};return body&&(request.body=body),fetch(url,request).then(function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(response){var jsonData,error;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,jsonReponse(response);case 2:if(jsonData=_context.sent,!response.ok){_context.next=5;break}return _context.abrupt("return",jsonData);case 5:return error={},error=jsonData._embedded&&jsonData._embedded.error?jsonData._embedded.error:jsonData,_context.abrupt("return",Promise.reject(error));case 8:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}()).catch((function(e){console.log("post error:",e),"Cannot read property 'conversation' of undefined"===e.message&&Store_rootStore.conversationStore.setResponseLoading(!1)}))},makeGetRequest=function makeGetRequest(url,headers){return network_makeApiRequest(url,"GET",headers)},makePostRequest=function makePostRequest(url,headers,body){return network_makeApiRequest(url,"POST",headers,body)},updateTokensExpiry=function updateTokensExpiry(tokens){try{return tokens.expiresAt=Math.floor(Date.now()/1e3)+900,tokens}catch(e){return tokens.expiresAt=Math.floor(Date.now()/1e3)+900,tokens}},network_updateTokensExpiryVerbose=function updateTokensExpiryVerbose(tokens){try{return tokens.expiresAt=Math.floor(Date.now()/1e3)+900,tokens}catch(e){return esm.a(e),tokens.expiresAt=Math.floor(Date.now()/1e3)+900,tokens}},initializeBackendTokens=function(){var _ref3=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(apiLinks,idToken){var headers,body,backendTokens,access_token,refresh_token,id_token;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token"},_context3.prev=2,_context3.next=5,makePostRequest(apiLinks.tokens.href,headers,qs_lib_default.a.stringify(body)).then(updateTokensExpiry);case 5:return backendTokens=_context3.sent,js_cookie_default.a.set("backendTokens",backendTokens,{domain:"http://localhost:3000"}),access_token=backendTokens.access_token,refresh_token=backendTokens.refresh_token,id_token=backendTokens.id_token,_context3.abrupt("return",{access_token:access_token,refresh_token:refresh_token,id_token:id_token});case 11:_context3.prev=11,_context3.t0=_context3.catch(2);case 13:case"end":return _context3.stop()}}),_callee3,null,[[2,11]])})));return function initializeBackendTokens(_x4,_x5){return _ref3.apply(this,arguments)}}(),initializeNewBusinessBackendTokens=function(){var _ref4=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(apiLinks,idToken,businessId,authStore){var headers,body,backendTokens,access_token,refresh_token,id_token,expiresAt;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",resource:"".concat(apiLinks.businesses.href,"/").concat(businessId)},_context4.next=4,makePostRequest(apiLinks.tokens.href,headers,qs_lib_default.a.stringify(body)).then(updateTokensExpiry);case 4:return backendTokens=_context4.sent,authStore.registerNewBusinessToken(backendTokens,businessId),access_token=backendTokens.access_token,refresh_token=backendTokens.refresh_token,id_token=backendTokens.id_token,expiresAt=backendTokens.expiresAt,_context4.abrupt("return",{access_token:access_token,refresh_token:refresh_token,id_token:id_token,expiresAt:expiresAt});case 8:case"end":return _context4.stop()}}),_callee4)})));return function initializeNewBusinessBackendTokens(_x6,_x7,_x8,_x9){return _ref4.apply(this,arguments)}}(),initializeNewXeroBusinessBackendTokens=function(){var _ref5=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee5(apiLinks,idToken,businessId,authStore){var headers,body,backendTokens,access_token,refresh_token,id_token,expiresAt;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",resource:"".concat(apiLinks.businesses.href,"/").concat(businessId)},_context5.prev=2,_context5.next=5,makePostRequest(apiLinks.tokens.href,headers,qs_lib_default.a.stringify(body));case 5:return backendTokens=_context5.sent,access_token=backendTokens.access_token,refresh_token=backendTokens.refresh_token,id_token=backendTokens.id_token,expiresAt=backendTokens.expiresAt,_context5.abrupt("return",{access_token:access_token,refresh_token:refresh_token,id_token:id_token,expiresAt:expiresAt});case 10:_context5.prev=10,_context5.t0=_context5.catch(2),console.log("error initializing tokens for new xero business,",_context5.t0);case 13:case"end":return _context5.stop()}}),_callee5,null,[[2,10]])})));return function initializeNewXeroBusinessBackendTokens(_x10,_x11,_x12,_x13){return _ref5.apply(this,arguments)}}(),refreshTokensVerbose=function(){var _ref6=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee6(apiLinks,tokens){var backendTokens,headers,body,refreshedTokens;return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return backendTokens=tokens,headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},body={grant_type:"refresh_token",refresh_token:backendTokens.refresh_token},_context6.next=5,makePostRequest(apiLinks.tokens.href,headers,qs_lib_default.a.stringify(body)).then((function(tokens){return network_updateTokensExpiryVerbose(tokens)}));case 5:return refreshedTokens=_context6.sent,_context6.abrupt("return",refreshedTokens);case 7:case"end":return _context6.stop()}}),_callee6)})));return function refreshTokensVerbose(_x14,_x15){return _ref6.apply(this,arguments)}}(),refreshTokens=function(){var _ref7=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee7(apiLinks){var store,backendTokens,headers,body,refreshedTokens;return regenerator_default.a.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(store=Store_rootStore.authStore,backendTokens={access_token:store.access_token,id_token:store.id_token,refresh_token:store.refresh_token},headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},body={grant_type:"refresh_token",refresh_token:backendTokens.refresh_token},!(Math.floor(Date.now()/1e3)+Object({NODE_ENV:"production",NODE_PATH:"",STORYBOOK:"true",PUBLIC_URL:".",REACT_APP_ROOT_ENDPOINT:"https://aider-ai-staging.appspot.com/api/v1/root",REACT_APP_AIDER_ENDPOINT:"https://aider-ai-staging.appspot.com/api/v1",REACT_APP_AIDER_DOMAIN:"https://aider-ai-staging.appspot.com",REACT_APP_PROXY_URL:"https://stark-depths-98247.herokuapp.com/",REACT_APP_PROXY_FALLBACK_URL:"https://cors-anywhere.herokuapp.com/",REACT_APP_SENTRY_URL:"https://7702057da9e44ff2a35a95e083a2027b@o412220.ingest.sentry.io",REACT_APP_SENTRY_KEY:"5288846",REACT_APP_TAG_MANAGER_ID:"GTM-KTP3SV4",REACT_APP_API_KEY:"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z",REACT_APP_COOKIE_DOMAIN:"http://localhost:3000",REACT_APP_COOKIE_EXPIRE_DAYS:"365",REACT_APP_BACKEND_TOKENS_COOKIE_NAME:"backendTokens",REACT_APP_BACKEND_TOKENS_EXPIRATION_OFFSET_SECONDS:"30",REACT_APP_SSO_REDIRECT_URL:"http://localhost:3000",REACT_APP_CONNECTION_SERVICE_ENDPOINT:"https://connections-service-dot-aider-ai-staging.appspot.com/api/v1",TAG_MANAGER_ID:"GTM-KTP3SV4",REACT_APP_VERSION:"1.1.0",REACT_APP_STRIPE_KEY:"pk_test_3TUly61sc2UePfoXNYNO7ixD"}).BACKEND_TOKENS_EXPIRATION_OFFSET_SECONDS>=backendTokens.expiresAt)){_context7.next=11;break}return _context7.next=8,makePostRequest(apiLinks.tokens.href,headers,qs_lib_default.a.stringify(body)).then(updateTokensExpiry);case 8:return refreshedTokens=_context7.sent,js_cookie_default.a.set("backendTokens",refreshedTokens,{domain:"http://localhost:3000"}),_context7.abrupt("return",refreshedTokens);case 11:return _context7.abrupt("return",backendTokens);case 12:case"end":return _context7.stop()}}),_callee7)})));return function refreshTokens(_x16){return _ref7.apply(this,arguments)}}(),apiHelper_jsonReponse=(__webpack_require__(1349),function jsonReponse(response){return response.text().then((function(text){return text?JSON.parse(text):{}}))}),apiHelper_makeApiRequest=function makeApiRequest(url,method){var headers=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},body=arguments.length>3?arguments[3]:void 0,request={method:method,headers:Object(objectSpread2.a)({"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"},headers)};return body&&(request.body=body),fetch(url,request).then(function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(response){var jsonData,error;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,apiHelper_jsonReponse(response);case 2:if(jsonData=_context.sent,!response.ok){_context.next=5;break}return _context.abrupt("return",jsonData);case 5:return error={},error=jsonData._embedded&&jsonData._embedded.error?jsonData._embedded.error:jsonData,_context.abrupt("return",Promise.reject(error));case 8:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}())},apiHelper_makeGetRequest=function makeGetRequest(url,headers){return apiHelper_makeApiRequest(url,"GET",headers)},apiHelper_makeHeadRequest=function makeHeadRequest(url,headers){return apiHelper_makeApiRequest(url,"HEAD",headers)},apiHelper_makePostRequest=function makePostRequest(url,headers,body){return apiHelper_makeApiRequest(url,"POST",headers,body)},makeDeleteRequest=function makeDeleteRequest(url,headers,body){return apiHelper_makeApiRequest(url,"DELETE",headers,body)},makePutRequest=function makePutRequest(url,headers){return apiHelper_makeApiRequest(url,"PUT",headers)},signUpUsingXero=(__webpack_require__(668),function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(apiLinks){var url,response,resultUrl;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return"http://localhost:3000",url="".concat(apiLinks.singleSignOn.href.replace("{ospKey}","xero").replace("{appKey}","accounting"),"?redirectUrl=").concat(encodeURIComponent("http://localhost:3000")),_context.next=4,apiHelper_makePostRequest(url);case 4:response=_context.sent,resultUrl=response._embedded.sso._links.redirect.href,window.location.href=resultUrl;case 7:case"end":return _context.stop()}}),_callee)})));return function signUpUsingXero(_x){return _ref.apply(this,arguments)}}()),createConnection=function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(apiLinks,access_token){var url,response,resultUrl;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return"http://localhost:3000",url="".concat("https://connections-service-dot-aider-ai-staging.appspot.com/api/v1","/connections/osp/xero/app/accounting?connectionType=managed&redirectUrl=").concat(encodeURIComponent("http://localhost:3000")),_context2.next=4,apiHelper_makePostRequest(url,{Authorization:"Bearer ".concat(access_token)}).catch((function(e){return console.log("create connection error:",e),e}));case 4:if(response=_context2.sent,_context2.prev=5,!(response&&response._embedded&&response._embedded.connection)){_context2.next=11;break}return resultUrl=response._embedded.connection._links.redirect.href,_context2.abrupt("return",window.location.href=resultUrl);case 11:return _context2.abrupt("return",response);case 12:_context2.next=17;break;case 14:return _context2.prev=14,_context2.t0=_context2.catch(5),_context2.abrupt("return",response);case 17:case"end":return _context2.stop()}}),_callee2,null,[[5,14]])})));return function createConnection(_x2,_x3){return _ref2.apply(this,arguments)}}(),reconnectConnection=function(){var _ref3=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(apiLinks,access_token,businessId){var url,response,resultUrl;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return console.log(".rc"),Store_rootStore.authStore.setTakeMeToXero(!1),js_cookie_default.a.set("skipCreation","true"),url="".concat("https://connections-service-dot-aider-ai-staging.appspot.com/api/v1","/connections/osp/xero/app/accounting?connectionType=managed&managedFor=").concat(businessId,"&redirectUrl=").concat(encodeURIComponent("http://localhost:3000")),_context3.next=6,apiHelper_makePostRequest(url,{Authorization:"Bearer ".concat(access_token)}).catch((function(e){console.log("create connection error:",e)}));case 6:return response=_context3.sent,_context3.prev=7,resultUrl=response._embedded.connection._links.redirect.href,_context3.abrupt("return",window.location.href=resultUrl);case 12:_context3.prev=12,_context3.t0=_context3.catch(7),console.log("no response",response);case 15:case"end":return _context3.stop()}}),_callee3,null,[[7,12]])})));return function reconnectConnection(_x4,_x5,_x6){return _ref3.apply(this,arguments)}}(),deleteConnection=function(){var _ref4=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee5(tokens,disconnectionUrl,fallbackBusinessTokens){var url,response;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return console.log(disconnectionUrl),"http://localhost:3000",url="".concat(disconnectionUrl.replace("http://","https://")),_context5.next=5,makeDeleteRequest(url,{Authorization:"Bearer ".concat(tokens.access_token)}).catch(function(){var _ref5=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(e){return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return console.log("practice fallback",e),_context4.next=3,makeDeleteRequest(url,{Authorization:"Bearer ".concat(fallbackBusinessTokens.access_token)}).catch((function(e){console.log("error status with business tokens:",e)}));case 3:return _context4.abrupt("return",_context4.sent);case 4:case"end":return _context4.stop()}}),_callee4)})));return function(_x10){return _ref5.apply(this,arguments)}}());case 5:return response=_context5.sent,_context5.prev=6,_context5.abrupt("return",response);case 10:_context5.prev=10,_context5.t0=_context5.catch(6),console.log("no response",response);case 13:case"end":return _context5.stop()}}),_callee5,null,[[6,10]])})));return function deleteConnection(_x7,_x8,_x9){return _ref4.apply(this,arguments)}}(),checkConnection=function(){var _ref6=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee6(apiLinks,access_token,connectionId){var url,response;return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return url="".concat("https://connections-service-dot-aider-ai-staging.appspot.com/api/v1","/connections/").concat(encodeURIComponent(connectionId)),_context6.next=3,apiHelper_makeGetRequest(url,{Authorization:"Bearer ".concat(access_token)}).catch((function(e){if(console.log("check connection err",e),"INSUFFICIENT_PERMISSIONS"===e.code)return js_cookie_default.a.set("reconnectedConnection","Duplicate Business"),window.location.href="http://localhost:3000"}));case 3:if(response=_context6.sent,console.log("check conn. ",response),!(null===response||response&&null===response._embedded.connection)){_context6.next=10;break}return console.log("..."),_context6.abrupt("return",Promise.reject("Connection not found"));case 10:return _context6.abrupt("return",response);case 11:case"end":return _context6.stop()}}),_callee6)})));return function checkConnection(_x11,_x12,_x13){return _ref6.apply(this,arguments)}}(),getConnections=function(){var _ref7=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee7(apiLinks,access_token){var url,response;return regenerator_default.a.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return url="".concat("https://connections-service-dot-aider-ai-staging.appspot.com/api/v1","/connections/"),_context7.next=3,apiHelper_makeGetRequest(url,{Authorization:"Bearer ".concat(access_token)}).catch((function(e){console.log("check connection err",e)}));case 3:return response=_context7.sent,_context7.abrupt("return",response);case 5:case"end":return _context7.stop()}}),_callee7)})));return function getConnections(_x14,_x15){return _ref7.apply(this,arguments)}}(),checkConnectionConfiguration=function(){var _ref8=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee8(apiLinks,access_token,connectionId){var url,response;return regenerator_default.a.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return url="".concat("https://connections-service-dot-aider-ai-staging.appspot.com/api/v1","/connections/").concat(encodeURIComponent(connectionId),"/configuration"),_context8.next=3,apiHelper_makeGetRequest(url,{Authorization:"Bearer ".concat(access_token)}).catch((function(e){console.log("check connection err",e)}));case 3:return response=_context8.sent,_context8.abrupt("return",response);case 5:case"end":return _context8.stop()}}),_callee8)})));return function checkConnectionConfiguration(_x16,_x17,_x18){return _ref8.apply(this,arguments)}}(),claimConnection=function(){var _ref9=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee10(apiLinks,access_token,connectionId){return regenerator_default.a.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.abrupt("return",checkConnection(apiLinks,access_token,connectionId).then(function(){var _ref10=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee9(res){var _res$_embedded$connec,status,reason,url,response;return regenerator_default.a.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(_res$_embedded$connec=res._embedded.connection,status=_res$_embedded$connec.status,reason=_res$_embedded$connec.reason,"standby"!==status||"claim_pending"!==reason){_context9.next=7;break}return url="".concat("https://connections-service-dot-aider-ai-staging.appspot.com/api/v1","/connections/").concat(encodeURIComponent(connectionId),"/claim"),_context9.next=5,makePutRequest(url,{Authorization:"Bearer ".concat(access_token)}).catch((function(e){console.log("claim connection err",e)}));case 5:return response=_context9.sent,_context9.abrupt("return",response);case 7:return _context9.abrupt("return",res);case 8:case"end":return _context9.stop()}}),_callee9)})));return function(_x22){return _ref10.apply(this,arguments)}}()));case 1:case"end":return _context10.stop()}}),_callee10)})));return function claimConnection(_x19,_x20,_x21){return _ref9.apply(this,arguments)}}(),jsonwebtoken=__webpack_require__(180),jsonwebtoken_default=__webpack_require__.n(jsonwebtoken),acquisitionHelper_options={domain:"http://localhost:3000",expires:parseInt("365")},acquisitionHelper_getAcquisitionData=function getAcquisitionData(){var query=qs_lib_default.a.parse((window.location.search||"").replace("?","")),getParameterValue=function getParameterValue(name){var value=query[name];return value?js_cookie_default.a.set(name,value,acquisitionHelper_options):value=js_cookie_default.a.get(name),value||null};return{acquisition:{utmSource:getParameterValue("utm_source"),utmMedium:getParameterValue("utm_medium"),utmCampaign:getParameterValue("utm_campaign"),utmTerm:getParameterValue("utm_term"),utmContent:getParameterValue("utm_content")},cat:getParameterValue("cat"),partnerToken:getParameterValue("token")}},backendTokenHelper_updateTokensExpiry=function updateTokensExpiry(tokens){return tokens.expiresAt=Math.floor(Date.now()/1e3)+tokens.expires_in,tokens},backendTokenHelper_refreshTokens=function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(apiLinks){var store,backendTokens,headers,body,refreshedTokens;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(store=Store_rootStore.authStore,backendTokens={access_token:store.access_token,id_token:store.id_token,refresh_token:store.refresh_token},headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"))},body={grant_type:"refresh_token",refresh_token:backendTokens.refresh_token},!(Math.floor(Date.now()/1e3)+Object({NODE_ENV:"production",NODE_PATH:"",STORYBOOK:"true",PUBLIC_URL:".",REACT_APP_ROOT_ENDPOINT:"https://aider-ai-staging.appspot.com/api/v1/root",REACT_APP_AIDER_ENDPOINT:"https://aider-ai-staging.appspot.com/api/v1",REACT_APP_AIDER_DOMAIN:"https://aider-ai-staging.appspot.com",REACT_APP_PROXY_URL:"https://stark-depths-98247.herokuapp.com/",REACT_APP_PROXY_FALLBACK_URL:"https://cors-anywhere.herokuapp.com/",REACT_APP_SENTRY_URL:"https://7702057da9e44ff2a35a95e083a2027b@o412220.ingest.sentry.io",REACT_APP_SENTRY_KEY:"5288846",REACT_APP_TAG_MANAGER_ID:"GTM-KTP3SV4",REACT_APP_API_KEY:"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z",REACT_APP_COOKIE_DOMAIN:"http://localhost:3000",REACT_APP_COOKIE_EXPIRE_DAYS:"365",REACT_APP_BACKEND_TOKENS_COOKIE_NAME:"backendTokens",REACT_APP_BACKEND_TOKENS_EXPIRATION_OFFSET_SECONDS:"30",REACT_APP_SSO_REDIRECT_URL:"http://localhost:3000",REACT_APP_CONNECTION_SERVICE_ENDPOINT:"https://connections-service-dot-aider-ai-staging.appspot.com/api/v1",TAG_MANAGER_ID:"GTM-KTP3SV4",REACT_APP_VERSION:"1.1.0",REACT_APP_STRIPE_KEY:"pk_test_3TUly61sc2UePfoXNYNO7ixD"}).BACKEND_TOKENS_EXPIRATION_OFFSET_SECONDS>=backendTokens.expiresAt)){_context2.next=11;break}return _context2.next=8,apiHelper_makePostRequest(apiLinks.tokens.href,headers,qs_lib_default.a.stringify(body)).then(backendTokenHelper_updateTokensExpiry);case 8:return refreshedTokens=_context2.sent,js_cookie_default.a.set("backendTokens",refreshedTokens,{domain:"http://localhost:3000"}),_context2.abrupt("return",refreshedTokens);case 11:return _context2.abrupt("return",backendTokens);case 12:case"end":return _context2.stop()}}),_callee2)})));return function refreshTokens(_x3){return _ref2.apply(this,arguments)}}(),userDataHelper_addUserWithXero=function addUserWithXero(user,apiLinks,partnerCustomerTokenInRedirectURL){console.log("creating user X:",partnerCustomerTokenInRedirectURL,user.uid);acquisitionHelper_getAcquisitionData().acquisition;var utm=JSON.parse(js_cookie_default.a.get("utm")),body=JSON.stringify({_embedded:{user:{providerUserId:user.uid,acquisition:utm,partnerToken:partnerCustomerTokenInRedirectURL}}});return apiHelper_makePostRequest(apiLinks.users.href,{"Content-Type":"application/hal+json"},body)},userDataHelper_addUser=function addUser(authResult,apiLinks,isInvitation,partnerCustomerTokenInRedirectURL,fields,providerType){if(authResult&&authResult.user&&partnerCustomerTokenInRedirectURL){acquisitionHelper_getAcquisitionData().acquisition;var utm=JSON.parse(js_cookie_default.a.get("utm")),body=JSON.stringify({_embedded:{user:{providerUserId:authResult.uid,acquisition:utm,partnerToken:partnerCustomerTokenInRedirectURL}}});return apiHelper_makePostRequest(apiLinks.users.href,{"Content-Type":"application/hal+json"},body)}if(authResult&&authResult.user){var givenName=null,familyName=null,gender=null,providerId=null,idToken=null,authDomain=authResult.user.authDomain||authResult.user.w;authResult.user.providerData&&authResult.user.providerData.length>0&&authResult.user.providerData[0].providerId&&(providerId=authResult.user.providerData[0].providerId),authResult.credential&&(authResult.credential.providerId&&(providerId=providerId||authResult.credential.providerId),authResult.credential.idToken&&(idToken=authResult.credential.idToken)),authResult.additionalUserInfo&&(authResult.additionalUserInfo.providerId&&(providerId=providerId||authResult.additionalUserInfo.providerId),authResult.additionalUserInfo.profile&&(authResult.additionalUserInfo.profile.given_name&&(givenName=authResult.additionalUserInfo.profile.given_name),authResult.additionalUserInfo.profile.first_name&&(givenName=authResult.additionalUserInfo.profile.first_name),authResult.additionalUserInfo.profile.family_name&&(familyName=authResult.additionalUserInfo.profile.family_name),authResult.additionalUserInfo.profile.last_name&&(familyName=authResult.additionalUserInfo.profile.last_name),authResult.additionalUserInfo.profile.gender&&(gender=authResult.additionalUserInfo.profile.gender)));var phoneNumber=authResult.user.phoneNumber;if(authResult.emailSignUp){if(console.log("email signup"),!(authResult.emailSignUp.firstName&&authResult.emailSignUp.lastName&&authResult.emailSignUp.phoneNumber))return console.log("empty"),Promise.reject("Cannot create user from empty auth result.");console.log("valid"),givenName=authResult.emailSignUp.firstName,familyName=authResult.emailSignUp.lastName,phoneNumber=authResult.emailSignUp.phoneNumber}authResult.user.displayName||[givenName,familyName].filter((function(name){return name})).join(" ").trim();var _getAcquisitionData3=acquisitionHelper_getAcquisitionData(),_acquisition=_getAcquisitionData3.acquisition,partnerToken=_getAcquisitionData3.partnerToken;console.log("other");var _body=JSON.stringify({_embedded:{user:{providerUserId:authResult.user.uid,givenName:fields?fields.firstName:givenName,familyName:fields?fields.lastName:familyName,displayName:fields?"".concat(fields.firstName," ").concat(fields.lastName):"".concat(givenName," ").concat(familyName),photoUrl:authResult.user.photoURL,email:authResult.user.email,emailVerified:authResult.user.emailVerified,phoneNumber:phoneNumber||fields.phone,gender:gender,idToken:idToken,providerId:"password"===providerType?providerType:providerId,authDomain:authDomain,extras:authResult.additionalUserInfo||null,acquisition:_acquisition,partnerToken:null,invitationToken:isInvitation?partnerToken:null}}});return apiHelper_makePostRequest(apiLinks.users.href,{"Content-Type":"application/hal+json"},_body)}return Promise.reject("Cannot create user from empty auth result.")},userDataHelper_addUserWithGoogle=function addUserWithGoogle(user,apiLinks,isInvitation,partnerCustomerTokenInRedirectURL,fields,providerType){if(user){var givenName=null,familyName=null,gender=null,providerId=null,idToken=null,authDomain=user.authDomain||user.w,displayNameSplit={givenName:user.displayName.split(" ")[0],familyName:user.displayName.split(" ")[1]};user.providerData&&user.providerData.length>0&&user.providerData[0].providerId&&(providerId=user.providerData[0].providerId),user.credential&&(user.credential.providerId&&(providerId=providerId||user.credential.providerId),user.credential.idToken&&(idToken=user.credential.idToken)),user.additionalUserInfo&&(user.additionalUserInfo.providerId&&(providerId=providerId||user.additionalUserInfo.providerId),user.additionalUserInfo.profile&&(user.additionalUserInfo.profile.given_name&&(givenName=user.additionalUserInfo.profile.given_name),user.additionalUserInfo.profile.first_name&&(givenName=user.additionalUserInfo.profile.first_name),user.additionalUserInfo.profile.family_name&&(familyName=user.additionalUserInfo.profile.family_name),user.additionalUserInfo.profile.last_name&&(familyName=user.additionalUserInfo.profile.last_name),user.additionalUserInfo.profile.gender&&(gender=user.additionalUserInfo.profile.gender)));var utm=JSON.parse(js_cookie_default.a.get("utm")),_getAcquisitionData4=(user.displayName||[givenName,familyName].filter((function(name){return name})).join(" ").trim(),acquisitionHelper_getAcquisitionData()),partnerToken=(_getAcquisitionData4.acquisition,_getAcquisitionData4.partnerToken);console.log("other",utm);var body=JSON.stringify({_embedded:{user:{givenName:displayNameSplit.givenName,familyName:displayNameSplit.familyName,displayName:user.displayName,photoUrl:user.photoURL,email:user.email,emailVerified:user.emailVerified,phoneNumber:user.phoneNumber||null,providerUserId:user.uid,gender:gender,idToken:idToken,providerId:user.providerData[0].providerId,authDomain:authDomain,extras:null,acquisition:utm,partnerToken:null,invitationToken:isInvitation?partnerToken:null}}});return apiHelper_makePostRequest(apiLinks.users.href,{"Content-Type":"application/hal+json"},body)}return Promise.reject("Cannot create user from empty auth result.")},getUser=function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(apiLinks,userId,updatedTokens){var backendTokens,headers,userResponse,userDetails,_backendTokens,_headers2,_userResponse,_userDetails;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,backendTokenHelper_refreshTokens(apiLinks);case 2:return backendTokens=_context.sent,headers={Authorization:"Bearer ".concat(backendTokens.access_token)},updatedTokens&&(headers={Authorization:"Bearer ".concat(updatedTokens.access_token)}),_context.prev=5,_context.next=8,apiHelper_makeGetRequest("".concat(apiLinks.users.href,"/").concat(userId),headers);case 8:return userResponse=_context.sent,userDetails=userResponse._embedded.userDetails,_context.abrupt("return",userDetails);case 13:return _context.prev=13,_context.t0=_context.catch(5),console.log("retry"),_context.next=18,refreshTokensVerbose(apiLinks,{refresh_token:Store_rootStore.authStore.persistRefreshToken});case 18:return _backendTokens=_context.sent,_headers2={Authorization:"Bearer ".concat(_backendTokens.access_token)},_context.next=22,apiHelper_makeGetRequest("".concat(apiLinks.users.href,"/").concat(userId),_headers2);case 22:return _userResponse=_context.sent,_userDetails=_userResponse._embedded.userDetails,_context.abrupt("return",_userDetails);case 25:case"end":return _context.stop()}}),_callee,null,[[5,13]])})));return function getUser(_x,_x2,_x3){return _ref.apply(this,arguments)}}(),userDataHelper_checkUserExists=function(){var _ref4=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(apiLinks,userId){return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",apiHelper_makeHeadRequest("".concat(apiLinks.users.href,"/").concat(userId)).then((function(){return!0})).catch((function(){return!1})));case 1:case"end":return _context4.stop()}}),_callee4)})));return function checkUserExists(_x6,_x7){return _ref4.apply(this,arguments)}}(),businessService_BusinessService=(__webpack_require__(655).PhoneNumberFormat,__webpack_require__(655).PhoneNumberUtil.getInstance(),function(){function BusinessService(){Object(classCallCheck.a)(this,BusinessService)}var _editUserDetails,_editBusinessConfiguration,_initializeBusiness,_getBusinessDetails,_editBusinessDetails,_updateInfo,_autoCompletePlaces,_disconnectBusiness,_getConnectionProfileData,_getPracticeAdvisors,_removeAdvisorFromBusiness,_addAdvisorToBusiness,_getBusinessesFromAdvisor,_getAdvisorsFromBusiness,_getBusinessUsers,_resendInviteAsAdvisor,_resendInvite,_inviteUserFromSuggested,_inviteAdvisor,_confirmSubscription,_cancelSubscription,_deleteSubscription,_fetchSubscription,_initiateSubscription,_activateSubscription,_inviteUser,_createBusinessFromXeroConnection,_fetchBusinessDataWithUserId,_fetchBusinessAccessTokens,_fetchBusinessData,_fetchPracticeId,_fetchBusinessInviteList,_fetchAdvisorInvitationList,_fetchPendingInviteCount,_fetchFullBusinessInviteList,_getBusinessApps,_pingProxyServer,_refreshPracticeCredentials;return Object(createClass.a)(BusinessService,null,[{key:"refreshPracticeCredentials",value:(_refreshPracticeCredentials=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(){var practiceId,user,idToken,businessLink,headers,body,backendTokens;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_context.prev=0,console.log("_R",Object(mobx_module.toJS)(Store_rootStore.authStore.practiceTokenExpiry),Object(mobx_module.toJS)(Store_rootStore.authStore.persistExpiry),Math.floor(Date.now()/1e3)),!(Store_rootStore.authStore.persistExpiry>Math.floor(Date.now()/1e3))){_context.next=7;break}return console.log(">>>"),_context.abrupt("return",{access_token:Store_rootStore.authStore.persistAccessToken,id_token:Store_rootStore.authStore.persistIdToken,expiresAt:Store_rootStore.authStore.persistExpiry});case 7:if(!(Store_rootStore.authStore.practiceTokenExpiry>Math.floor(Date.now()/1e3))){_context.next=12;break}return console.log(">>"),_context.abrupt("return",Store_rootStore.authStore.practiceTokens);case 12:return console.log("||"),practiceId=Store_rootStore.businessStore.practiceId.id,user=Store_rootStore.authStore.user,_context.next=17,user.getIdToken();case 17:return idToken=_context.sent,businessLink=Store_rootStore.authStore.links.businesses.href,Store_rootStore.authStore.links.tokens.href,headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",resource:"".concat(businessLink,"/").concat(practiceId)},_context.next=24,apiHelper_makePostRequest(Store_rootStore.authStore.links.tokens.href,headers,qs_lib_default.a.stringify(body));case 24:return backendTokens=_context.sent,Store_rootStore.authStore.storeAdvisorTokensAndUpdateExpiry(backendTokens),_context.abrupt("return",backendTokens);case 27:_context.next=32;break;case 29:_context.prev=29,_context.t0=_context.catch(0),esm.a(_context.t0);case 32:case"end":return _context.stop()}}),_callee,null,[[0,29]])}))),function refreshPracticeCredentials(){return _refreshPracticeCredentials.apply(this,arguments)})},{key:"pingProxyServer",value:(_pingProxyServer=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(){var res;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.prev=0,_context2.next=3,axios_default()({method:"get",url:"https://stark-depths-98247.herokuapp.com/"});case 3:return res=_context2.sent,_context2.abrupt("return",res);case 7:return _context2.prev=7,_context2.t0=_context2.catch(0),console.log(_context2.t0),_context2.abrupt("return",!1);case 11:case"end":return _context2.stop()}}),_callee2,null,[[0,7]])}))),function pingProxyServer(){return _pingProxyServer.apply(this,arguments)})},{key:"getBusinessApps",value:(_getBusinessApps=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(links,accessToken,id){var configResponse;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=3,makeGetRequest("".concat("https://aider-ai-staging.appspot.com/api/v1","/recommendations/apps"),{Authorization:"Bearer ".concat(accessToken)});case 3:return configResponse=_context3.sent,console.log("BUSINESSAPPS",configResponse),Store_rootStore.businessStore.setBusinessDetailApps(configResponse._embedded.recommendations,id),_context3.abrupt("return",Store_rootStore.businessStore.setBusinessApps(configResponse._embedded.recommendations));case 9:_context3.prev=9,_context3.t0=_context3.catch(0);case 11:case"end":return _context3.stop()}}),_callee3,null,[[0,9]])}))),function getBusinessApps(_x,_x2,_x3){return _getBusinessApps.apply(this,arguments)})},{key:"fetchFullBusinessInviteList",value:(_fetchFullBusinessInviteList=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(links,businessId,token,initial){var accessToken,tokens,url;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(accessToken=token,initial){_context4.next=6;break}return _context4.next=4,Store_rootStore.businessStore.refreshTokensIfExpired(businessId);case 4:tokens=_context4.sent,accessToken=tokens.access_token;case 6:Store_rootStore.businessStore.setLoading(!0),url="".concat(links.businesses.href,"/").concat(businessId,"/invitations"),makeGetRequest(url,{Authorization:"Bearer ".concat(accessToken)}).then((function(data){if(!data||0===data.length)return Store_rootStore.businessStore.storeInvitationListSplit([[]]),Store_rootStore.businessStore.setLoading(!1),[[]];Store_rootStore.businessStore.setLoading(!1);var invitationList=data._embedded.businessInvitations;return Store_rootStore.businessStore.storeInvitationListSplit(invitationList),invitationList}),(function(error){return console.log("err:",error),Store_rootStore.businessStore.storeInvitationListSplit([[]]),Store_rootStore.registerGAEvent("otherError"),Store_rootStore.businessStore.setLoading(!1),[[]]})).catch((function(e){return esm.a(e),console.log("error:",e),Store_rootStore.businessStore.storeInvitationList([[]]),Store_rootStore.businessStore.setLoading(!1),[[]]}));case 10:case"end":return _context4.stop()}}),_callee4)}))),function fetchFullBusinessInviteList(_x4,_x5,_x6,_x7){return _fetchFullBusinessInviteList.apply(this,arguments)})},{key:"fetchPendingInviteCount",value:(_fetchPendingInviteCount=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee5(links,businessId,token,initial){var accessToken,tokens,url;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(accessToken=token,initial){_context5.next=6;break}return _context5.next=4,Store_rootStore.businessStore.refreshTokensIfExpired(businessId);case 4:tokens=_context5.sent,accessToken=tokens.access_token;case 6:Store_rootStore.businessStore.setLoading(!0),url="".concat(links.businesses.href,"/").concat(businessId,"/invitations"),makeGetRequest(url,{Authorization:"Bearer ".concat(accessToken)}).then((function(data){if(!data||0===data.length)return Store_rootStore.businessStore.storeInvitationCount([[]],businessId),Store_rootStore.businessStore.setLoading(!1),[[]];Store_rootStore.businessStore.setLoading(!1);var invitationList=data._embedded.businessInvitations;return Store_rootStore.businessStore.storeInvitationCount(invitationList,businessId),invitationList}),(function(error){return console.log("err:",error),Store_rootStore.businessStore.storeInvitationCount([[]],businessId),Store_rootStore.registerGAEvent("otherError"),Store_rootStore.businessStore.setLoading(!1),[[]]})).catch((function(e){return esm.a(e),console.log("error:",e),Store_rootStore.businessStore.storeInvitationCount([[]],businessId),Store_rootStore.businessStore.setLoading(!1),[[]]}));case 10:case"end":return _context5.stop()}}),_callee5)}))),function fetchPendingInviteCount(_x8,_x9,_x10,_x11){return _fetchPendingInviteCount.apply(this,arguments)})},{key:"fetchAdvisorInvitationList",value:(_fetchAdvisorInvitationList=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee6(){var businesses,businessId,url,_yield$BusinessServic,access_token;return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return Store_rootStore.conversationStore.setResponseLoading(!0),businesses=Store_rootStore.authStore.links.businesses,businessId=Store_rootStore.businessStore.practiceId.id,url="".concat(businesses.href,"/").concat(businessId,"/invitations"),_context6.next=7,BusinessService.refreshPracticeCredentials();case 7:_yield$BusinessServic=_context6.sent,access_token=_yield$BusinessServic.access_token,makeGetRequest(url,{Authorization:"Bearer ".concat(access_token)}).then((function(data){if(console.log("fetchAdvisorInvitationList",data),!data||0===data.length)return Store_rootStore.businessStore.storeAdvisorInvitations([[]]),Store_rootStore.conversationStore.setResponseLoading(!1),[[]];Store_rootStore.conversationStore.setResponseLoading(!1);var invitationList=data._embedded.businessInvitations;return Store_rootStore.businessStore.storeAdvisorInvitations(invitationList),invitationList}),(function(error){return console.log("err:",error),Store_rootStore.businessStore.storeAdvisorInvitations([[]]),Store_rootStore.registerGAEvent("otherError"),Store_rootStore.conversationStore.setResponseLoading(!1),[[]]})).catch((function(e){return esm.a(e),console.log("error:",e),Store_rootStore.businessStore.storeAdvisorInvitations([[]]),Store_rootStore.conversationStore.setResponseLoading(!1),[[]]}));case 10:case"end":return _context6.stop()}}),_callee6)}))),function fetchAdvisorInvitationList(){return _fetchAdvisorInvitationList.apply(this,arguments)})},{key:"fetchBusinessInviteList",value:(_fetchBusinessInviteList=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee7(links,businessId,token,initial){var accessToken,tokens,url;return regenerator_default.a.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(accessToken=token,initial){_context7.next=6;break}return _context7.next=4,Store_rootStore.businessStore.refreshTokensIfExpired(businessId);case 4:tokens=_context7.sent,accessToken=tokens.access_token;case 6:Store_rootStore.businessStore.setLoading(!0),url="".concat(links.businesses.href,"/").concat(businessId,"/invitations/recommendations"),makeGetRequest(url,{Authorization:"Bearer ".concat(accessToken)}).then((function(data){if(!data||0===data.length)return Store_rootStore.businessStore.storeInvitationList([[]]),Store_rootStore.businessStore.setLoading(!1),[[]];Store_rootStore.businessStore.setLoading(!1);var invitationList=data._embedded.recommendedBusinessInvitations;return Store_rootStore.businessStore.storeInvitationList(invitationList),invitationList}),(function(error){return console.log("err:",error),Store_rootStore.businessStore.storeInvitationList([[]]),Store_rootStore.registerGAEvent("otherError"),Store_rootStore.businessStore.setLoading(!1),[[]]})).catch((function(e){return esm.a(e),console.log("error:",e),Store_rootStore.businessStore.storeInvitationList([[]]),Store_rootStore.businessStore.setLoading(!1),[[]]}));case 10:case"end":return _context7.stop()}}),_callee7)}))),function fetchBusinessInviteList(_x12,_x13,_x14,_x15){return _fetchBusinessInviteList.apply(this,arguments)})},{key:"fetchPracticeId",value:(_fetchPracticeId=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee8(links,access_token){return regenerator_default.a.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.abrupt("return",makeGetRequest("".concat(links.businesses.href,"/"),{Authorization:"Bearer ".concat(access_token)}).then((function(data){data||window.location.reload(!0),data&&data.count;var practiceId=data._embedded.businesses.filter((function(i){return"management"===i.businessClass}))[0];return practiceId?(Store_rootStore.businessStore.setPracticeId(practiceId),practiceId):null}),(function(error){console.log("err:",error)})));case 1:case"end":return _context8.stop()}}),_callee8)}))),function fetchPracticeId(_x16,_x17){return _fetchPracticeId.apply(this,arguments)})},{key:"fetchBusinessData",value:(_fetchBusinessData=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee9(links,access_token){return regenerator_default.a.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:makeGetRequest("".concat(links.businesses.href,"/"),{Authorization:"Bearer ".concat(access_token)}).then((function(data){if(!data)return window.location.reload(!0);data&&0===data.count&&Store_rootStore.authStore.setLoading(!1),Store_rootStore.authStore.setShallowLoader(!1),Store_rootStore.authStore.setLoading(!1),Store_rootStore.businessStore.storeData(data).then((function(){}),(function(){}))}),(function(error){console.log("err:",error),Store_rootStore.registerGAEvent("otherError")}));case 2:case"end":return _context9.stop()}}),_callee9)}))),function fetchBusinessData(_x18,_x19){return _fetchBusinessData.apply(this,arguments)})},{key:"fetchBusinessAccessTokens",value:(_fetchBusinessAccessTokens=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee10(links,access_token,id_token){return regenerator_default.a.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.t0=axios_default.a,_context10.t1="https://business-service-dot-aider-ai-staging.appspot.com/api/v1/users/".concat(Store_rootStore.authStore.user.uid,"/businesses"),_context10.t2={Authorization:"Bearer ".concat(access_token)},_context10.next=5,Store_rootStore.authStore.user.getIdToken();case 5:return _context10.t3=_context10.sent,_context10.t4={token:_context10.t3},_context10.t5={method:"post",url:_context10.t1,headers:_context10.t2,data:_context10.t4},_context10.abrupt("return",(0,_context10.t0)(_context10.t5).then((function(data){if(!data)return window.location.reload(!0);Store_rootStore.businessStore.storeData(data.data).then((function(){Store_rootStore.authStore.setShallowLoader(!1),Store_rootStore.authStore.setLoading(!1)}),(function(){}))})).catch((function(e){console.log("e",e)})));case 9:case"end":return _context10.stop()}}),_callee10)}))),function fetchBusinessAccessTokens(_x20,_x21,_x22){return _fetchBusinessAccessTokens.apply(this,arguments)})},{key:"fetchBusinessDataWithUserId",value:(_fetchBusinessDataWithUserId=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee11(links,access_token){return regenerator_default.a.wrap((function _callee11$(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:makeGetRequest("https://business-service-dot-aider-ai-staging.appspot.com/api/v1/users/".concat(Store_rootStore.authStore.user.uid,"/businesses"),{Authorization:"Bearer ".concat(access_token)}).then((function(data){if(!data)return window.location.reload(!0);Store_rootStore.businessStore.storeData(data).then((function(){Store_rootStore.authStore.setShallowLoader(!1),Store_rootStore.authStore.setLoading(!1)}),(function(){}))}),(function(error){console.log("err:",error),Store_rootStore.registerGAEvent("otherError")}));case 2:case"end":return _context11.stop()}}),_callee11)}))),function fetchBusinessDataWithUserId(_x23,_x24){return _fetchBusinessDataWithUserId.apply(this,arguments)})},{key:"createBusinessFromXeroConnection",value:(_createBusinessFromXeroConnection=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee12(links,access_token,businessParameters,practiceId){var newBusinessData;return regenerator_default.a.wrap((function _callee12$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return Store_rootStore.authStore.setLoading(!0),Store_rootStore.authStore.setLoadingContent(["Creating A New Business...","Establishing Connection...","Waiting for Connection Status..."]),newBusinessData={name:businessParameters.name,area:businessParameters.area,countryCode:businessParameters.countryCode,timeZoneId:businessParameters.timeZoneId,phoneNumber:businessParameters.phoneNumber,address:businessParameters.address,creatorRole:"advisor"},practiceId&&(newBusinessData.managedBy=practiceId.id),_context12.abrupt("return",axios_default()({method:"post",url:"".concat(links.businesses.href,"/"),data:{_embedded:{business:newBusinessData}},headers:{Authorization:"Bearer ".concat(access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return console.log(".newBusiness@",res),res})).catch((function(e){if(esm.a(e),e.response.data&&e.response.data._embedded&&"PAYMENT_REQUIRED"===e.response.data._embedded.error.code)return console.log(e.response.data._embedded.error.message),Store_rootStore.authStore.renderFallbackPaymentModal(!0),Store_rootStore.authStore.setLoading(!1);console.log("error creating business from xero connection",e.response.data.code)})));case 5:case"end":return _context12.stop()}}),_callee12)}))),function createBusinessFromXeroConnection(_x25,_x26,_x27,_x28){return _createBusinessFromXeroConnection.apply(this,arguments)})},{key:"inviteUser",value:(_inviteUser=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee13(links,access_token,businessId,fields){var tokens,resolvedFieldInput;return regenerator_default.a.wrap((function _callee13$(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return _context13.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context13.sent,resolvedFieldInput=fields.map((function(fieldSet){return{givenName:fieldSet.givenName.split(" ")[0],familyName:fieldSet.givenName.split(" ")[1],displayName:fieldSet.givenName,email:fieldSet.emailAddress,roleKey:"admin"}})),_context13.abrupt("return",axios_default()({method:"post",url:"".concat(links.businesses.href,"/").concat(businessId,"/invitations"),data:{_embedded:{businessInvitations:resolvedFieldInput}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){res.data._embedded.invitations[0].status="invited",BusinessService.fetchFullBusinessInviteList(links,businessId,access_token,!0),Store_rootStore.businessStore.renderClientConfirmationWindow(!0)})).catch((function(e){esm.a(e),console.log("error inviting user to business",e)})));case 5:case"end":return _context13.stop()}}),_callee13)}))),function inviteUser(_x29,_x30,_x31,_x32){return _inviteUser.apply(this,arguments)})},{key:"activateSubscription",value:(_activateSubscription=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee14(links,sourceToken,promo){var user,practiceId,idToken,headers,body,backendTokens;return regenerator_default.a.wrap((function _callee14$(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return user=Store_rootStore.authStore.user,practiceId=Store_rootStore.businessStore.practiceId.id,_context14.next=4,user.getIdToken();case 4:return idToken=_context14.sent,headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",resource:"".concat(links.businesses.href,"/").concat(practiceId)},_context14.next=9,apiHelper_makePostRequest(links.tokens.href,headers,qs_lib_default.a.stringify(body));case 9:return backendTokens=_context14.sent,_context14.abrupt("return",axios_default()({method:"post",url:"".concat(links.subscriptions.href),data:{_embedded:{subscription:{sourceToken:sourceToken,planId:"abcd1234",promoCode:promo}}},headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return Store_rootStore.businessStore.renderConfirmationWindow(!0)})).catch((function(e){esm.a(e),console.log("error inviting user to business",e)})));case 11:case"end":return _context14.stop()}}),_callee14)}))),function activateSubscription(_x33,_x34,_x35){return _activateSubscription.apply(this,arguments)})},{key:"initiateSubscription",value:(_initiateSubscription=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee15(){var user,practiceId,idToken,headers,businessLink,tokenLink,body,backendTokens;return regenerator_default.a.wrap((function _callee15$(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return user=Store_rootStore.authStore.user,practiceId=Store_rootStore.businessStore.practiceId.id,_context15.next=4,user.getIdToken();case 4:return idToken=_context15.sent,headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},businessLink=Store_rootStore.authStore.links.businesses.href,tokenLink=Store_rootStore.authStore.links.tokens.href,body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",resource:"".concat(businessLink,"/").concat(practiceId)},_context15.next=11,apiHelper_makePostRequest(tokenLink,headers,qs_lib_default.a.stringify(body));case 11:return backendTokens=_context15.sent,Store_rootStore.authStore.setTokens(backendTokens.access_token,backendTokens.refresh_token,backendTokens.id_token),_context15.abrupt("return",axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com","/api/v2/subscriptions"),headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return Store_rootStore.businessStore.storeInitSubscription(res.data._links),!0})).catch((function(e){return Store_rootStore.authStore.renderSubscriptionCreationError(e.message),console.log("couldnt initiate",e),!1})));case 14:case"end":return _context15.stop()}}),_callee15)}))),function initiateSubscription(){return _initiateSubscription.apply(this,arguments)})},{key:"fetchSubscription",value:(_fetchSubscription=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee16(links,token){var user,practiceId,idToken,headers,businessLink,tokenLink,body,backendTokens;return regenerator_default.a.wrap((function _callee16$(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return user=Store_rootStore.authStore.user,practiceId=Store_rootStore.businessStore.practiceId.id,_context16.next=4,user.getIdToken();case 4:return idToken=_context16.sent,headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},businessLink=Store_rootStore.authStore.links.businesses.href,tokenLink=Store_rootStore.authStore.links.tokens.href,body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",resource:"".concat(businessLink,"/").concat(practiceId)},_context16.next=11,apiHelper_makePostRequest(tokenLink,headers,qs_lib_default.a.stringify(body));case 11:return backendTokens=_context16.sent,_context16.abrupt("return",axios_default()({method:"get",url:"".concat("https://aider-ai-staging.appspot.com","/api/v2/subscriptions?businessId=").concat(practiceId),headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return Store_rootStore.businessStore.storeSubscription(res)})).catch((function(e){esm.a(e),console.log("error inviting user to business",e)})));case 13:case"end":return _context16.stop()}}),_callee16)}))),function fetchSubscription(_x36,_x37){return _fetchSubscription.apply(this,arguments)})},{key:"deleteSubscription",value:(_deleteSubscription=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee17(){var user,practiceId,idToken,headers,businessLink,tokenLink,body,backendTokens;return regenerator_default.a.wrap((function _callee17$(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:return user=Store_rootStore.authStore.user,practiceId=Store_rootStore.businessStore.practiceId.id,_context17.next=4,user.getIdToken();case 4:return idToken=_context17.sent,headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},businessLink=Store_rootStore.authStore.links.businesses.href,tokenLink=Store_rootStore.authStore.links.tokens.href,body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",resource:"".concat(businessLink,"/").concat(practiceId)},_context17.next=11,apiHelper_makePostRequest(tokenLink,headers,qs_lib_default.a.stringify(body));case 11:return backendTokens=_context17.sent,_context17.prev=12,_context17.abrupt("return",axios_default()({method:"delete",url:"".concat("https://aider-ai-staging.appspot.com","/api/v2/subscriptions"),headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){Store_rootStore.businessStore.fetchSubscription(Store_rootStore.authStore.links,backendTokens.access_token),Store_rootStore.authStore.renderSubscriptionCancellation("cancelled")})).catch((function(e){console.log("error deleting subscription",e),Store_rootStore.authStore.renderSubscriptionCancellation("failed")})));case 16:_context17.prev=16,_context17.t0=_context17.catch(12),console.log(_context17.t0),Store_rootStore.authStore.renderSubscriptionCancellation("failed");case 20:case"end":return _context17.stop()}}),_callee17,null,[[12,16]])}))),function deleteSubscription(){return _deleteSubscription.apply(this,arguments)})},{key:"cancelSubscription",value:(_cancelSubscription=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee18(){var tokens,cancelURL;return regenerator_default.a.wrap((function _callee18$(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return _context18.next=2,BusinessService.refreshPracticeCredentials();case 2:if(tokens=_context18.sent,!(cancelURL=Store_rootStore.businessStore.initSubscription.cancel?Store_rootStore.businessStore.initSubscription.cancel.href:null)){_context18.next=8;break}axios_default()({method:"post",url:"".concat(cancelURL),data:{_embedded:{subscriptionPurchase:{paymentProvider:{providerKey:"stripe",externalId:"ai.aider.subscription.premium"},cancellationReason:"cancelled_by_user"}}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){Store_rootStore.authStore.hasExceededQuota(!1),console.log(res)})).catch((function(e){Store_rootStore.authStore.hasExceededQuota(!1)})),_context18.next=9;break;case 8:return _context18.abrupt("return",Store_rootStore.authStore.hasExceededQuota(!1));case 9:case"end":return _context18.stop()}}),_callee18)}))),function cancelSubscription(){return _cancelSubscription.apply(this,arguments)})},{key:"confirmSubscription",value:(_confirmSubscription=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee19(links,stripeToken,promoCode){var backendTokens,confirmURL;return regenerator_default.a.wrap((function _callee19$(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return _context19.next=2,BusinessService.refreshPracticeCredentials();case 2:backendTokens=_context19.sent;try{confirmURL=Store_rootStore.businessStore.initSubscription.confirm.href,axios_default()({method:"put",url:"".concat(confirmURL),data:{_embedded:{subscriptionPurchase:{paymentProvider:{providerKey:"stripe",externalId:"ai.aider.subscription.premium"},confirmationPayload:stripeToken.id,promoCode:promoCode}}},headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return Store_rootStore.authStore.hasExceededQuota(!1),Store_rootStore.businessStore.fetchSubscription(Store_rootStore.authStore.links,backendTokens.access_token),Store_rootStore.authStore.renderPaymentConfirmation(!0),res})).catch((function(e){console.log(e.message,e.response),Store_rootStore.authStore.hasExceededQuota(!1),esm.a(e),e.response.data&&e.response.data._embedded&&"string"==typeof e.response.data._embedded.error.message?"Incorrect promotion configured for"===e.response.data._embedded.error.message.replace(" ".concat(promoCode),"")?Store_rootStore.authStore.renderSubscriptionCreationError("Sorry! We couldn't recognize that promotional code."):Store_rootStore.authStore.renderSubscriptionCreationError(e.response.data._embedded.error.message):(Store_rootStore.authStore.renderSubscriptionCreationError("Oops! something went wrong. We'll be in touch soon to sort it out."),esm.b("user subscription failure. user: ".concat(JSON.stringify(Store_rootStore.authStore.practiceUser.user)," // ").concat(Store_rootStore.businessStore.subscription.id)))}))}catch(e){console.log(e.message,e.response.data),Store_rootStore.authStore.hasExceededQuota(!1),esm.a(e),Store_rootStore.authStore.renderSubscriptionCreationError("Error contacting payment server, please try again later")}case 4:case"end":return _context19.stop()}}),_callee19)}))),function confirmSubscription(_x38,_x39,_x40){return _confirmSubscription.apply(this,arguments)})},{key:"inviteAdvisor",value:(_inviteAdvisor=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee20(links,access_token,businessId,fields){var practiceId,backendTokens,givenName,familyName,data;return regenerator_default.a.wrap((function _callee20$(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return Store_rootStore.conversationStore.setResponseLoading(!0),practiceId=Store_rootStore.businessStore.practiceId.id,_context20.next=4,BusinessService.refreshPracticeCredentials();case 4:return backendTokens=_context20.sent,givenName=fields.givenName.split(" ")[0],familyName=fields.givenName.split(" ")[1],data={givenName:givenName,familyName:familyName,displayName:fields.givenName,email:fields.emailAddress,roleKey:"practice_user"},_context20.abrupt("return",axios_default()({method:"post",url:"".concat(links.businesses.href,"/").concat(practiceId,"/invitations"),data:{_embedded:{businessInvitations:[data]}},headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){Store_rootStore.businessStore.fetchAdvisorInvitationList(),Store_rootStore.conversationStore.setResponseLoading(!1),Store_rootStore.businessStore.renderConfirmationWindow(!0,data)})).catch((function(e){esm.a(e),console.log("error inviting user to practice",e),Store_rootStore.conversationStore.setResponseLoading(!1)})));case 9:case"end":return _context20.stop()}}),_callee20)}))),function inviteAdvisor(_x41,_x42,_x43,_x44){return _inviteAdvisor.apply(this,arguments)})},{key:"inviteUserFromSuggested",value:(_inviteUserFromSuggested=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee21(links,access_token,businessId,givenName,familyName,email){var tokens,resolvedFieldInput;return regenerator_default.a.wrap((function _callee21$(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:return _context21.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context21.sent,resolvedFieldInput=[{givenName:givenName,familyName:familyName,displayName:"".concat(givenName," ").concat(familyName),email:email,roleKey:"admin"}],_context21.abrupt("return",axios_default()({method:"post",url:"".concat(links.businesses.href,"/").concat(businessId,"/invitations"),data:{_embedded:{businessInvitations:resolvedFieldInput}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return Store_rootStore.businessStore.renderClientConfirmationWindow(!0)})).catch((function(e){esm.a(e),console.log("error inviting user to business",e)})));case 5:case"end":return _context21.stop()}}),_callee21)}))),function inviteUserFromSuggested(_x45,_x46,_x47,_x48,_x49,_x50){return _inviteUserFromSuggested.apply(this,arguments)})},{key:"resendInvite",value:(_resendInvite=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee22(links,access_token,invitationId,businessId){var tokens;return regenerator_default.a.wrap((function _callee22$(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:return _context22.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context22.sent,_context22.abrupt("return",axios_default()({method:"post",url:"".concat(links.businesses.href,"/").concat(businessId,"/invitations/").concat(invitationId,"/resend"),data:{},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return Store_rootStore.businessStore.renderClientConfirmationWindow(!0)})).catch((function(e){esm.a(e),console.log("error inviting user to business",e)})));case 4:case"end":return _context22.stop()}}),_callee22)}))),function resendInvite(_x51,_x52,_x53,_x54){return _resendInvite.apply(this,arguments)})},{key:"resendInviteAsAdvisor",value:(_resendInviteAsAdvisor=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee23(links,access_token,invitationId,businessId){var tokens;return regenerator_default.a.wrap((function _callee23$(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:return Store_rootStore.conversationStore.setResponseLoading(!0),_context23.next=3,BusinessService.refreshPracticeCredentials();case 3:return tokens=_context23.sent,_context23.abrupt("return",axios_default()({method:"post",url:"".concat(links.businesses.href,"/").concat(businessId,"/invitations/").concat(invitationId,"/resend"),data:{},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return Store_rootStore.conversationStore.setResponseLoading(!1),Store_rootStore.businessStore.renderClientConfirmationWindow(!0)})).catch((function(e){esm.a(e),Store_rootStore.conversationStore.setResponseLoading(!1),console.log("error inviting user to business",e)})));case 5:case"end":return _context23.stop()}}),_callee23)}))),function resendInviteAsAdvisor(_x55,_x56,_x57,_x58){return _resendInviteAsAdvisor.apply(this,arguments)})},{key:"getBusinessUsers",value:(_getBusinessUsers=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee24(links,access_token,business){return regenerator_default.a.wrap((function _callee24$(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:return _context24.abrupt("return",axios_default()({method:"get",url:"".concat(links.businesses.href,"/").concat(business.id,"/users"),data:{},headers:{Authorization:"Bearer ".concat(access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return Store_rootStore.businessStore.updateBusinessListUsers(business.id,res.data._embedded),res.data})).catch((function(e){esm.a(e),console.log("error getting detail to business",e)})));case 1:case"end":return _context24.stop()}}),_callee24)}))),function getBusinessUsers(_x59,_x60,_x61){return _getBusinessUsers.apply(this,arguments)})},{key:"getAdvisorsFromBusiness",value:(_getAdvisorsFromBusiness=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee25(links){var practiceId,user,idToken,headers,body,backendTokens;return regenerator_default.a.wrap((function _callee25$(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:return practiceId=Store_rootStore.businessStore.practiceId.id,user=Store_rootStore.authStore.user,_context25.next=4,user.getIdToken();case 4:return idToken=_context25.sent,headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",resource:"".concat(links.businesses.href,"/").concat(practiceId)},_context25.next=9,apiHelper_makePostRequest(Store_rootStore.authStore.links.tokens.href,headers,qs_lib_default.a.stringify(body));case 9:return backendTokens=_context25.sent,_context25.abrupt("return",axios_default()({method:"get",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/").concat(Store_rootStore.businessStore.selectedBusinessId,"/advisors"),data:{_embedded:{advisors:{validAdvisors:[{id:"advisorId",name:"Advisor Name"}],currentAdvisors:[{id:"advisorId",name:"advisorName"}]}}},headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}));case 11:case"end":return _context25.stop()}}),_callee25)}))),function getAdvisorsFromBusiness(_x62){return _getAdvisorsFromBusiness.apply(this,arguments)})},{key:"getBusinessesFromAdvisor",value:(_getBusinessesFromAdvisor=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee26(links,advisorId){var practiceId,user,backendTokens;return regenerator_default.a.wrap((function _callee26$(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return console.log(advisorId),practiceId=Store_rootStore.businessStore.practiceId.id,user=Store_rootStore.authStore.user,_context26.next=5,user.getIdToken();case 5:return _context26.sent,"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"))),"".concat(links.businesses.href,"/").concat(practiceId),backendTokens=Store_rootStore.authStore.advisorTokens,_context26.abrupt("return",axios_default()({method:"get",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/practices/advisors/").concat(advisorId,"/clients"),headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){console.log("businesses from advisor:",res),Store_rootStore.businessStore.storeAdvisorsClients(res.data._embedded.clients)}),(function(rej){console.log("rej",rej),Store_rootStore.businessStore.storeAdvisorsClients({currentClients:[],validClients:[]})})));case 10:case"end":return _context26.stop()}}),_callee26)}))),function getBusinessesFromAdvisor(_x63,_x64){return _getBusinessesFromAdvisor.apply(this,arguments)})},{key:"addAdvisorToBusiness",value:(_addAdvisorToBusiness=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee27(links,addToBusinessArray,advisorId){var addToBusinessArrayProcessed,practiceId,backendTokens;return regenerator_default.a.wrap((function _callee27$(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return _context27.prev=0,addToBusinessArrayProcessed=addToBusinessArray.map((function(i){return{clientBusinessId:i,advisorUserId:advisorId.id}})),practiceId=Store_rootStore.businessStore.practiceId.id,_context27.next=5,BusinessService.refreshPracticeCredentials();case 5:return backendTokens=_context27.sent,_context27.abrupt("return",axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/practices/").concat(practiceId,"/clients/advisors"),data:{_embedded:{advisorAddRequests:addToBusinessArrayProcessed}},headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).catch((function(e){console.log("err",e)})));case 9:_context27.prev=9,_context27.t0=_context27.catch(0),console.log("error with advisors",_context27.t0);case 12:case"end":return _context27.stop()}}),_callee27,null,[[0,9]])}))),function addAdvisorToBusiness(_x65,_x66,_x67){return _addAdvisorToBusiness.apply(this,arguments)})},{key:"removeAdvisorFromBusiness",value:(_removeAdvisorFromBusiness=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee28(links,addToBusinessArray,advisorId,fullArray){var fullArrayMappedToId,processedFullArrayForSubtraction,practiceId,backendTokens;return regenerator_default.a.wrap((function _callee28$(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:return _context28.prev=0,fullArrayMappedToId=fullArray.map((function(i){return i.id})),console.log("Full array:",fullArrayMappedToId),processedFullArrayForSubtraction=fullArrayMappedToId.filter((function(x){return!addToBusinessArray.includes(x)})).map((function(i){return{clientBusinessId:i,advisorUserId:advisorId.id}})),console.log("---",processedFullArrayForSubtraction),practiceId=Store_rootStore.businessStore.practiceId.id,_context28.next=8,BusinessService.refreshPracticeCredentials();case 8:return backendTokens=_context28.sent,_context28.abrupt("return",axios_default()({method:"delete",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/practices/").concat(practiceId,"/clients/advisors"),data:{_embedded:{advisorRemoveRequests:processedFullArrayForSubtraction}},headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}));case 12:_context28.prev=12,_context28.t0=_context28.catch(0),console.log(_context28.t0);case 15:case"end":return _context28.stop()}}),_callee28,null,[[0,12]])}))),function removeAdvisorFromBusiness(_x68,_x69,_x70,_x71){return _removeAdvisorFromBusiness.apply(this,arguments)})},{key:"getPracticeAdvisors",value:(_getPracticeAdvisors=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee29(links){var practiceId,user,idToken,headers,body,backendTokens;return regenerator_default.a.wrap((function _callee29$(_context29){for(;;)switch(_context29.prev=_context29.next){case 0:return Store_rootStore.businessStore.fetchAdvisorsLoading(!0),_context29.prev=1,practiceId=Store_rootStore.businessStore.practiceId.id,user=Store_rootStore.authStore.user,_context29.next=6,user.getIdToken();case 6:return idToken=_context29.sent,headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",resource:"".concat(links.businesses.href,"/").concat(practiceId)},_context29.prev=9,_context29.next=12,apiHelper_makePostRequest(links.tokens.href,headers,qs_lib_default.a.stringify(body));case 12:return backendTokens=_context29.sent,Store_rootStore.authStore.storeAdvisorTokens(backendTokens),console.log("!",Object(mobx_module.toJS)(Store_rootStore.businessStore.practiceId)),_context29.next=17,refreshTokens(Store_rootStore.authStore.links);case 17:return _context29.sent,_context29.abrupt("return",axios_default()({method:"get",url:"".concat(links.businesses.href,"/").concat(practiceId,"/users"),data:{},headers:{Authorization:"Bearer ".concat(backendTokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){res.data&&(Store_rootStore.businessStore.fetchAdvisorsLoading(!1),Store_rootStore.businessStore.updatePracticeAdvisors(res.data))})).catch((function(e){Store_rootStore.businessStore.fetchAdvisorsLoading(!1),esm.a(e),console.log("error getting detail to business",e),Store_rootStore.businessStore.fetchAdvisorsLoading(!1)})));case 21:_context29.prev=21,_context29.t0=_context29.catch(9),console.log("err getting practice token:",_context29.t0),Store_rootStore.businessStore.fetchAdvisorsLoading(!1);case 25:_context29.next=30;break;case 27:_context29.prev=27,_context29.t1=_context29.catch(1),console.log("err getting user",_context29.t1);case 30:case"end":return _context29.stop()}}),_callee29,null,[[1,27],[9,21]])}))),function getPracticeAdvisors(_x72){return _getPracticeAdvisors.apply(this,arguments)})},{key:"getConnectionProfileData",value:(_getConnectionProfileData=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee30(links,access_token,business){var connectionId,xeroConnection,data,mockData;return regenerator_default.a.wrap((function _callee30$(_context30){for(;;)switch(_context30.prev=_context30.next){case 0:return _context30.prev=0,_context30.next=3,getConnections(links,access_token);case 3:if(connectionId=_context30.sent,Store_rootStore.businessStore.updateBusinessListApps(business.id,connectionId._embedded.connections),!(xeroConnection=connectionId&&connectionId._embedded.connections.find((function(connection){return"xero"===connection.ospKey})))||!xeroConnection.id){_context30.next=13;break}return _context30.next=9,checkConnectionConfiguration(links,access_token,xeroConnection.id);case 9:return data=_context30.sent,Store_rootStore.businessStore.setXeroConnection(xeroConnection,data),console.log("has DATA:",data),_context30.abrupt("return",Store_rootStore.businessStore.updateBusinessListDetail(business.id,null,data));case 13:return Store_rootStore.businessStore.setXeroConnection({},{}),mockData={_embedded:{configuration:{entities:[{address:"",countryCode:"",currencyCode:"",financialYearEnd:"",lineOfBusiness:"",phoneNumber:"",salesTaxBasis:"",salesTaxPeriod:"",shortCode:"",taxNumber:"",tenantConnectionId:"",tenantType:"",timezoneId:""}]}}},_context30.abrupt("return",Store_rootStore.businessStore.updateBusinessListDetail(business.id,null,mockData));case 18:return _context30.prev=18,_context30.t0=_context30.catch(0),_context30.abrupt("return",Store_rootStore.businessStore.updateBusinessListDetail(business.id,null,{_embedded:{configuration:{disconnected:!0,entities:[{address:"",countryCode:"",currencyCode:"",financialYearEnd:"",lineOfBusiness:"",phoneNumber:"",salesTaxBasis:"",salesTaxPeriod:"",shortCode:"",taxNumber:"",tenantConnectionId:"",tenantType:"",timezoneId:""}]}}}));case 21:case"end":return _context30.stop()}}),_callee30,null,[[0,18]])}))),function getConnectionProfileData(_x73,_x74,_x75){return _getConnectionProfileData.apply(this,arguments)})},{key:"disconnectBusiness",value:(_disconnectBusiness=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee31(){var backendTokens,businessTokens;return regenerator_default.a.wrap((function _callee31$(_context31){for(;;)switch(_context31.prev=_context31.next){case 0:return Store_rootStore.businessStore.practiceId.id,_context31.next=3,BusinessService.refreshPracticeCredentials();case 3:return backendTokens=_context31.sent,_context31.next=6,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 6:if(businessTokens=_context31.sent,!Store_rootStore.businessStore.xeroDisconnectLink){_context31.next=9;break}return _context31.abrupt("return",deleteConnection(backendTokens,Store_rootStore.businessStore.xeroDisconnectLink,businessTokens).then((function(res){console.log("connection status with practice tokens:",res),setTimeout((function(){Store_rootStore.businessStore.selectBusiness2(Store_rootStore.businessStore.selectedBusinessId,(function(){}))}),1e3)})));case 9:console.log("business is already DCd");case 10:case"end":return _context31.stop()}}),_callee31)}))),function disconnectBusiness(){return _disconnectBusiness.apply(this,arguments)})},{key:"autoCompletePlaces",value:(_autoCompletePlaces=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee32(data,key){var PROXY_URL,url,res;return regenerator_default.a.wrap((function _callee32$(_context32){for(;;)switch(_context32.prev=_context32.next){case 0:return PROXY_URL=200===Store_rootStore.businessStore.proxyStatus?"https://stark-depths-98247.herokuapp.com/":"https://cors-anywhere.herokuapp.com/",console.log("?",PROXY_URL,Store_rootStore.businessStore.proxyStatus),console.log("?",PROXY_URL),url="https://maps.googleapis.com/maps/api/place/autocomplete/json?input=".concat(encodeURIComponent(data),"&key=").concat(encodeURIComponent(key)),_context32.next=6,makeGetRequest(PROXY_URL+url,{});case 6:res=_context32.sent,Store_rootStore.businessStore.autoCompleteIsLoading(!1),Store_rootStore.businessStore.displayAutoCompletePlaces(res);case 9:case"end":return _context32.stop()}}),_callee32)}))),function autoCompletePlaces(_x76,_x77){return _autoCompletePlaces.apply(this,arguments)})},{key:"updateInfo",value:(_updateInfo=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee33(links,access_token,businessId,fields,key,previouslyUsedSoftware){var previouslyUsedSoftwareArray,PROXY_URL,locationData,url,res,countryCode,area,ts,tzUrl,timezone;return regenerator_default.a.wrap((function _callee33$(_context33){for(;;)switch(_context33.prev=_context33.next){case 0:return previouslyUsedSoftwareArray=Object.values(previouslyUsedSoftware).filter((function(value){return"string"==typeof value})),PROXY_URL=200===Store_rootStore.businessStore.proxyStatus?"https://stark-depths-98247.herokuapp.com/":"https://cors-anywhere.herokuapp.com/",console.log("?",PROXY_URL,Store_rootStore.businessStore.proxyStatus),_context33.prev=3,locationData={profile:{accountingSoftware:previouslyUsedSoftwareArray||[],numberOfAccountants:fields.numAccountants||"",numberOfClients:fields.numClients||""},location:{latitude:"",longitude:""},timeZoneId:"",address:"",name:"",area:"Auckland",countryCode:"NZ",phoneNumber:"",types:[],utcOffset:"",website:"",rawOffset:"",dstOffset:"",businessClass:"management",creatorRole:"practice_admin"},url="https://maps.googleapis.com/maps/api/place/details/json?place_id=".concat(encodeURIComponent(fields.placeInformation.place_id),"&key=").concat(encodeURIComponent(key)),_context33.next=8,axios_default()({method:"get",url:PROXY_URL+url});case 8:if(res=_context33.sent,countryCode=res.data.result.address_components.find((function(component){return component.types.includes("country")})),area="NZ"===countryCode.short_name||"AU"!==countryCode.short_name?res.data.result.address_components.find((function(component){return component.types.includes("administrative_area_level_1")})):res.data.result.address_components.find((function(component){return component.types.includes("administrative_area_level_2")})),locationData.name=fields.businessName||res.data.result.name,locationData.location.latitude=res.data.result.geometry.location.lat,locationData.location.longitude=res.data.result.geometry.location.lng,locationData.address=res.data.result.formatted_address,locationData.phoneNumber=res.data.result.formatted_phone_number,locationData.types=res.data.result.types,locationData.utcOffset=res.data.result.utc_offset,locationData.website=res.data.result.website,!countryCode.short_name||!area.short_name){_context33.next=24;break}locationData.countryCode=countryCode.short_name,locationData.area=area.long_name,_context33.next=27;break;case 24:return console.log("could not find address"),esm.b("User Tried to Set Up Practice with Address: Failure to Find Address"),_context33.abrupt("return");case 27:return ts=Math.round((new Date).getTime()/1e3),tzUrl="https://maps.googleapis.com/maps/api/timezone/json?location=".concat(locationData.location.latitude,",").concat(locationData.location.longitude,"&timestamp=").concat(ts,"&key=").concat(encodeURIComponent(key)),_context33.next=31,axios_default()({method:"get",url:PROXY_URL+tzUrl});case 31:return timezone=_context33.sent,locationData.timeZoneId=timezone.data.timeZoneId,locationData.rawOffset=timezone.data.rawOffset,locationData.dstOffset=timezone.data.dstOffset,_context33.abrupt("return",axios_default()({method:"post",url:"".concat(links.businesses.href),data:{_embedded:{business:locationData}},headers:{Authorization:"Bearer ".concat(access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return Store_rootStore.businessStore.shouldSetUpPractice(!1),Store_rootStore.authStore.invalidateCache(),js_cookie_default.a.set("inviteAdvisors","true"),window.location.reload(),res})).catch((function(e){esm.a(e),console.log("error inviting user to business",e)})));case 38:_context33.prev=38,_context33.t0=_context33.catch(3),console.log("error creating business:",_context33.t0);case 41:case"end":return _context33.stop()}}),_callee33,null,[[3,38]])}))),function updateInfo(_x78,_x79,_x80,_x81,_x82,_x83){return _updateInfo.apply(this,arguments)})},{key:"editBusinessDetails",value:(_editBusinessDetails=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee34(links,access_token,businessId,fields,name){var tokens;return regenerator_default.a.wrap((function _callee34$(_context34){for(;;)switch(_context34.prev=_context34.next){case 0:return _context34.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context34.sent,console.log(fields),_context34.abrupt("return",axios_default()({method:"put",url:"".concat(links.businesses.href,"/").concat(businessId),data:{_embedded:{business:{name:name,profile:{taxRate:parseFloat(fields.taxRate)}}}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){console.log("res",res.data.profile),Store_rootStore.businessStore.setFirstTimeClientSetup(!1),Store_rootStore.businessStore.updateBusinessListProfile(businessId,res.data.profile)})).catch((function(e){console.log("err",e)})));case 5:case"end":return _context34.stop()}}),_callee34)}))),function editBusinessDetails(_x84,_x85,_x86,_x87,_x88){return _editBusinessDetails.apply(this,arguments)})},{key:"getBusinessDetails",value:(_getBusinessDetails=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee35(links,access_token,businessId){var tokens;return regenerator_default.a.wrap((function _callee35$(_context35){for(;;)switch(_context35.prev=_context35.next){case 0:return _context35.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context35.sent,_context35.abrupt("return",axios_default()({method:"get",url:"".concat(links.businesses.href,"/").concat(businessId),headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){console.log("res",res.data._embedded.business),Store_rootStore.businessStore.updateBusinessListProfile(businessId,res.data._embedded.business.profile)})).catch((function(e){console.log("err",e)})));case 4:case"end":return _context35.stop()}}),_callee35)}))),function getBusinessDetails(_x89,_x90,_x91){return _getBusinessDetails.apply(this,arguments)})},{key:"initializeBusiness",value:(_initializeBusiness=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee36(links,access_token,businessId,businessListInstance){return regenerator_default.a.wrap((function _callee36$(_context36){for(;;)switch(_context36.prev=_context36.next){case 0:this.fetchBusinessInviteList(links,businessId,access_token),this.fetchFullBusinessInviteList(links,businessId,access_token,!0),Store_rootStore.businessStore.updateBusinessListProfile(businessId,businessListInstance.profile);case 3:case"end":return _context36.stop()}}),_callee36,this)}))),function initializeBusiness(_x92,_x93,_x94,_x95){return _initializeBusiness.apply(this,arguments)})},{key:"editBusinessConfiguration",value:(_editBusinessConfiguration=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee37(links,access_token,businessId,fields,name){var tokens;return regenerator_default.a.wrap((function _callee37$(_context37){for(;;)switch(_context37.prev=_context37.next){case 0:return _context37.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context37.sent,_context37.abrupt("return",axios_default()({method:"put",url:"".concat(links.businesses.href,"/").concat(businessId),data:{_embedded:{business:{name:name,profile:{operationalExpensesSource:fields.opex||"",salesSource:fields.sales||"",purchasesSource:fields.purchases||"",taxRate:fields.clientFormFields.taxRate||28,address:fields.clientFormFields.address||"",reconciledDays:fields.reconciledDays?parseInt(fields.reconciledDays):null,incomeTax:fields.incomeTax||"",taxAgent:fields.taxAgent||"",payrollTax:fields.payrollTax||"",fringeBenefitTax:fields.fringeBenefitTax||"",dividendWithholdingTax:fields.dividendWithholdingTax||""}}}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){console.log("res??",res),Store_rootStore.businessStore.setFirstTimeClientSetup(!1),Store_rootStore.businessStore.updateBusinessListProfile(businessId,res.data.profile)})).catch((function(e){console.log("err",e)})));case 4:case"end":return _context37.stop()}}),_callee37)}))),function editBusinessConfiguration(_x96,_x97,_x98,_x99,_x100){return _editBusinessConfiguration.apply(this,arguments)})},{key:"editUserDetails",value:(_editUserDetails=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee38(links,access_token,fields,id){var tokens;return regenerator_default.a.wrap((function _callee38$(_context38){for(;;)switch(_context38.prev=_context38.next){case 0:return Store_rootStore.businessStore.editDetailsLoading(!0),_context38.next=3,BusinessService.refreshPracticeCredentials();case 3:return tokens=_context38.sent,_context38.abrupt("return",axios_default()({method:"put",url:"".concat(links.users.href,"/").concat(id),data:{_embedded:{user:{email:fields.email,givenName:fields.givenName,familyName:fields.familyName,displayName:fields.displayName,phoneNumber:fields.phoneNumber}}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){200===res.status&&(Store_rootStore.businessStore.editDetailsLoading(!1),Store_rootStore.authStore.validateUserModal(null),Store_rootStore.authStore.renderEditUserModal(!1),getUser(links,Store_rootStore.authStore.user.uid,tokens).then((function(user){user&&Store_rootStore.authStore.setPracticeUser(user)})))}),(function(rej){return Store_rootStore.businessStore.editDetailsLoading(!1),fields.phoneNumber.includes("+")?rej.response.data&&rej.response.data._embedded.error.message?Store_rootStore.authStore.validateUserModal({error:"invalid/phone-number",message:rej.response.data._embedded.error.message}):void 0:Store_rootStore.authStore.validateUserModal({error:"invalid/phone-number",message:"Please use international Phone number format. ex: +64210000000"})})).catch((function(e){console.log("caught error",e)})));case 5:case"end":return _context38.stop()}}),_callee38)}))),function editUserDetails(_x101,_x102,_x103,_x104){return _editUserDetails.apply(this,arguments)})}]),BusinessService}()),businessStore_BusinessStore=(_dec=mobx_module.action.bound,_dec2=mobx_module.action.bound,_dec3=mobx_module.action.bound,_dec4=mobx_module.action.bound,_dec5=mobx_module.action.bound,_dec6=mobx_module.action.bound,_dec7=mobx_module.action.bound,_dec8=mobx_module.action.bound,_dec9=mobx_module.action.bound,_dec10=mobx_module.action.bound,_dec11=mobx_module.action.bound,_dec12=mobx_module.action.bound,_dec13=mobx_module.action.bound,_dec14=mobx_module.action.bound,_dec15=mobx_module.action.bound,_dec16=mobx_module.action.bound,_dec17=mobx_module.action.bound,_dec18=mobx_module.action.bound,_dec19=mobx_module.action.bound,_dec20=mobx_module.action.bound,_dec21=mobx_module.action.bound,_dec22=mobx_module.action.bound,_dec23=mobx_module.action.bound,_dec24=mobx_module.action.bound,_dec25=mobx_module.action.bound,_dec26=mobx_module.action.bound,_dec27=mobx_module.action.bound,_dec28=mobx_module.action.bound,_dec29=mobx_module.action.bound,_dec30=mobx_module.action.bound,_dec31=mobx_module.action.bound,_dec32=mobx_module.action.bound,_dec33=mobx_module.action.bound,_dec34=mobx_module.action.bound,_dec35=mobx_module.action.bound,_dec36=mobx_module.action.bound,_dec37=mobx_module.action.bound,_dec38=mobx_module.action.bound,_dec39=mobx_module.action.bound,_dec40=mobx_module.action.bound,_dec41=mobx_module.action.bound,_dec42=mobx_module.action.bound,_dec43=mobx_module.action.bound,_dec44=mobx_module.action.bound,_dec45=mobx_module.action.bound,_dec46=mobx_module.action.bound,_dec47=mobx_module.action.bound,_dec48=mobx_module.action.bound,_dec49=mobx_module.action.bound,_dec50=mobx_module.action.bound,_class=function(){function BusinessStore(rootStore){Object(classCallCheck.a)(this,BusinessStore),this.rootStore=void 0,this.fetchBusinessData=void 0,this.createBusinessFromXeroConnection=void 0,this.fetchBusinessInviteList=void 0,this.fetchFullBusinessInviteList=void 0,this.fetchPendingInviteCount=void 0,this.inviteUser=void 0,this.resendInvite=void 0,this.updateInfo=void 0,this.autoCompletePlacesAction=void 0,this.getConnectionProfileData=void 0,this.getBusinessUsers=void 0,this.getPracticeAdvisors=void 0,this.editBusinessDetails=void 0,this.editBusinessConfiguration=void 0,this.editUserDetails=void 0,this.pingProxyServer=void 0,this.inviteUserFromSuggested=void 0,this.inviteAdvisor=void 0,this.getBusinessesFromAdvisor=void 0,this.addAdvisorToBusiness=void 0,this.removeAdvisorFromBusiness=void 0,this.activateSubscription=void 0,this.fetchSubscription=void 0,this.cancelSubscription=void 0,this.confirmSubscription=void 0,this.initiateSubscription=void 0,this.deleteSubscription=void 0,this.disconnectBusiness=void 0,this.fetchAdvisorInvitationList=void 0,this.resendInviteAsAdvisor=void 0,this.getBusinessApps=void 0,this.getBusinessDetails=void 0,this.initializeBusiness=void 0,this.fetchBusinessDataWithUserId=void 0,this.fetchBusinessAccessTokens=void 0,Object(initializerDefineProperty.a)(this,"selectedBusinessData",_descriptor,this),Object(initializerDefineProperty.a)(this,"advisorsLoading",_descriptor2,this),Object(initializerDefineProperty.a)(this,"subscription",_descriptor3,this),Object(initializerDefineProperty.a)(this,"initSubscription",_descriptor4,this),Object(initializerDefineProperty.a)(this,"selectedBusinessUsers",_descriptor5,this),Object(initializerDefineProperty.a)(this,"selectedBusinessId",_descriptor6,this),Object(initializerDefineProperty.a)(this,"practiceUsers",_descriptor7,this),Object(initializerDefineProperty.a)(this,"activeUser",_descriptor8,this),Object(initializerDefineProperty.a)(this,"selectedBusinessAccessToken",_descriptor9,this),Object(initializerDefineProperty.a)(this,"tokenCache",_descriptor10,this),Object(initializerDefineProperty.a)(this,"currentConnection",_descriptor11,this),Object(initializerDefineProperty.a)(this,"proxyStatus",_descriptor12,this),Object(initializerDefineProperty.a)(this,"businessListData",_descriptor13,this),Object(initializerDefineProperty.a)(this,"businessListDetail",_descriptor14,this),Object(initializerDefineProperty.a)(this,"businessInvitationList",_descriptor15,this),Object(initializerDefineProperty.a)(this,"loading",_descriptor16,this),Object(initializerDefineProperty.a)(this,"inviteUserModalOpen",_descriptor17,this),Object(initializerDefineProperty.a)(this,"configureBusinessModalOpen",_descriptor18,this),Object(initializerDefineProperty.a)(this,"autoCompletePlaces",_descriptor19,this),Object(initializerDefineProperty.a)(this,"setUpBusinessModalOpen",_descriptor20,this),Object(initializerDefineProperty.a)(this,"acceptedInvites",_descriptor21,this),Object(initializerDefineProperty.a)(this,"invitations",_descriptor22,this),Object(initializerDefineProperty.a)(this,"advisorInvitations",_descriptor23,this),Object(initializerDefineProperty.a)(this,"xeroDisconnectLink",_descriptor24,this),Object(initializerDefineProperty.a)(this,"invitedUserDetails",_descriptor25,this),Object(initializerDefineProperty.a)(this,"practiceId",_descriptor26,this),Object(initializerDefineProperty.a)(this,"autoCompleteLoading",_descriptor27,this),Object(initializerDefineProperty.a)(this,"isFirstTimeClientSetup",_descriptor28,this),Object(initializerDefineProperty.a)(this,"confirmationWindowIsRendered",_descriptor29,this),Object(initializerDefineProperty.a)(this,"clientConfirmationWindowIsRendered",_descriptor30,this),Object(initializerDefineProperty.a)(this,"isFirstTimeSetup",_descriptor31,this),Object(initializerDefineProperty.a)(this,"editDetailsIsLoading",_descriptor32,this),Object(initializerDefineProperty.a)(this,"businessInviteInitial",_descriptor33,this),Object(initializerDefineProperty.a)(this,"disconnectConfirmation",_descriptor34,this),Object(initializerDefineProperty.a)(this,"clientSyncsForCurrentBusiness",_descriptor35,this),Object(initializerDefineProperty.a)(this,"xeroConnection",_descriptor36,this),Object(initializerDefineProperty.a)(this,"businessApps",_descriptor37,this),Object(initializerDefineProperty.a)(this,"initialFields",_descriptor38,this),Object(initializerDefineProperty.a)(this,"duplicateBusinessName",_descriptor39,this),Object(initializerDefineProperty.a)(this,"reconnectedConnectionName",_descriptor40,this),Object(initializerDefineProperty.a)(this,"businessAppsConnected",_descriptor41,this),Object(initializerDefineProperty.a)(this,"selectedAdvisorsClients",_descriptor42,this),Object(initializerDefineProperty.a)(this,"businessInstance",_descriptor43,this),Object(initializerDefineProperty.a)(this,"dataArray",_descriptor44,this),this.rootStore=rootStore,this.fetchBusinessData=businessService_BusinessService.fetchBusinessData,this.fetchBusinessDataWithUserId=businessService_BusinessService.fetchBusinessDataWithUserId,this.fetchBusinessAccessTokens=businessService_BusinessService.fetchBusinessAccessTokens,this.pingProxyServer=businessService_BusinessService.pingProxyServer,this.createBusinessFromXeroConnection=businessService_BusinessService.createBusinessFromXeroConnection,this.fetchBusinessInviteList=businessService_BusinessService.fetchBusinessInviteList,this.fetchFullBusinessInviteList=businessService_BusinessService.fetchFullBusinessInviteList,this.fetchPendingInviteCount=businessService_BusinessService.fetchPendingInviteCount,this.inviteUser=businessService_BusinessService.inviteUser,this.resendInvite=businessService_BusinessService.resendInvite,this.resendInviteAsAdvisor=businessService_BusinessService.resendInviteAsAdvisor,this.updateInfo=businessService_BusinessService.updateInfo,this.autoCompletePlacesAction=businessService_BusinessService.autoCompletePlaces,this.getConnectionProfileData=businessService_BusinessService.getConnectionProfileData,this.getBusinessUsers=businessService_BusinessService.getBusinessUsers,this.getPracticeAdvisors=businessService_BusinessService.getPracticeAdvisors,this.editBusinessDetails=businessService_BusinessService.editBusinessDetails,this.editBusinessConfiguration=businessService_BusinessService.editBusinessConfiguration,this.editUserDetails=businessService_BusinessService.editUserDetails,this.inviteUserFromSuggested=businessService_BusinessService.inviteUserFromSuggested,this.inviteAdvisor=businessService_BusinessService.inviteAdvisor,this.getBusinessesFromAdvisor=businessService_BusinessService.getBusinessesFromAdvisor,this.addAdvisorToBusiness=businessService_BusinessService.addAdvisorToBusiness,this.removeAdvisorFromBusiness=businessService_BusinessService.removeAdvisorFromBusiness,this.activateSubscription=businessService_BusinessService.activateSubscription,this.fetchSubscription=businessService_BusinessService.fetchSubscription,this.initiateSubscription=businessService_BusinessService.initiateSubscription,this.cancelSubscription=businessService_BusinessService.cancelSubscription,this.confirmSubscription=businessService_BusinessService.confirmSubscription,this.deleteSubscription=businessService_BusinessService.deleteSubscription,this.disconnectBusiness=businessService_BusinessService.disconnectBusiness,this.fetchAdvisorInvitationList=businessService_BusinessService.fetchAdvisorInvitationList,this.getBusinessApps=businessService_BusinessService.getBusinessApps,this.getBusinessDetails=businessService_BusinessService.getBusinessDetails,this.initializeBusiness=businessService_BusinessService.initializeBusiness}var _selectBusiness2,_selectBusiness,_refreshTokensIfExpired,_getBusinessAccessTokenFromCache,_buildAccessTokenCache,_getBusinessAccessToken,_storeData,_storeInvitationList,_storeDetailData;return Object(createClass.a)(BusinessStore,[{key:"setBusinessApps",value:function setBusinessApps(apps){return this.businessApps=apps}},{key:"setBusinessDetailApps",value:function setBusinessDetailApps(apps,id){var appList=apps.filter((function(app){return void 0===app._links.connect}));return console.log("OOOoooooooooooooo",appList),this.businessListDetail.find((function(i){return i.businessId===id})).connectedApps=appList,this.businessAppsConnected=appList}},{key:"setLoading",value:function setLoading(loading){this.loading=loading}},{key:"setInitialFields",value:function setInitialFields(fields){this.initialFields=fields}},{key:"renderDisconnectConfirmation",value:function renderDisconnectConfirmation(isOpen){this.disconnectConfirmation=isOpen}},{key:"storeSubscription",value:function storeSubscription(subscription){console.log("subscription:",subscription),this.subscription=subscription.data._embedded.subscription}},{key:"storeInitSubscription",value:function storeInitSubscription(subscriptionLinks){this.initSubscription=subscriptionLinks}},{key:"fetchAdvisorsLoading",value:function fetchAdvisorsLoading(loading){this.advisorsLoading=loading}},{key:"setProxyStatus",value:function setProxyStatus(status){this.proxyStatus=status}},{key:"renderDuplicateWarning",value:function renderDuplicateWarning(warningForBusinessName){warningForBusinessName||js_cookie_default.a.remove("duplicateConnection"),this.duplicateBusinessName=warningForBusinessName}},{key:"renderReconnectionConfirmation",value:function renderReconnectionConfirmation(warningForBusinessName){warningForBusinessName||js_cookie_default.a.remove("reconnectedConnection"),this.reconnectedConnectionName=warningForBusinessName}},{key:"displayAutoCompletePlaces",value:function displayAutoCompletePlaces(data){data&&data.predictions&&(this.autoCompletePlaces=data.predictions)}},{key:"storeAdvisorsClients",value:function storeAdvisorsClients(clients){var allClients=clients.currentClients.concat(clients.validClients);this.selectedAdvisorsClients={currentClients:clients.currentClients,validClients:clients.validClients,allClients:allClients}}},{key:"updateBusinessListDetail",value:function updateBusinessListDetail(id,notifications,data){var businessDetail=this.businessListDetail.find((function(i){return i.businessId===id}));if(null!==notifications)return businessDetail.unreadNotifications=notifications;if(null!==data&&data._embedded){var _data$_embedded$confi=data._embedded.configuration.entities[0],dataObject={address:_data$_embedded$confi.address,countryCode:_data$_embedded$confi.countryCode,currencyCode:_data$_embedded$confi.currencyCode,financialYearEnd:_data$_embedded$confi.financialYearEnd,lineOfBusiness:_data$_embedded$confi.lineOfBusiness,phoneNumber:_data$_embedded$confi.phoneNumber,salesTaxBasis:_data$_embedded$confi.salesTaxBasis,salesTaxPeriod:_data$_embedded$confi.salesTaxPeriod,shortCode:_data$_embedded$confi.shortCode,taxNumber:_data$_embedded$confi.taxNumber,tenantConnectionId:_data$_embedded$confi.tenantConnectionId,tenantType:_data$_embedded$confi.tenantType,timezoneId:_data$_embedded$confi.timezoneId};return businessDetail.disconnected=data._embedded.configuration.disconnected,this.initialFields=dataObject,businessDetail.data=dataObject}}},{key:"updateBusinessListApps",value:function updateBusinessListApps(id,apps){var businessDetail=this.businessListDetail.find((function(i){return i.businessId===id}));if(null!==apps)return this.selectedBusinessData.connectedApps=apps,businessDetail.connectedApps=apps}},{key:"updateBusinessListProfile",value:function updateBusinessListProfile(id,data){var businessDetail=this.businessListDetail.find((function(i){return i.businessId===id}));if(null!=data){var address=data.address,countryCode=data.countryCode,currencyCode=data.currencyCode,financialYearEnd=data.financialYearEnd,lineOfBusiness=data.lineOfBusiness,phoneNumber=data.phoneNumber,salesTaxBasis=data.salesTaxBasis,salesTaxPeriod=data.salesTaxPeriod,shortCode=data.shortCode,taxNumber=data.taxNumber,tenantConnectionId=data.tenantConnectionId,tenantType=data.tenantType,timezoneId=data.timezoneId,dataObject={taxRate:data.taxRate,address:address,countryCode:countryCode,currencyCode:currencyCode,financialYearEnd:financialYearEnd,lineOfBusiness:lineOfBusiness,phoneNumber:phoneNumber,salesTaxBasis:salesTaxBasis,salesTaxPeriod:salesTaxPeriod,shortCode:shortCode,taxNumber:taxNumber,tenantConnectionId:tenantConnectionId,tenantType:tenantType,timezoneId:timezoneId,salesSource:data.salesSource,purchasesSource:data.purchasesSource,operationalExpensesSource:data.operationalExpensesSource,reconciledDays:data.reconciledDays,incomeTax:data.incomeTax,taxAgent:data.taxAgent,payrollTax:data.payrollTax,fringeBenefitTax:data.fringeBenefitTax,dividendWithholdingTax:data.dividendWithholdingTax};return businessDetail.profile=dataObject}}},{key:"updateBusinessListSync",value:function updateBusinessListSync(users,businessId){var userIds=users.map((function(i){return i.id})),clientSyncs=new firestorter_module.a("clientSync",{queries:function queries(){return userIds.map((function(userId){return{key:"clientSync:".concat(userId,"-").concat(businessId),query:function query(ref){return ref.where("id","==",userId)}}}))}});Object(mobx_module.autorun)((function(){clientSyncs.docs.forEach((function(doc){return console.log("*",doc.id)}))})),this.clientSyncsForCurrentBusiness=clientSyncs}},{key:"updateBusinessListUsers",value:function updateBusinessListUsers(id,data){var businessDetail=this.businessListDetail.find((function(i){return i.businessId===id}));return businessDetail.users=data.businessUsers.filter((function(i){return"advisor"!==i.roleKey})),businessDetail.advisors=data.businessUsers.filter((function(i){return"advisor"===i.roleKey})),businessDetail.advisorsCount=businessDetail.advisors.length,businessDetail.allCount=data.businessUsers.length,this.updateBusinessListSync(businessDetail.users,id),this.setUsersList(businessDetail.users),businessDetail.usersCount=businessDetail.users.length}},{key:"storeInvitationCount",value:function storeInvitationCount(data,id){var businessDetail=this.businessListDetail.find((function(i){return i.businessId===id}));businessDetail.invitesSent=data||[]}},{key:"updatePracticeAdvisors",value:function updatePracticeAdvisors(data){this.activeUser=data._embedded.businessUsers.find((function(i){return i.id===Store_rootStore.authStore.user.uid})),this.practiceUsers.users=data._embedded.businessUsers,this.practiceUsers.userCount=data.count}},{key:"storeDetailData",value:(_storeDetailData=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(data){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:case"end":return _context.stop()}}),_callee)}))),function storeDetailData(_x){return _storeDetailData.apply(this,arguments)})},{key:"storeInvitationList",value:(_storeInvitationList=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(invitationList){return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(Store_rootStore.advisorChatStore.setNewMessageRecievedForSelectedBusiness(!1),void 0===invitationList[0]){_context2.next=5;break}return _context2.abrupt("return",this.businessInvitationList=invitationList[0].filter((function(user){return user.emailAddress!==Store_rootStore.authStore.practiceUser.user.email})));case 5:return _context2.abrupt("return",this.businessInvitationList=invitationList[0]);case 6:case"end":return _context2.stop()}}),_callee2,this)}))),function storeInvitationList(_x2){return _storeInvitationList.apply(this,arguments)})},{key:"setPracticeId",value:function setPracticeId(practiceId){this.practiceId=practiceId}},{key:"renderConfirmationWindow",value:function renderConfirmationWindow(isRendered,data){this.confirmationWindowIsRendered=isRendered,this.invitedUserDetails=data||null}},{key:"renderClientConfirmationWindow",value:function renderClientConfirmationWindow(isRendered){this.clientConfirmationWindowIsRendered=isRendered}},{key:"editDetailsLoading",value:function editDetailsLoading(isLoading){this.editDetailsIsLoading=isLoading}},{key:"autoCompleteIsLoading",value:function autoCompleteIsLoading(loading){this.autoCompleteLoading=loading}},{key:"setFirstTimeClientSetup",value:function setFirstTimeClientSetup(firstTime){this.isFirstTimeClientSetup=firstTime}},{key:"pushDataToDetailArray",value:function pushDataToDetailArray(business){this.businessListDetail.push({businessId:business.id,unreadNotifications:null,data:null,invitesSent:[],profile:business.profile,connectedApps:[{ospKey:"xero",appKey:"accounting"}]})}},{key:"storeData",value:(_storeData=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(data){var businessListResponse,selectedBusinessIdBeforeRefresh,_this=this;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return businessListResponse=data.businesses.sort((function(a,b){var nameA=a.name.toLowerCase(),nameB=b.name.toLowerCase();return nameA<nameB?-1:nameA>nameB?1:0})).map((function(obj){return Object(objectSpread2.a)(Object(objectSpread2.a)({},obj),{},{connectedApps:[]})})),this.dataArray=businessListResponse,this.businessListData=this.businessListData.concat(businessListResponse),this.practiceId=data.businesses.filter((function(i){return"management"===i.businessClass}))[0],selectedBusinessIdBeforeRefresh=js_cookie_default.a.get("selectedBusiness"),this.selectedBusinessId=null!=selectedBusinessIdBeforeRefresh||void 0!==selectedBusinessIdBeforeRefresh?selectedBusinessIdBeforeRefresh:businessListResponse[0].id,this.practiceId.id,_context4.next=10,this.buildAccessTokenCache(businessListResponse);case 10:return _context4.abrupt("return",businessListResponse.map(function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(i,ix,arr){var retrieved_tokens;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,_this.getBusinessAccessTokenFromCache(i.id);case 2:return retrieved_tokens=_context3.sent,_this.pushDataToDetailArray(i),i.id===selectedBusinessIdBeforeRefresh&&(_this.rootStore.conversationStore.getProactiveMessages(_this.rootStore.authStore.links,retrieved_tokens.access_token,i.id),Store_rootStore.conversationStore.getUnreadProactiveMessagesNoLoad(Store_rootStore.authStore.links,retrieved_tokens.access_token,i.id),_this.selectBusiness2(i.id,(function(){}),retrieved_tokens.access_token)),0!==ix||selectedBusinessIdBeforeRefresh||(_this.rootStore.conversationStore.getProactiveMessages(_this.rootStore.authStore.links,retrieved_tokens.access_token,i.id),Store_rootStore.conversationStore.getUnreadProactiveMessagesNoLoad(Store_rootStore.authStore.links,retrieved_tokens.access_token,i.id),("management"!==i.businessClass||1===arr.length)&&_this.selectBusiness2(i.id,(function(){}),retrieved_tokens.access_token)),Store_rootStore.businessStore.getConnectionProfileData(_this.rootStore.authStore.links,retrieved_tokens.access_token,{id:i.id,name:"NA"}),Store_rootStore.conversationStore.getUnreadProactiveMessagesNoLoad(Store_rootStore.authStore.links,retrieved_tokens.access_token,i.id),_context3.next=10,_this.rootStore.businessStore.getBusinessUsers(_this.rootStore.authStore.links,retrieved_tokens.access_token,{id:i.id});case 10:return"management"===arr[0].businessClass&&1===ix&&"management"!==i.businessClass&&_this.selectBusiness2(i.id,(function(){}),retrieved_tokens.access_token),_context3.abrupt("return",!0);case 12:case"end":return _context3.stop()}}),_callee3)})));return function(_x4,_x5,_x6){return _ref.apply(this,arguments)}}()));case 11:case"end":return _context4.stop()}}),_callee4,this)}))),function storeData(_x3){return _storeData.apply(this,arguments)})},{key:"setConnectionSettings",value:function setConnectionSettings(data){this.currentConnection=data._embedded}},{key:"setXeroConnection",value:function setXeroConnection(xeroConnection,otherData){this.xeroConnection=xeroConnection,this.xeroDisconnectLink=xeroConnection?xeroConnection._links.disconnect.href:null}},{key:"getBusinessAccessToken",value:(_getBusinessAccessToken=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee5(id){var access;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(void 0!==(access=this.rootStore.authStore.getBusinessToken(id))){_context5.next=3;break}return _context5.abrupt("return",this.rootStore.authStore.initializeNewBusinessTokens(id).then((function(res){return res.access_token})));case 3:return _context5.abrupt("return",access);case 4:case"end":return _context5.stop()}}),_callee5,this)}))),function getBusinessAccessToken(_x7){return _getBusinessAccessToken.apply(this,arguments)})},{key:"buildAccessTokenCache",value:(_buildAccessTokenCache=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee6(businesses){var cache;return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return cache=businesses.map((function(business){return Store_rootStore.authStore.checkOutstandingConnectionClaim(business.id),{id:business.id,tokens:business._embedded.tokens}})),this.tokenCache=cache,Store_rootStore.authStore.tokenRegistry=cache,_context6.abrupt("return",cache);case 4:case"end":return _context6.stop()}}),_callee6,this)}))),function buildAccessTokenCache(_x8){return _buildAccessTokenCache.apply(this,arguments)})},{key:"getBusinessAccessTokenFromCache",value:(_getBusinessAccessTokenFromCache=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee7(id){var businessRegistry,expiry,_this2=this;return regenerator_default.a.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(void 0===(businessRegistry=this.tokenCache.find((function(i){return i.id===id})))){_context7.next=7;break}if(expiry=businessRegistry.tokens.expiresAt=Math.floor(Date.now()/1e3)+businessRegistry.tokens.expires_in,!(new Date(1e3*parseInt(expiry))>new Date)){_context7.next=5;break}return _context7.abrupt("return",businessRegistry.tokens);case 5:return refreshTokensVerbose(Store_rootStore.authStore.links,businessRegistry.tokens).then((function(updatedTokens){var registryExists=_this2.tokenCache.find((function(registry){return registry.id===id}));return Store_rootStore.businessStore.setBusinessAccessToken(updatedTokens.access_token),registryExists.tokens=updatedTokens})),_context7.abrupt("return",businessRegistry.tokens);case 7:return _context7.abrupt("return",null);case 8:case"end":return _context7.stop()}}),_callee7,this)}))),function getBusinessAccessTokenFromCache(_x9){return _getBusinessAccessTokenFromCache.apply(this,arguments)})},{key:"setBusinessAccessToken",value:function setBusinessAccessToken(access){this.selectedBusinessAccessToken=access}},{key:"setSelectedBusinessId",value:function setSelectedBusinessId(id){this.selectedBusinessId=id}},{key:"setSelectedBusinessData",value:function setSelectedBusinessData(businessData){this.selectedBusinessData=Object(objectSpread2.a)({},businessData)}},{key:"shouldInviteUser",value:function shouldInviteUser(modalOpen){modalOpen||(this.businessInviteInitial=!1,this.selectBusiness2(Store_rootStore.businessStore.selectedBusinessId,(function(){}))),this.inviteUserModalOpen=modalOpen}},{key:"setBusinessFirstTimeSetup",value:function setBusinessFirstTimeSetup(isFirstTime){this.isFirstTimeSetup=isFirstTime}},{key:"shouldConfigureBusiness",value:function shouldConfigureBusiness(modalOpen){this.configureBusinessModalOpen=modalOpen}},{key:"shouldSetUpPractice",value:function shouldSetUpPractice(modalOpen){this.setUpBusinessModalOpen=modalOpen}},{key:"setInvitations",value:function setInvitations(data){this.invitations=data}},{key:"addToInvitations",value:function addToInvitations(data){this.invitations={pendingInvitations:[].concat(Object(toConsumableArray.a)(this.invitations.pendingInvitations),[data]),acceptedInvitations:[],cancelledInvitations:[]}}},{key:"storeInvitationListSplit",value:function storeInvitationListSplit(data){if(data){var pendingInvitations=data.filter((function(invitee){return"pending"===invitee.status}));data.filter((function(invitee){return"accepted"===invitee.status})),data.filter((function(invitee){return"cancelled"===invitee.status}));this.invitations={pendingInvitations:pendingInvitations,acceptedInvitations:[],cancelledInvitations:[]}}else this.invitations={pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}}},{key:"storeAdvisorInvitations",value:function storeAdvisorInvitations(data){var pendingInvitations=data.filter((function(invitee){return"pending"===invitee.status}));data.filter((function(invitee){return"accepted"===invitee.status})),data.filter((function(invitee){return"cancelled"===invitee.status}));this.advisorInvitations={pendingInvitations:pendingInvitations,acceptedInvitations:[],cancelledInvitations:[]}}},{key:"refreshTokensIfExpired",value:(_refreshTokensIfExpired=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee8(id){return regenerator_default.a.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.abrupt("return",this.getBusinessAccessTokenFromCache(id));case 1:case"end":return _context8.stop()}}),_callee8,this)}))),function refreshTokensIfExpired(_x10){return _refreshTokensIfExpired.apply(this,arguments)})},{key:"setUsersList",value:function setUsersList(users){this.selectedBusinessUsers=users}},{key:"selectBusiness",value:(_selectBusiness=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee9(id,callback){var updatedTokens,usersData,filteredUsers,businessData,_this3=this;return regenerator_default.a.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.prev=0,this.rootStore.advisorChatStore.setIsReloading(!1),Store_rootStore.advisorChatStore.setNewMessageRecievedForSelectedBusiness(!1),this.setSelectedBusinessId(id),this.rootStore.conversationStore.clearConversationData(""),this.rootStore.conversationStore.setMessagesLoading(!0),this.rootStore.conversationStore.setNotificationsLoading(!0),_context9.next=9,this.refreshTokensIfExpired(id);case 9:return updatedTokens=_context9.sent,_context9.next=12,this.getBusinessApps(this.rootStore.authStore.links,updatedTokens.access_token,id);case 12:return this.fetchBusinessInviteList(this.rootStore.authStore.links,id,updatedTokens.access_token),this.fetchFullBusinessInviteList(this.rootStore.authStore.links,id,updatedTokens.access_token,!0),this.rootStore.conversationStore.getActiveConversation(this.rootStore.authStore.links,updatedTokens.access_token),this.rootStore.conversationStore.getProactiveMessages(this.rootStore.authStore.links,updatedTokens.access_token,id),this.rootStore.conversationStore.getFavoriteMessages(this.rootStore.authStore.links,updatedTokens.access_token,id),this.rootStore.conversationStore.getUnreadProactiveMessagesNoLoad(this.rootStore.authStore.links,updatedTokens.access_token,id),this.rootStore.businessStore.getConnectionProfileData(this.rootStore.authStore.links,updatedTokens.access_token,{id:id,name:"NA"}),_context9.next=21,this.rootStore.businessStore.getBusinessUsers(this.rootStore.authStore.links,updatedTokens.access_token,{id:id});case 21:usersData=_context9.sent,(filteredUsers=usersData._embedded.businessUsers.filter((function(i){return"advisor"!==i.roleKey||"".concat(i.givenName," ").concat(i.familyName)!=="".concat(Store_rootStore.authStore.practiceUser.user.givenName," ").concat(Store_rootStore.authStore.practiceUser.user.familyName)}))).map((function(user){return user.status="accepted"})),this.setBusinessAccessToken(updatedTokens.access_token),businessData=this.businessListData.find((function(i){return i.id===_this3.selectedBusinessId})),this.setSelectedBusinessData(businessData),Store_rootStore.businessStore.businessListDetail.find((function(i){return i.businessId===id})),filteredUsers?this.setUsersList(filteredUsers):this.setUsersList([]),Store_rootStore.advisorChatStore.setSelectedUserIdToRefresh(null),Store_rootStore.advisorChatStore.setSelectedConversationToRefresh(null),Store_rootStore.advisorChatStore.setSelectedConversationNameToRefresh(null),Store_rootStore.advisorChatStore.storeConversation(null),this.rootStore.advisorChatStore.getChats(),Store_rootStore.advisorChatStore.setNewMessageRecievedForSelectedBusiness(!1),this.setLoading(!1),_context9.next=41;break;case 38:_context9.prev=38,_context9.t0=_context9.catch(0),console.log("error select:",_context9.t0);case 41:case"end":return _context9.stop()}}),_callee9,this,[[0,38]])}))),function selectBusiness(_x11,_x12){return _selectBusiness.apply(this,arguments)})},{key:"selectBusiness2",value:(_selectBusiness2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee10(id,callback){var access_token,updatedTokens,usersData,filteredUsers,businessData,_this4=this,_args10=arguments;return regenerator_default.a.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(access_token=_args10.length>2&&void 0!==_args10[2]?_args10[2]:null,this.rootStore.conversationStore.setMessagesLoading(!0),this.rootStore.conversationStore.setNotificationsLoading(!0),!access_token){_context10.next=7;break}updatedTokens={access_token:access_token},_context10.next=10;break;case 7:return _context10.next=9,this.getBusinessAccessTokenFromCache(id);case 9:updatedTokens=_context10.sent;case 10:return this.setBusinessAccessToken(updatedTokens.access_token),Store_rootStore.advisorChatStore.setNewMessageRecievedForSelectedBusiness(!1),this.setSelectedBusinessId(id),this.rootStore.conversationStore.clearConversationData(""),_context10.next=16,this.getBusinessApps(this.rootStore.authStore.links,updatedTokens.access_token,id);case 16:return this.fetchBusinessInviteList(this.rootStore.authStore.links,id,updatedTokens.access_token),this.fetchFullBusinessInviteList(this.rootStore.authStore.links,id,updatedTokens.access_token,!0),this.rootStore.businessStore.getConnectionProfileData(this.rootStore.authStore.links,updatedTokens.access_token,{id:id,name:"NA"}),this.rootStore.conversationStore.getActiveConversation(this.rootStore.authStore.links,updatedTokens.access_token),this.rootStore.conversationStore.getProactiveMessages(this.rootStore.authStore.links,updatedTokens.access_token,id),this.rootStore.conversationStore.getFavoriteMessages(this.rootStore.authStore.links,updatedTokens.access_token,id),this.rootStore.businessStore.getConnectionProfileData(this.rootStore.authStore.links,updatedTokens.access_token,{id:id,name:"NA"}),_context10.next=25,this.rootStore.businessStore.getBusinessUsers(this.rootStore.authStore.links,updatedTokens.access_token,{id:id});case 25:(usersData=_context10.sent)?((filteredUsers=usersData._embedded.businessUsers.filter((function(i){return"advisor"!==i.roleKey||"".concat(i.givenName," ").concat(i.familyName)!=="".concat(Store_rootStore.authStore.practiceUser.user.givenName," ").concat(Store_rootStore.authStore.practiceUser.user.familyName)}))).map((function(user){return user.status="accepted"})),filteredUsers?this.setUsersList(filteredUsers):this.setUsersList([])):this.setUsersList([]),businessData=this.businessListData.find((function(i){return i.id===_this4.selectedBusinessId})),this.setSelectedBusinessData(businessData),Store_rootStore.advisorChatStore.setSelectedUserIdToRefresh(null),Store_rootStore.advisorChatStore.setSelectedConversationToRefresh(null),Store_rootStore.advisorChatStore.setSelectedConversationNameToRefresh(null),Store_rootStore.advisorChatStore.storeConversation(null),Store_rootStore.advisorChatStore.setNewMessageRecievedForSelectedBusiness(!1),this.setLoading(!1),this.rootStore.advisorChatStore.setIsReloading(!1),this.rootStore.conversationStore.setMessagesLoading(!1);case 37:case"end":return _context10.stop()}}),_callee10,this)}))),function selectBusiness2(_x13,_x14){return _selectBusiness2.apply(this,arguments)})},{key:"selectBusinessAfterClaimingConnection",value:function selectBusinessAfterClaimingConnection(id,access_token){var _this5=this;console.log("_____SELECT",id),this.businessInviteInitial=!0,this.setInitialFields({taxRate:"",lineOfBusiness:"",taxNumber:"",salesTaxBasis:"",salesTaxPeriod:"",financialYearEnd:"",address:"  ",operationalExpensesSource:"",salesSource:"",purchasesSource:"",reconciledDays:"",incomeTax:"",taxAgent:"",payrollTax:"",fringeBenefitTax:"",dividendWithholdingTax:"",disconnected:!1}),this.setLoading(!0),this.setSelectedBusinessId(id),this.setBusinessAccessToken(access_token),this.rootStore.conversationStore.clearConversationData(""),this.rootStore.conversationStore.setMessagesLoading(!0),this.rootStore.conversationStore.setNotificationsLoading(!0);Store_rootStore.businessStore.businessListDetail.find((function(i){return i.businessId===id}));var businessData=this.businessListData.find((function(i){return i.id===id}));this.rootStore.conversationStore.getActiveConversation(this.rootStore.authStore.links,access_token),this.rootStore.conversationStore.getProactiveMessages(this.rootStore.authStore.links,access_token,id),this.rootStore.conversationStore.getUnreadProactiveMessagesNoLoad(Store_rootStore.authStore.links,access_token,id),this.rootStore.businessStore.getConnectionProfileData(Store_rootStore.authStore.links,access_token,businessData),this.fetchBusinessInviteList(this.rootStore.authStore.links,id,access_token,!0).then((function(invites){invites&&_this5.setInvitations([])})).catch((function(rej){_this5.setInvitations([])})),Store_rootStore.advisorChatStore.setSelectedUserIdToRefresh(null),Store_rootStore.advisorChatStore.setSelectedConversationToRefresh(null),Store_rootStore.advisorChatStore.setSelectedConversationNameToRefresh(null),Store_rootStore.advisorChatStore.storeConversation(null),this.rootStore.advisorChatStore.getChats(),this.setSelectedBusinessData(businessData),this.setLoading(!1)}}]),BusinessStore}(),_descriptor=Object(applyDecoratedDescriptor.a)(_class.prototype,"selectedBusinessData",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{id:0,name:"Loading...",inbox:1,apps:2,data_is_shared:!0,selected:!0,notifications:[],connectedApps:[]}}}),_descriptor2=Object(applyDecoratedDescriptor.a)(_class.prototype,"advisorsLoading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor3=Object(applyDecoratedDescriptor.a)(_class.prototype,"subscription",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),_descriptor4=Object(applyDecoratedDescriptor.a)(_class.prototype,"initSubscription",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),_descriptor5=Object(applyDecoratedDescriptor.a)(_class.prototype,"selectedBusinessUsers",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_descriptor6=Object(applyDecoratedDescriptor.a)(_class.prototype,"selectedBusinessId",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor7=Object(applyDecoratedDescriptor.a)(_class.prototype,"practiceUsers",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{userCount:0,users:null}}}),_descriptor8=Object(applyDecoratedDescriptor.a)(_class.prototype,"activeUser",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{roleKey:null}}}),_descriptor9=Object(applyDecoratedDescriptor.a)(_class.prototype,"selectedBusinessAccessToken",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor10=Object(applyDecoratedDescriptor.a)(_class.prototype,"tokenCache",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_descriptor11=Object(applyDecoratedDescriptor.a)(_class.prototype,"currentConnection",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_descriptor12=Object(applyDecoratedDescriptor.a)(_class.prototype,"proxyStatus",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor13=Object(applyDecoratedDescriptor.a)(_class.prototype,"businessListData",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_descriptor14=Object(applyDecoratedDescriptor.a)(_class.prototype,"businessListDetail",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_descriptor15=Object(applyDecoratedDescriptor.a)(_class.prototype,"businessInvitationList",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_descriptor16=Object(applyDecoratedDescriptor.a)(_class.prototype,"loading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor17=Object(applyDecoratedDescriptor.a)(_class.prototype,"inviteUserModalOpen",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor18=Object(applyDecoratedDescriptor.a)(_class.prototype,"configureBusinessModalOpen",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor19=Object(applyDecoratedDescriptor.a)(_class.prototype,"autoCompletePlaces",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_descriptor20=Object(applyDecoratedDescriptor.a)(_class.prototype,"setUpBusinessModalOpen",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor21=Object(applyDecoratedDescriptor.a)(_class.prototype,"acceptedInvites",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_descriptor22=Object(applyDecoratedDescriptor.a)(_class.prototype,"invitations",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),_descriptor23=Object(applyDecoratedDescriptor.a)(_class.prototype,"advisorInvitations",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),_descriptor24=Object(applyDecoratedDescriptor.a)(_class.prototype,"xeroDisconnectLink",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor25=Object(applyDecoratedDescriptor.a)(_class.prototype,"invitedUserDetails",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor26=Object(applyDecoratedDescriptor.a)(_class.prototype,"practiceId",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),_descriptor27=Object(applyDecoratedDescriptor.a)(_class.prototype,"autoCompleteLoading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor28=Object(applyDecoratedDescriptor.a)(_class.prototype,"isFirstTimeClientSetup",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor29=Object(applyDecoratedDescriptor.a)(_class.prototype,"confirmationWindowIsRendered",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor30=Object(applyDecoratedDescriptor.a)(_class.prototype,"clientConfirmationWindowIsRendered",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor31=Object(applyDecoratedDescriptor.a)(_class.prototype,"isFirstTimeSetup",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor32=Object(applyDecoratedDescriptor.a)(_class.prototype,"editDetailsIsLoading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor33=Object(applyDecoratedDescriptor.a)(_class.prototype,"businessInviteInitial",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor34=Object(applyDecoratedDescriptor.a)(_class.prototype,"disconnectConfirmation",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor35=Object(applyDecoratedDescriptor.a)(_class.prototype,"clientSyncsForCurrentBusiness",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor36=Object(applyDecoratedDescriptor.a)(_class.prototype,"xeroConnection",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),_descriptor37=Object(applyDecoratedDescriptor.a)(_class.prototype,"businessApps",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_descriptor38=Object(applyDecoratedDescriptor.a)(_class.prototype,"initialFields",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor39=Object(applyDecoratedDescriptor.a)(_class.prototype,"duplicateBusinessName",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor40=Object(applyDecoratedDescriptor.a)(_class.prototype,"reconnectedConnectionName",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor41=Object(applyDecoratedDescriptor.a)(_class.prototype,"businessAppsConnected",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),_descriptor42=Object(applyDecoratedDescriptor.a)(_class.prototype,"selectedAdvisorsClients",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{currentClients:[],validClients:[],allClients:[]}}}),_descriptor43=Object(applyDecoratedDescriptor.a)(_class.prototype,"businessInstance",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),Object(applyDecoratedDescriptor.a)(_class.prototype,"setBusinessApps",[_dec],Object.getOwnPropertyDescriptor(_class.prototype,"setBusinessApps"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setBusinessDetailApps",[_dec2],Object.getOwnPropertyDescriptor(_class.prototype,"setBusinessDetailApps"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setLoading",[_dec3],Object.getOwnPropertyDescriptor(_class.prototype,"setLoading"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setInitialFields",[_dec4],Object.getOwnPropertyDescriptor(_class.prototype,"setInitialFields"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"renderDisconnectConfirmation",[_dec5],Object.getOwnPropertyDescriptor(_class.prototype,"renderDisconnectConfirmation"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"storeSubscription",[_dec6],Object.getOwnPropertyDescriptor(_class.prototype,"storeSubscription"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"storeInitSubscription",[_dec7],Object.getOwnPropertyDescriptor(_class.prototype,"storeInitSubscription"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"fetchAdvisorsLoading",[_dec8],Object.getOwnPropertyDescriptor(_class.prototype,"fetchAdvisorsLoading"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setProxyStatus",[_dec9],Object.getOwnPropertyDescriptor(_class.prototype,"setProxyStatus"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"renderDuplicateWarning",[_dec10],Object.getOwnPropertyDescriptor(_class.prototype,"renderDuplicateWarning"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"renderReconnectionConfirmation",[_dec11],Object.getOwnPropertyDescriptor(_class.prototype,"renderReconnectionConfirmation"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"displayAutoCompletePlaces",[_dec12],Object.getOwnPropertyDescriptor(_class.prototype,"displayAutoCompletePlaces"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"storeAdvisorsClients",[_dec13],Object.getOwnPropertyDescriptor(_class.prototype,"storeAdvisorsClients"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"updateBusinessListDetail",[_dec14],Object.getOwnPropertyDescriptor(_class.prototype,"updateBusinessListDetail"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"updateBusinessListApps",[_dec15],Object.getOwnPropertyDescriptor(_class.prototype,"updateBusinessListApps"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"updateBusinessListProfile",[_dec16],Object.getOwnPropertyDescriptor(_class.prototype,"updateBusinessListProfile"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"updateBusinessListSync",[_dec17],Object.getOwnPropertyDescriptor(_class.prototype,"updateBusinessListSync"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"updateBusinessListUsers",[_dec18],Object.getOwnPropertyDescriptor(_class.prototype,"updateBusinessListUsers"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"storeInvitationCount",[_dec19],Object.getOwnPropertyDescriptor(_class.prototype,"storeInvitationCount"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"updatePracticeAdvisors",[_dec20],Object.getOwnPropertyDescriptor(_class.prototype,"updatePracticeAdvisors"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"storeDetailData",[_dec21],Object.getOwnPropertyDescriptor(_class.prototype,"storeDetailData"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"storeInvitationList",[_dec22],Object.getOwnPropertyDescriptor(_class.prototype,"storeInvitationList"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setPracticeId",[_dec23],Object.getOwnPropertyDescriptor(_class.prototype,"setPracticeId"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"renderConfirmationWindow",[_dec24],Object.getOwnPropertyDescriptor(_class.prototype,"renderConfirmationWindow"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"renderClientConfirmationWindow",[_dec25],Object.getOwnPropertyDescriptor(_class.prototype,"renderClientConfirmationWindow"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"editDetailsLoading",[_dec26],Object.getOwnPropertyDescriptor(_class.prototype,"editDetailsLoading"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"autoCompleteIsLoading",[_dec27],Object.getOwnPropertyDescriptor(_class.prototype,"autoCompleteIsLoading"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setFirstTimeClientSetup",[_dec28],Object.getOwnPropertyDescriptor(_class.prototype,"setFirstTimeClientSetup"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"pushDataToDetailArray",[_dec29],Object.getOwnPropertyDescriptor(_class.prototype,"pushDataToDetailArray"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"storeData",[_dec30],Object.getOwnPropertyDescriptor(_class.prototype,"storeData"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setConnectionSettings",[_dec31],Object.getOwnPropertyDescriptor(_class.prototype,"setConnectionSettings"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setXeroConnection",[_dec32],Object.getOwnPropertyDescriptor(_class.prototype,"setXeroConnection"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"buildAccessTokenCache",[_dec33],Object.getOwnPropertyDescriptor(_class.prototype,"buildAccessTokenCache"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"getBusinessAccessTokenFromCache",[_dec34],Object.getOwnPropertyDescriptor(_class.prototype,"getBusinessAccessTokenFromCache"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setBusinessAccessToken",[_dec35],Object.getOwnPropertyDescriptor(_class.prototype,"setBusinessAccessToken"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setSelectedBusinessId",[_dec36],Object.getOwnPropertyDescriptor(_class.prototype,"setSelectedBusinessId"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setSelectedBusinessData",[_dec37],Object.getOwnPropertyDescriptor(_class.prototype,"setSelectedBusinessData"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"shouldInviteUser",[_dec38],Object.getOwnPropertyDescriptor(_class.prototype,"shouldInviteUser"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setBusinessFirstTimeSetup",[_dec39],Object.getOwnPropertyDescriptor(_class.prototype,"setBusinessFirstTimeSetup"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"shouldConfigureBusiness",[_dec40],Object.getOwnPropertyDescriptor(_class.prototype,"shouldConfigureBusiness"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"shouldSetUpPractice",[_dec41],Object.getOwnPropertyDescriptor(_class.prototype,"shouldSetUpPractice"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setInvitations",[_dec42],Object.getOwnPropertyDescriptor(_class.prototype,"setInvitations"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"addToInvitations",[_dec43],Object.getOwnPropertyDescriptor(_class.prototype,"addToInvitations"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"storeInvitationListSplit",[_dec44],Object.getOwnPropertyDescriptor(_class.prototype,"storeInvitationListSplit"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"storeAdvisorInvitations",[_dec45],Object.getOwnPropertyDescriptor(_class.prototype,"storeAdvisorInvitations"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"refreshTokensIfExpired",[_dec46],Object.getOwnPropertyDescriptor(_class.prototype,"refreshTokensIfExpired"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"setUsersList",[_dec47],Object.getOwnPropertyDescriptor(_class.prototype,"setUsersList"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"selectBusiness",[_dec48],Object.getOwnPropertyDescriptor(_class.prototype,"selectBusiness"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"selectBusiness2",[_dec49],Object.getOwnPropertyDescriptor(_class.prototype,"selectBusiness2"),_class.prototype),Object(applyDecoratedDescriptor.a)(_class.prototype,"selectBusinessAfterClaimingConnection",[_dec50],Object.getOwnPropertyDescriptor(_class.prototype,"selectBusinessAfterClaimingConnection"),_class.prototype),_descriptor44=Object(applyDecoratedDescriptor.a)(_class.prototype,"dataArray",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[{id:0},{id:2}]}}),_class),conversationService_ConversationService=function(){function ConversationService(){Object(classCallCheck.a)(this,ConversationService)}var _refreshAuth,_provideFeedback,_favoriteNotification,_removeMessageFromFavorites,_markNotificiation,_runCashflowCheckMessageAction,_runDirectMessageAction,_scheduleMessageAction,_runGSTPayable,_runIncomeTaxEstimate,_runKeyDatesMessageAction,_scheduleReconciliationMessageAction,_getUnreadProactiveMessagesNoLoad,_cancelScheduledMessage,_getManagedFeed,_getPreviousMessagesFromTimestamp,_resumeActiveConversationFromMessage,_scheduleMessage,_startConversationViaAlternative;return Object(createClass.a)(ConversationService,null,[{key:"startConversationAction",value:function startConversationAction(query,links,access_token){Store_rootStore.conversationStore.setResponseLoading(!0),Store_rootStore.registerGAEvent("sendMessage"),makePostRequest("".concat(links.initiateConversation.href,"?query=").concat(query),{Authorization:"Bearer ".concat(access_token)},{}).then((function(data){Store_rootStore.conversationStore.storeConversationData(data,Store_rootStore.businessStore.selectedBusinessId).then((function(res){Store_rootStore.authStore.setLoading(!1)}),(function(e){console.log(e),Store_rootStore.conversationStore.setResponseLoading(!1)}))}),(function(error){Store_rootStore.registerGAEvent("otherError"),Store_rootStore.conversationStore.setResponseLoading(!1),console.log("err:",error)})).catch((function(e){esm.a(e),console.log("other error",e),Store_rootStore.conversationStore.setResponseLoading(!1)}))}},{key:"startConversationViaAlternative",value:(_startConversationViaAlternative=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(query,links,access_token,intentKey){var tokens;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return console.log(".intent",intentKey),_context.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:return tokens=_context.sent,Store_rootStore.conversationStore.setResponseLoading(!0),Store_rootStore.registerGAEvent("sendMessage"),_context.abrupt("return",axios_default()({method:"post",url:"".concat(links.initiateConversation.href,"/active/messages?action=").concat(intentKey,"&text=").concat(query),data:"finance-income-tax-estimate"===intentKey?{_embedded:{parameters:{"date-period":{analyzedDatePeriod:{tense:"past",granularity:"month",offset:0,span:1}}}}}:{},headers:{"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z",Authorization:"Bearer ".concat(tokens.access_token)}}).then((function(data){Store_rootStore.conversationStore.storeConversationData(data.data,Store_rootStore.businessStore.selectedBusinessId).then((function(res){Store_rootStore.authStore.setLoading(!1)}),(function(e){console.log(e),Store_rootStore.conversationStore.setResponseLoading(!1)}))}),(function(error){Store_rootStore.registerGAEvent("otherError"),Store_rootStore.conversationStore.setResponseLoading(!1),console.log("err:",error)})).catch((function(e){esm.a(e),console.log("other error",e),Store_rootStore.conversationStore.setResponseLoading(!1)})));case 7:case"end":return _context.stop()}}),_callee)}))),function startConversationViaAlternative(_x,_x2,_x3,_x4){return _startConversationViaAlternative.apply(this,arguments)})},{key:"continueConversationAction",value:function continueConversationAction(query,links,access_token,conversationId,isAdvisorSent){var intentBody={};"cashflow check"!==query&&"Income tax estimate"!==query||!isAdvisorSent||(intentBody={_embedded:{parameters:{"date-period":{analyzedDatePeriod:{tense:"past",granularity:"month",offset:0,span:1}}}}}),Store_rootStore.conversationStore.setResponseLoading(!0),makePostRequest("".concat(links.initiateConversation.href,"/").concat(conversationId,"/messages?query=").concat(query),{Authorization:"Bearer ".concat(access_token)},intentBody).then((function(data){data&&Store_rootStore.conversationStore.storeConversationData(data,Store_rootStore.businessStore.selectedBusinessId).then((function(res){Store_rootStore.authStore.setLoading(!1)}),(function(e){console.log(e),Store_rootStore.conversationStore.setResponseLoading(!0)}))}),(function(error){console.log("err:",error)})).catch((function(e){esm.a(e),Store_rootStore.conversationStore.setResponseLoading(!1)}))}},{key:"getActiveConversation",value:function getActiveConversation(links,access_token){Store_rootStore.conversationStore.setMessagesLoading(!0),makeGetRequest("".concat(links.resumeConversation.href),{Authorization:"Bearer ".concat(access_token)}).then((function(data){Store_rootStore.conversationStore.storeConversationData(data,null).then((function(res){Store_rootStore.conversationStore.setMessagesLoading(!1)}),(function(e){console.log(e),Store_rootStore.conversationStore.setMessagesLoading(!0)}))}),(function(error){console.log("err:",error)})).catch((function(e){esm.a(e),Store_rootStore.conversationStore.setMessagesLoading(!1)}))}},{key:"scheduleMessage",value:(_scheduleMessage=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(links,access_token,conversationId,messageId,timestamp){var tokens;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:tokens=_context2.sent,Store_rootStore.authStore.Intercom("trackEvent","scheduled-favourite",{business_id:Store_rootStore.businessStore.selectedBusinessId}),Store_rootStore.conversationStore.setMessagesLoading(!0),makePostRequest("".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/").concat(conversationId,"/messages/").concat(messageId,"/scheduled"),{Authorization:"Bearer ".concat(tokens.access_token)},{afterTimestamp:timestamp}).then((function(data){Store_rootStore.conversationStore.setScheduledMessage(data,messageId).then((function(res){Store_rootStore.conversationStore.setMessagesLoading(!1)}),(function(e){console.log(e),Store_rootStore.conversationStore.setMessagesLoading(!0)}))}),(function(error){console.log("err:",error)}));case 6:case"end":return _context2.stop()}}),_callee2)}))),function scheduleMessage(_x5,_x6,_x7,_x8,_x9){return _scheduleMessage.apply(this,arguments)})},{key:"resumeActiveConversationFromMessage",value:(_resumeActiveConversationFromMessage=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(links,access_token,conversationId,messageId){var tokens;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:tokens=_context3.sent,makePostRequest("".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/").concat(conversationId,"/messages/").concat(messageId,"/resume"),{Authorization:"Bearer ".concat(tokens.access_token)},{}).then((function(data){Store_rootStore.conversationStore.setActiveConversationAsResumed(data,messageId),Store_rootStore.authStore.setLoading(!1)}),(function(error){console.log("err:",error)}));case 4:case"end":return _context3.stop()}}),_callee3)}))),function resumeActiveConversationFromMessage(_x10,_x11,_x12,_x13){return _resumeActiveConversationFromMessage.apply(this,arguments)})},{key:"getPreviousMessagesFromTimestamp",value:(_getPreviousMessagesFromTimestamp=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(links,access_token,conversationId,timestamp){var tokens;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return Store_rootStore.conversationStore.setMessagesLoading(!0),_context4.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:tokens=_context4.sent,makeGetRequest("".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/").concat(conversationId,"/messages?beforeTimestamp=").concat(timestamp),{Authorization:"Bearer ".concat(tokens.access_token)}).then((function(data){Store_rootStore.conversationStore.loadPreviousMessages(data,conversationId),Store_rootStore.authStore.setLoading(!1)}),(function(error){console.log("err:",error),Store_rootStore.conversationStore.setMessagesLoading(!0)}));case 5:case"end":return _context4.stop()}}),_callee4)}))),function getPreviousMessagesFromTimestamp(_x14,_x15,_x16,_x17){return _getPreviousMessagesFromTimestamp.apply(this,arguments)})},{key:"getProactiveMessages",value:function getProactiveMessages(links,access_token){var businessId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Store_rootStore.conversationStore.setNotificationsLoading(!0),makeGetRequest("".concat(links.resumeConversation.href,"/?includeLabels=proactive event"),{Authorization:"Bearer ".concat(access_token)}).then((function(data){if(data){var id=data._embedded.conversation.id,readMessages=data._embedded.conversation.messages.filter((function(message){message.labels.includes("read")}));Store_rootStore.conversationStore.storeReadProactiveMessageData(readMessages,id,businessId),Store_rootStore.conversationStore.storeProactiveMessageData(data,businessId).then((function(res){Store_rootStore.authStore.setLoading(!1)}),(function(e){console.log(e),Store_rootStore.conversationStore.setNotificationsLoading(!1)}))}else Store_rootStore.authStore.setLoading(!1),Store_rootStore.conversationStore.setNotificationsLoading(!1)}),(function(error){console.log("err:",error)}))}},{key:"getManagedFeed",value:(_getManagedFeed=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee5(links,access_token){var businessId,tokens,_args5=arguments;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return businessId=_args5.length>2&&void 0!==_args5[2]?_args5[2]:null,_context5.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:tokens=_context5.sent,Store_rootStore.conversationStore.setScheduledMessagesLoading(!0),makeGetRequest("".concat("https://aider-ai-staging.appspot.com/api/v1","/feed/managed"),{Authorization:"Bearer ".concat(tokens.access_token)}).then((function(data){data&&Store_rootStore.conversationStore.storeScheduledMessages(data,businessId).then((function(res){Store_rootStore.conversationStore.setScheduledMessagesLoading(!1)}),(function(e){console.log(e),Store_rootStore.conversationStore.setScheduledMessagesLoading(!1)}))}),(function(error){console.log("err:",error)}));case 6:case"end":return _context5.stop()}}),_callee5)}))),function getManagedFeed(_x18,_x19){return _getManagedFeed.apply(this,arguments)})},{key:"cancelScheduledMessage",value:(_cancelScheduledMessage=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee6(links){var _this=this;return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:try{axios_default()({method:"delete",url:"".concat(links.cancel.href),headers:{Authorization:"Bearer ".concat(Store_rootStore.authStore.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return _this.getManagedFeed({},Store_rootStore.businessStore.selectedBusinessAccessToken)}),(function(rej){console.log("rej",rej)}))}catch(e){}case 1:case"end":return _context6.stop()}}),_callee6)}))),function cancelScheduledMessage(_x20){return _cancelScheduledMessage.apply(this,arguments)})},{key:"getFavoriteMessages",value:function getFavoriteMessages(links,access_token){var businessId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Store_rootStore.conversationStore.setNotificationsLoading(!0),makeGetRequest("".concat("https://aider-ai-staging.appspot.com/api/v1","/feed"),{Authorization:"Bearer ".concat(access_token)}).then((function(data){data&&Store_rootStore.conversationStore.storeFavoriteMessageData(data,businessId).then((function(res){Store_rootStore.authStore.setLoading(!1)}))}),(function(error){console.log("err:",error)}))}},{key:"getProactiveMessagesNoLoad",value:function getProactiveMessagesNoLoad(links,access_token){var businessId=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;makeGetRequest("".concat(links.resumeConversation.href,"/?includeLabels=proactive event"),{Authorization:"Bearer ".concat(access_token)}).then((function(data){Store_rootStore.conversationStore.storeProactiveMessageData(data,businessId).then((function(res){Store_rootStore.authStore.setLoading(!1)}),(function(e){console.log(e),Store_rootStore.conversationStore.setNotificationsLoading(!1)}))}),(function(error){console.log("err:",error)}))}},{key:"getUnreadProactiveMessagesNoLoad",value:(_getUnreadProactiveMessagesNoLoad=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee7(links,access_token){var businessId,_args7=arguments;return regenerator_default.a.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:businessId=_args7.length>2&&void 0!==_args7[2]?_args7[2]:null,console.log(".fetching"),makeGetRequest("".concat(links.resumeConversation.href,"/?includeLabels=proactive event"),{Authorization:"Bearer ".concat(access_token)}).then((function(data){if(data){var unreadMessagesCount=data._embedded.conversation.messages.filter((function(message){return!message.labels.includes("read")&&message.intent.topicAction&&"invoice-overdue"!==message.intent.topicAction&&message.intent.topicAction&&"bill-overdue"!==message.intent.topicAction})).length;Store_rootStore.businessStore.updateBusinessListDetail(businessId,unreadMessagesCount,null)}}),(function(error){console.log("err:",error)}));case 3:case"end":return _context7.stop()}}),_callee7)}))),function getUnreadProactiveMessagesNoLoad(_x21,_x22){return _getUnreadProactiveMessagesNoLoad.apply(this,arguments)})},{key:"scheduleReconciliationMessageAction",value:(_scheduleReconciliationMessageAction=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee8(users){var tokens,data;return regenerator_default.a.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return Store_rootStore.conversationStore.sendingMessageIsLoading(!0),_context8.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:return tokens=_context8.sent,Store_rootStore.authStore.Intercom("trackEvent","sent-request_reconciliation",{user_id:Store_rootStore.authStore.user.uid}),_context8.prev=5,_context8.next=8,axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/messages/advisor?intentKey=finance-reconciliation-request"),data:{_embedded:{recipients:users}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 8:if(!(data=_context8.sent)){_context8.next=12;break}return Store_rootStore.conversationStore.renderMessageSentWindow(!1,data.data._embedded.recipients.length,"reconciliation request"),_context8.abrupt("return",Store_rootStore.conversationStore.sendingMessageIsLoading(!1));case 12:_context8.next=17;break;case 14:_context8.prev=14,_context8.t0=_context8.catch(5),console.log("invalid request",_context8.t0);case 17:case"end":return _context8.stop()}}),_callee8,null,[[5,14]])}))),function scheduleReconciliationMessageAction(_x23){return _scheduleReconciliationMessageAction.apply(this,arguments)})},{key:"runKeyDatesMessageAction",value:(_runKeyDatesMessageAction=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee9(type,users){var tokens,data;return regenerator_default.a.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return Store_rootStore.conversationStore.sendingMessageIsLoading(!0),_context9.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:return tokens=_context9.sent,Store_rootStore.authStore.Intercom("trackEvent","sent-key_dates_check",{user_id:Store_rootStore.authStore.user.id}),_context9.prev=5,_context9.next=8,axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/messages/advisor?intentKey=finance-sales-tax"),data:{_embedded:{recipients:users}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 8:if(!(data=_context9.sent)){_context9.next=12;break}return Store_rootStore.conversationStore.renderMessageSentWindow(!1,data.data._embedded.recipients.length,"key tax dates reminder"),_context9.abrupt("return",Store_rootStore.conversationStore.sendingMessageIsLoading(!1));case 12:_context9.next=17;break;case 14:_context9.prev=14,_context9.t0=_context9.catch(5),console.log("invalid request",_context9.t0);case 17:case"end":return _context9.stop()}}),_callee9,null,[[5,14]])}))),function runKeyDatesMessageAction(_x24,_x25){return _runKeyDatesMessageAction.apply(this,arguments)})},{key:"runIncomeTaxEstimate",value:(_runIncomeTaxEstimate=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee10(users){var tokens,data;return regenerator_default.a.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return Store_rootStore.conversationStore.sendingMessageIsLoading(!0),_context10.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:return tokens=_context10.sent,Store_rootStore.authStore.Intercom("trackEvent","sent-finance_income_tax_estimate",{user_id:Store_rootStore.authStore.user.id}),_context10.prev=5,_context10.next=8,axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/messages/advisor?intentKey=finance-income-tax-estimate"),data:{_embedded:{recipients:users,parameters:{"date-period":{analyzedDatePeriod:{tense:"past",granularity:"month",offset:0,span:1}}}}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 8:if(!(data=_context10.sent)){_context10.next=12;break}return Store_rootStore.conversationStore.renderMessageSentWindow(!1,data.data._embedded.recipients.length,"income tax estimate"),_context10.abrupt("return",Store_rootStore.conversationStore.sendingMessageIsLoading(!1));case 12:_context10.next=17;break;case 14:_context10.prev=14,_context10.t0=_context10.catch(5),console.log("invalid request",_context10.t0);case 17:case"end":return _context10.stop()}}),_callee10,null,[[5,14]])}))),function runIncomeTaxEstimate(_x26){return _runIncomeTaxEstimate.apply(this,arguments)})},{key:"runGSTPayable",value:(_runGSTPayable=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee11(users){var tokens,data;return regenerator_default.a.wrap((function _callee11$(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return Store_rootStore.conversationStore.sendingMessageIsLoading(!0),_context11.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:return tokens=_context11.sent,Store_rootStore.authStore.Intercom("trackEvent","sent-finance_sales_tax_due",{user_id:Store_rootStore.authStore.user.id}),_context11.prev=5,_context11.next=8,axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/messages/advisor?intentKey=finance-sales-tax-due"),data:{_embedded:{recipients:users}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 8:if(!(data=_context11.sent)){_context11.next=12;break}return Store_rootStore.conversationStore.renderMessageSentWindow(!1,data.data._embedded.recipients.length,"GST Payable estimate"),_context11.abrupt("return",Store_rootStore.conversationStore.sendingMessageIsLoading(!1));case 12:_context11.next=17;break;case 14:_context11.prev=14,_context11.t0=_context11.catch(5),console.log("invalid request",_context11.t0);case 17:case"end":return _context11.stop()}}),_callee11,null,[[5,14]])}))),function runGSTPayable(_x27){return _runGSTPayable.apply(this,arguments)})},{key:"scheduleMessageAction",value:(_scheduleMessageAction=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee12(intentKey,frequency,timeOfDay,users,messageBody){var tokens,data;return regenerator_default.a.wrap((function _callee12$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return Store_rootStore.conversationStore.sendingMessageIsLoading(!0),_context12.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:return tokens=_context12.sent,"finance-sales-tax"===intentKey?Store_rootStore.authStore.Intercom("trackEvent","scheduled-key_dates_check",{}):"finance-sales-tax-due"===intentKey?Store_rootStore.authStore.Intercom("trackEvent","scheduled-finance_sales_tax_due",{}):"finance-cash-flow"===intentKey?Store_rootStore.authStore.Intercom("trackEvent","scheduled-cash_flow_check",{}):"finance-reconciliation-request"===intentKey?Store_rootStore.authStore.Intercom("trackEvent","scheduled-request_reconciliation",{}):"finance-reconciliation-request"===intentKey&&Store_rootStore.authStore.Intercom("trackEvent","scheduled-finance_income_tax_estimate",{}),_context12.prev=6,_context12.next=9,axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/messages/advisor/schedule?intentKey=").concat(intentKey,"&frequency=").concat(frequency,"&timeOfDay=").concat(timeOfDay),data:{_embedded:{recipients:users,parameters:"direct-message"===intentKey?{advisorMessageBody:messageBody,advisorTask:null,advisorTaskUrl:null,notificationTitle:"Direct Message from ".concat(Store_rootStore.authStore.practiceUser.user.givenName," ").concat(Store_rootStore.authStore.practiceUser.user.familyName),advisorName:"".concat(Store_rootStore.authStore.practiceUser.user.givenName," ").concat(Store_rootStore.authStore.practiceUser.user.familyName)}:null}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 9:(data=_context12.sent)&&(Store_rootStore.conversationStore.renderMessageSentWindow(!1,data.data._embedded.recipients.length,"scheduled message"),Store_rootStore.conversationStore.sendingMessageIsLoading(!1)),_context12.next=16;break;case 13:_context12.prev=13,_context12.t0=_context12.catch(6),console.log("invalid request",_context12.t0);case 16:case"end":return _context12.stop()}}),_callee12,null,[[6,13]])}))),function scheduleMessageAction(_x28,_x29,_x30,_x31,_x32){return _scheduleMessageAction.apply(this,arguments)})},{key:"runDirectMessageAction",value:(_runDirectMessageAction=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee13(type,messageBody,users){var tokens,data;return regenerator_default.a.wrap((function _callee13$(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:return Store_rootStore.conversationStore.sendingMessageIsLoading(!0),_context13.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:return tokens=_context13.sent,Store_rootStore.authStore.Intercom("trackEvent","sent-custom_message",{user_id:Store_rootStore.authStore.user.uid}),_context13.prev=5,_context13.next=8,axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/messages/advisor?intentKey=advisor-custom-message"),data:{_embedded:{recipients:users,parameters:{advisorMessageBody:messageBody,advisorTask:null,advisorTaskUrl:null,notificationTitle:"Direct Message from ".concat(Store_rootStore.authStore.practiceUser.user.givenName," ").concat(Store_rootStore.authStore.practiceUser.user.familyName),advisorName:"".concat(Store_rootStore.authStore.practiceUser.user.givenName," ").concat(Store_rootStore.authStore.practiceUser.user.familyName)}}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 8:(data=_context13.sent)&&(Store_rootStore.conversationStore.renderMessageSentWindow(!1,data.data._embedded.recipients.length,"direct message"),Store_rootStore.conversationStore.sendingMessageIsLoading(!1)),_context13.next=16;break;case 12:_context13.prev=12,_context13.t0=_context13.catch(5),console.log("invalid request",_context13.t0),Store_rootStore.conversationStore.sendingMessageIsLoading(!1);case 16:case"end":return _context13.stop()}}),_callee13,null,[[5,12]])}))),function runDirectMessageAction(_x33,_x34,_x35){return _runDirectMessageAction.apply(this,arguments)})},{key:"runCashflowCheckMessageAction",value:(_runCashflowCheckMessageAction=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee14(type,users){var tokens,data;return regenerator_default.a.wrap((function _callee14$(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return Store_rootStore.conversationStore.sendingMessageIsLoading(!0),_context14.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:return tokens=_context14.sent,Store_rootStore.authStore.Intercom("trackEvent","sent-cash_flow_check",{user_id:Store_rootStore.authStore.user.uid}),_context14.prev=5,_context14.next=8,axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/messages/advisor?intentKey=finance-cash-flow"),data:{_embedded:{recipients:users,parameters:{"date-period":{analyzedDatePeriod:{tense:"past",granularity:"month",offset:0,span:1}}}}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 8:(data=_context14.sent)&&(Store_rootStore.conversationStore.renderMessageSentWindow(!1,data.data._embedded.recipients.length,"cash flow check"),Store_rootStore.conversationStore.sendingMessageIsLoading(!1)),_context14.next=15;break;case 12:_context14.prev=12,_context14.t0=_context14.catch(5),console.log("invalid request",_context14.t0);case 15:case"end":return _context14.stop()}}),_callee14,null,[[5,12]])}))),function runCashflowCheckMessageAction(_x36,_x37){return _runCashflowCheckMessageAction.apply(this,arguments)})},{key:"dismissNotification",value:function dismissNotification(id){}},{key:"markNotificiation",value:(_markNotificiation=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee15(id,url){var tokens;return regenerator_default.a.wrap((function _callee15$(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return _context15.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context15.sent,_context15.prev=3,_context15.next=6,axios_default()({method:"put",url:url,data:{},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 6:_context15.sent,ConversationService.getProactiveMessagesNoLoad(Store_rootStore.authStore.links,tokens.access_token,Store_rootStore.businessStore.selectedBusinessId),Store_rootStore.conversationStore.getUnreadProactiveMessagesNoLoad(Store_rootStore.authStore.links,tokens.access_token,Store_rootStore.businessStore.selectedBusinessId),_context15.next=14;break;case 11:_context15.prev=11,_context15.t0=_context15.catch(3),console.log("invalid request",_context15.t0);case 14:case"end":return _context15.stop()}}),_callee15,null,[[3,11]])}))),function markNotificiation(_x38,_x39){return _markNotificiation.apply(this,arguments)})},{key:"removeMessageFromFavorites",value:(_removeMessageFromFavorites=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee16(url){var tokens;return regenerator_default.a.wrap((function _callee16$(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return _context16.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context16.sent,_context16.prev=3,_context16.next=6,axios_default()({method:"delete",url:url,data:{},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 6:_context16.sent,ConversationService.getFavoriteMessages(Store_rootStore.authStore.links,tokens.access_token,Store_rootStore.businessStore.selectedBusinessId),_context16.next=13;break;case 10:_context16.prev=10,_context16.t0=_context16.catch(3),console.log("invalid request",_context16.t0);case 13:case"end":return _context16.stop()}}),_callee16,null,[[3,10]])}))),function removeMessageFromFavorites(_x40){return _removeMessageFromFavorites.apply(this,arguments)})},{key:"favoriteNotification",value:(_favoriteNotification=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee17(conversationId,messageId){var tokens;return regenerator_default.a.wrap((function _callee17$(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:return _context17.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context17.sent,Store_rootStore.authStore.Intercom("trackEvent","scheduled-favourite",{business_id:Store_rootStore.businessStore.selectedBusinessId}),_context17.prev=4,_context17.next=7,axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/").concat(conversationId,"/messages/").concat(messageId,"/favourite"),data:{},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 7:_context17.sent,ConversationService.getProactiveMessagesNoLoad(Store_rootStore.authStore.links,tokens.access_token,Store_rootStore.businessStore.selectedBusinessId),ConversationService.getFavoriteMessages(Store_rootStore.authStore.links,tokens.access_token,Store_rootStore.businessStore.selectedBusinessId),_context17.next=15;break;case 12:_context17.prev=12,_context17.t0=_context17.catch(4),console.log("invalid request",_context17.t0);case 15:case"end":return _context17.stop()}}),_callee17,null,[[4,12]])}))),function favoriteNotification(_x41,_x42){return _favoriteNotification.apply(this,arguments)})},{key:"saveNotification",value:function saveNotification(id){ConversationService.getProactiveMessagesNoLoad(Store_rootStore.authStore.links,Store_rootStore.businessStore.selectedBusinessAccessToken,Store_rootStore.businessStore.selectedBusinessId)}},{key:"deeplinkNotification",value:function deeplinkNotification(id){}},{key:"provideFeedback",value:(_provideFeedback=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee18(links,access_token,conversationId,messageId,vote){var tokens,data;return regenerator_default.a.wrap((function _callee18$(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:return Store_rootStore.conversationStore.setResponseLoading(!0),_context18.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:return tokens=_context18.sent,_context18.prev=4,_context18.next=7,axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/").concat(conversationId,"/messages/").concat(messageId,"/votes/").concat(vote),data:{},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}});case 7:(data=_context18.sent)&&data.data._embedded?(Store_rootStore.conversationStore.integrateFeedbackAnswerWithConversation(data.data,messageId),Store_rootStore.conversationStore.tagMessageWithFeedback(data.data,messageId)):console.log("invalid",data),_context18.next=14;break;case 11:_context18.prev=11,_context18.t0=_context18.catch(4),console.log("invalid request, rerunning",_context18.t0);case 14:case"end":return _context18.stop()}}),_callee18,null,[[4,11]])}))),function provideFeedback(_x43,_x44,_x45,_x46,_x47){return _provideFeedback.apply(this,arguments)})},{key:"refreshAuth",value:(_refreshAuth=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee19(){var businessId,tokens;return regenerator_default.a.wrap((function _callee19$(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:return businessId=Store_rootStore.businessStore.selectedBusinessId,tokens=Store_rootStore.authStore.tokenRegistry.find((function(registry){return registry.id===businessId})),_context19.abrupt("return",refreshTokensVerbose(Store_rootStore.authStore.links,tokens.tokens).then((function(updatedTokens){return Store_rootStore.authStore.refreshBusinessTokens(updatedTokens,businessId),{updatedTokens:updatedTokens,businessId:businessId}})));case 3:case"end":return _context19.stop()}}),_callee19)}))),function refreshAuth(){return _refreshAuth.apply(this,arguments)})},{key:"provideFeedbackOnAnswer",value:function provideFeedbackOnAnswer(links,access_token,conversationId,messageId,feedback,category,responseType){var feedbackType="up"===responseType?"positive":"negative";return axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/conversations/").concat(conversationId,"/messages/").concat(messageId,"/feedback/").concat(feedbackType),data:{_embedded:{messageFeedback:{labels:[category],comments:feedback}}},headers:{Authorization:"Bearer ".concat(access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){})).catch((function(e){esm.a(e)}))}},{key:"fetchRecommendedQuestionsBasedOnAppSelection",value:function fetchRecommendedQuestionsBasedOnAppSelection(ospKey,appKey,filter){return axios_default()({method:"get",url:"".concat("https://aider-ai-staging.appspot.com/api/v1","/recommendations/questions?ospKey=").concat(ospKey,"&appKey=").concat(appKey,"&filter=").concat(filter),headers:{Authorization:"Bearer ".concat(Store_rootStore.businessStore.selectedBusinessAccessToken),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(res){return Store_rootStore.conversationStore.storeRecommendedQuestions(res.data._embedded.recommendations)})).catch((function(e){esm.a(e)}))}}]),ConversationService}(),conversationStore_ConversationStore=(conversationStore_dec=mobx_module.action.bound,conversationStore_dec2=mobx_module.action.bound,conversationStore_dec3=mobx_module.action.bound,conversationStore_dec4=mobx_module.action.bound,conversationStore_dec5=mobx_module.action.bound,conversationStore_dec6=mobx_module.action.bound,conversationStore_dec7=mobx_module.action.bound,conversationStore_dec8=mobx_module.action.bound,conversationStore_dec9=mobx_module.action.bound,conversationStore_dec10=mobx_module.action.bound,conversationStore_dec11=mobx_module.action.bound,conversationStore_dec12=mobx_module.action.bound,conversationStore_dec13=mobx_module.action.bound,conversationStore_dec14=mobx_module.action.bound,conversationStore_dec15=mobx_module.action.bound,conversationStore_dec16=mobx_module.action.bound,conversationStore_dec17=mobx_module.action.bound,conversationStore_dec18=mobx_module.action.bound,conversationStore_dec19=mobx_module.action.bound,conversationStore_class=function(){function ConversationStore(rootStore){Object(classCallCheck.a)(this,ConversationStore),this.rootStore=void 0,this.continueConversationAction=void 0,this.startConversationAction=void 0,this.getActiveConversation=void 0,this.scheduleMessage=void 0,this.getProactiveMessages=void 0,this.getUnreadProactiveMessagesNoLoad=void 0,this.provideFeedback=void 0,this.provideFeedbackOnAnswer=void 0,this.resumeActiveConversationFromMessage=void 0,this.getPreviousMessagesFromTimestamp=void 0,this.scheduleReconciliationMessageAction=void 0,this.runCashflowCheckMessageAction=void 0,this.runKeyDatesMessageAction=void 0,this.dismissNotification=void 0,this.favoriteNotification=void 0,this.saveNotification=void 0,this.deeplinkNotification=void 0,this.markNotification=void 0,this.getFavoriteMessages=void 0,this.removeMessageFromFavorites=void 0,this.scheduleMessageAction=void 0,this.runDirectMessageAction=void 0,this.runIncomeTaxEstimate=void 0,this.fetchRecommendedQuestionsBasedOnAppSelection=void 0,this.getManagedFeed=void 0,this.cancelScheduledMessage=void 0,this.startConversationViaAlternative=void 0,this.runGSTPayable=void 0,Object(initializerDefineProperty.a)(this,"trainAiderVisible",conversationStore_descriptor,this),Object(initializerDefineProperty.a)(this,"responseLoading",conversationStore_descriptor2,this),Object(initializerDefineProperty.a)(this,"scheduledMessagesLoading",conversationStore_descriptor3,this),Object(initializerDefineProperty.a)(this,"messagesLoading",conversationStore_descriptor4,this),Object(initializerDefineProperty.a)(this,"notificationsLoading",conversationStore_descriptor5,this),Object(initializerDefineProperty.a)(this,"messageSentWindowIsRendered",conversationStore_descriptor6,this),Object(initializerDefineProperty.a)(this,"recipientCount",conversationStore_descriptor7,this),Object(initializerDefineProperty.a)(this,"recipientType",conversationStore_descriptor8,this),Object(initializerDefineProperty.a)(this,"sendingMessageLoading",conversationStore_descriptor9,this),Object(initializerDefineProperty.a)(this,"currentConversation",conversationStore_descriptor10,this),Object(initializerDefineProperty.a)(this,"currentProactiveMessages",conversationStore_descriptor11,this),Object(initializerDefineProperty.a)(this,"currentManagedMessages",conversationStore_descriptor12,this),Object(initializerDefineProperty.a)(this,"currentFavoritedMessages",conversationStore_descriptor13,this),Object(initializerDefineProperty.a)(this,"readProactiveMessages",conversationStore_descriptor14,this),Object(initializerDefineProperty.a)(this,"conversationArray",conversationStore_descriptor15,this),Object(initializerDefineProperty.a)(this,"recommendedQuestions",conversationStore_descriptor16,this),this.rootStore=rootStore,this.startConversationAction=conversationService_ConversationService.startConversationAction,this.startConversationViaAlternative=conversationService_ConversationService.startConversationViaAlternative,this.continueConversationAction=conversationService_ConversationService.continueConversationAction,this.getActiveConversation=conversationService_ConversationService.getActiveConversation,this.getProactiveMessages=conversationService_ConversationService.getProactiveMessages,this.getUnreadProactiveMessagesNoLoad=conversationService_ConversationService.getUnreadProactiveMessagesNoLoad,this.getFavoriteMessages=conversationService_ConversationService.getFavoriteMessages,this.provideFeedback=conversationService_ConversationService.provideFeedback,this.scheduleMessage=conversationService_ConversationService.scheduleMessage,this.provideFeedbackOnAnswer=conversationService_ConversationService.provideFeedbackOnAnswer,this.resumeActiveConversationFromMessage=conversationService_ConversationService.resumeActiveConversationFromMessage,this.getPreviousMessagesFromTimestamp=conversationService_ConversationService.getPreviousMessagesFromTimestamp,this.scheduleReconciliationMessageAction=conversationService_ConversationService.scheduleReconciliationMessageAction,this.runCashflowCheckMessageAction=conversationService_ConversationService.runCashflowCheckMessageAction,this.runKeyDatesMessageAction=conversationService_ConversationService.runKeyDatesMessageAction,this.dismissNotification=conversationService_ConversationService.dismissNotification,this.favoriteNotification=conversationService_ConversationService.favoriteNotification,this.saveNotification=conversationService_ConversationService.saveNotification,this.deeplinkNotification=conversationService_ConversationService.deeplinkNotification,this.markNotification=conversationService_ConversationService.markNotificiation,this.removeMessageFromFavorites=conversationService_ConversationService.removeMessageFromFavorites,this.scheduleMessageAction=conversationService_ConversationService.scheduleMessageAction,this.runIncomeTaxEstimate=conversationService_ConversationService.runIncomeTaxEstimate,this.runDirectMessageAction=conversationService_ConversationService.runDirectMessageAction,this.getManagedFeed=conversationService_ConversationService.getManagedFeed,this.cancelScheduledMessage=conversationService_ConversationService.cancelScheduledMessage,this.runGSTPayable=conversationService_ConversationService.runGSTPayable,this.fetchRecommendedQuestionsBasedOnAppSelection=conversationService_ConversationService.fetchRecommendedQuestionsBasedOnAppSelection}var _clearConversationData,_loadPreviousMessages,_setScheduledMessage,_setActiveConversationAsResumed,_integrateFeedbackAnswerWithConversation,_tagMessageWithFeedback,_storeReadProactiveMessageData,_storeFavoriteMessageData,_storeScheduledMessages,_storeProactiveMessageData,_storeConversationData,_storeRecommendedQuestions;return Object(createClass.a)(ConversationStore,[{key:"setTrainAiderVisible",value:function setTrainAiderVisible(isVisible){return this.trainAiderVisible=isVisible}},{key:"storeRecommendedQuestions",value:(_storeRecommendedQuestions=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(questions){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return console.log("RES",questions),this.recommendedQuestions=questions,_context.abrupt("return",questions);case 3:case"end":return _context.stop()}}),_callee,this)}))),function storeRecommendedQuestions(_x){return _storeRecommendedQuestions.apply(this,arguments)})},{key:"setMessagesLoading",value:function setMessagesLoading(loading){return this.messagesLoading=loading}},{key:"setNotificationsLoading",value:function setNotificationsLoading(loading){return this.notificationsLoading=loading}},{key:"setScheduledMessagesLoading",value:function setScheduledMessagesLoading(loading){return this.scheduledMessagesLoading=loading}},{key:"setResponseLoading",value:function setResponseLoading(loading){return this.responseLoading=loading}},{key:"storeConversationData",value:(_storeConversationData=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(data,businessId){var _data$_embedded$conve,messages,id,postData;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:_data$_embedded$conve=data._embedded.conversation,messages=_data$_embedded$conve.messages,id=_data$_embedded$conve.id,postData=messages.map((function(i){return{questions:i.query||i.text,answers:i.answers,labels:i.labels,alternatives:i.alternatives,messageId:i.id,voted:null,timestamp:i.timestamp,metadata:i.metadata,conversationId:id,hasCard:i.cards&&i.cards.length>=1,cards:i.cards}})),this.currentConversation={messages:this.currentConversation.messages.concat(postData),questions:messages.map((function(i){return i.query})),answers:messages.map((function(i){return i.answers})),conversationId:id},this.setResponseLoading(!1);case 4:case"end":return _context2.stop()}}),_callee2,this)}))),function storeConversationData(_x2,_x3){return _storeConversationData.apply(this,arguments)})},{key:"storeProactiveMessageData",value:(_storeProactiveMessageData=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(data,businessId){var _data$_embedded$conve2,messages,id,postData;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _data$_embedded$conve2=data._embedded.conversation,messages=_data$_embedded$conve2.messages,id=_data$_embedded$conve2.id,postData=messages.map((function(i){return{businessId:businessId,questions:i.query,answers:i.answers,labels:i.labels,alternatives:i.alternatives,messageId:i.id,voted:null,timestamp:i.timestamp,metadata:i.metadata,_links:i._links,topic:i.intent&&i.intent.topicAction,hasCard:i.cards&&i.cards.length>=1,cards:i.cards}})).filter((function(notification){return"invoice-overdue"!==notification.topic&&"bill-overdue"!==notification.topic})),this.currentProactiveMessages={messages:this.currentProactiveMessages.messages=postData,questions:messages.map((function(i){return i.query})),answers:messages.map((function(i){return i.answers})),conversationId:id},_context3.abrupt("return",Store_rootStore.conversationStore.setNotificationsLoading(!1));case 4:case"end":return _context3.stop()}}),_callee3,this)}))),function storeProactiveMessageData(_x4,_x5){return _storeProactiveMessageData.apply(this,arguments)})},{key:"storeScheduledMessages",value:(_storeScheduledMessages=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(data,businessId){var managedMessages,postData;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return managedMessages=data._embedded.managedMessages,postData=managedMessages.map((function(i){return{businessId:businessId,action:i.action,createdAt:i.createdAt,createdBy:i.createdBy,frequency:i.frequency,message:i.message,nextExecutionAt:i.nextExecutionAt,recipient:i.recipient,timeOfDay:i.timeOfDay,_links:i._links}})),console.log("message-+",managedMessages),this.currentManagedMessages={messages:this.currentManagedMessages.messages=postData,questions:managedMessages.map((function(i){return i.query})),answers:managedMessages.map((function(i){return i.answers})),conversationId:"id"},_context4.abrupt("return",Store_rootStore.conversationStore.setScheduledMessagesLoading(!1));case 5:case"end":return _context4.stop()}}),_callee4,this)}))),function storeScheduledMessages(_x6,_x7){return _storeScheduledMessages.apply(this,arguments)})},{key:"storeFavoriteMessageData",value:(_storeFavoriteMessageData=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee5(data,businessId){var _data$_embedded,scheduledMessages,postData;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _data$_embedded=data._embedded,scheduledMessages=_data$_embedded.scheduledMessages,_data$_embedded.id,postData=scheduledMessages.map((function(i){return{businessId:businessId,questions:i.message.query,answers:i.message.answers,labels:i.message.labels,alternatives:i.message.alternatives,messageId:i.message.id,voted:null,metadata:i.message.metadata,timestamp:i.message.timestamp,_links:i._links,_messageLinks:i.message.links,action:i.action,createdAt:i.createdAt,frequency:i.frequency,nextExecutionAt:i.nextExecutionAt,timeOfDay:i.timeOfDay,topic:i.message.intent&&i.message.intent.topicAction,hasCard:i.message.cards&&i.message.cards.length>=1,cards:i.message.cards}})),this.currentFavoritedMessages=postData,_context5.abrupt("return",Store_rootStore.conversationStore.setNotificationsLoading(!1));case 4:case"end":return _context5.stop()}}),_callee5,this)}))),function storeFavoriteMessageData(_x8,_x9){return _storeFavoriteMessageData.apply(this,arguments)})},{key:"storeReadProactiveMessageData",value:(_storeReadProactiveMessageData=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee6(messages,id,businessId){var postData;return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return postData=messages.map((function(i){return{businessId:businessId,questions:i.query,answers:i.answers,labels:i.labels,alternatives:i.alternatives,messageId:i.id,voted:null,timestamp:i.timestamp,_links:i._links,topic:i.intent&&i.intent.topicAction,hasCard:i.cards&&i.cards.length>=1,cards:i.cards}})),this.readProactiveMessages={messages:this.readProactiveMessages.messages=postData,questions:messages.map((function(i){return i.query})),answers:messages.map((function(i){return i.answers})),conversationId:id},_context6.abrupt("return",Store_rootStore.conversationStore.setNotificationsLoading(!1));case 3:case"end":return _context6.stop()}}),_callee6,this)}))),function storeReadProactiveMessageData(_x10,_x11,_x12){return _storeReadProactiveMessageData.apply(this,arguments)})},{key:"tagMessageWithFeedback",value:(_tagMessageWithFeedback=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee7(data,messageId){var vote;return regenerator_default.a.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:"up"!==(vote=data._embedded.conversation.messages[0].eventKey)&&"down"!==vote||(this.currentConversation.messages.find((function(i){return i.messageId===messageId})).voted=vote);case 2:case"end":return _context7.stop()}}),_callee7,this)}))),function tagMessageWithFeedback(_x13,_x14){return _tagMessageWithFeedback.apply(this,arguments)})},{key:"integrateFeedbackAnswerWithConversation",value:(_integrateFeedbackAnswerWithConversation=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee8(data,messageId){var _data$_embedded$conve3,messages,id,postData;return regenerator_default.a.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:_data$_embedded$conve3=data._embedded.conversation,messages=_data$_embedded$conve3.messages,id=_data$_embedded$conve3.id,postData=messages.map((function(i){return{questions:"You gave feedback",answers:i.answers,labels:i.labels,alternatives:i.alternatives,messageId:i.id,voted:null,timestamp:i.timestamp,metadata:i.metadata,conversationId:id}})),this.currentConversation={messages:this.currentConversation.messages.concat(postData),questions:messages.map((function(i){return i.query})),answers:messages.map((function(i){return i.answers})),conversationId:id},Store_rootStore.conversationStore.setResponseLoading(!1);case 4:case"end":return _context8.stop()}}),_callee8,this)}))),function integrateFeedbackAnswerWithConversation(_x15,_x16){return _integrateFeedbackAnswerWithConversation.apply(this,arguments)})},{key:"setActiveConversationAsResumed",value:(_setActiveConversationAsResumed=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee9(data,messageId){var _data$_embedded$conve4,messages,id,postData;return regenerator_default.a.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:_data$_embedded$conve4=data._embedded.conversation,messages=_data$_embedded$conve4.messages,id=_data$_embedded$conve4.id,postData=messages.map((function(i){return{questions:"You gave feedback.",answers:i.answers,labels:i.labels,alternatives:i.alternatives,messageId:i.id,voted:null,timestamp:i.timestamp,metadata:i.metadata,conversationId:id}})),this.currentConversation={messages:this.currentConversation.messages.concat(postData),questions:messages.map((function(i){return i.query})),answers:messages.map((function(i){return i.answers})),conversationId:id};case 3:case"end":return _context9.stop()}}),_callee9,this)}))),function setActiveConversationAsResumed(_x17,_x18){return _setActiveConversationAsResumed.apply(this,arguments)})},{key:"setScheduledMessage",value:(_setScheduledMessage=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee10(data,messageId){var _data$_embedded$conve5,messages,id,postData;return regenerator_default.a.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:_data$_embedded$conve5=data._embedded.conversation,messages=_data$_embedded$conve5.messages,id=_data$_embedded$conve5.id,postData=messages.map((function(i){return{questions:"You scheduled a message.",answers:i.answers,labels:i.labels,alternatives:i.alternatives,messageId:i.id,voted:null,timestamp:i.timestamp,metadata:i.metadata,conversationId:id}})),this.currentConversation={messages:this.currentConversation.messages.concat(postData),questions:messages.map((function(i){return i.query})),answers:messages.map((function(i){return i.answers})),conversationId:id};case 3:case"end":return _context10.stop()}}),_callee10,this)}))),function setScheduledMessage(_x19,_x20){return _setScheduledMessage.apply(this,arguments)})},{key:"loadPreviousMessages",value:(_loadPreviousMessages=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee11(data,conversationId){var _data$_embedded$conve6,messages,id,postData;return regenerator_default.a.wrap((function _callee11$(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:_data$_embedded$conve6=data._embedded.conversation,messages=_data$_embedded$conve6.messages,id=_data$_embedded$conve6.id,postData=messages.map((function(i){return{questions:i.query,answers:i.answers,labels:i.labels,alternatives:i.alternatives,messageId:i.id,voted:null,timestamp:i.timestamp,metadata:i.metadata,conversationId:id}})),this.currentConversation={messages:postData.concat(this.currentConversation.messages),questions:messages.map((function(i){return i.query})),answers:messages.map((function(i){return i.answers})),conversationId:id},this.setMessagesLoading(!1);case 4:case"end":return _context11.stop()}}),_callee11,this)}))),function loadPreviousMessages(_x21,_x22){return _loadPreviousMessages.apply(this,arguments)})},{key:"clearConversationData",value:(_clearConversationData=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee12(query){return regenerator_default.a.wrap((function _callee12$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:query||(this.currentConversation={messages:[],questions:[],answers:[],conversationId:this.currentConversation.conversationId});case 1:case"end":return _context12.stop()}}),_callee12,this)}))),function clearConversationData(_x23){return _clearConversationData.apply(this,arguments)})},{key:"renderMessageSentWindow",value:function renderMessageSentWindow(isRendered,recipients,type){this.recipientCount=recipients,this.recipientType=type,this.messageSentWindowIsRendered=isRendered}},{key:"sendingMessageIsLoading",value:function sendingMessageIsLoading(isLoading){this.sendingMessageLoading=isLoading}}]),ConversationStore}(),conversationStore_descriptor=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"trainAiderVisible",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),conversationStore_descriptor2=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"responseLoading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),conversationStore_descriptor3=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"scheduledMessagesLoading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),conversationStore_descriptor4=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"messagesLoading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),conversationStore_descriptor5=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"notificationsLoading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),conversationStore_descriptor6=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"messageSentWindowIsRendered",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),conversationStore_descriptor7=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"recipientCount",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),conversationStore_descriptor8=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"recipientType",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),conversationStore_descriptor9=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"sendingMessageLoading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),conversationStore_descriptor10=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"currentConversation",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{answers:[],questions:[],messages:[],conversationId:""}}}),conversationStore_descriptor11=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"currentProactiveMessages",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{answers:[],questions:[],messages:[],conversationId:""}}}),conversationStore_descriptor12=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"currentManagedMessages",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{answers:[],questions:[],messages:[],conversationId:""}}}),conversationStore_descriptor13=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"currentFavoritedMessages",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{answers:[],questions:[],scheduledMessages:[],conversationId:""}}}),conversationStore_descriptor14=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"readProactiveMessages",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{answers:[],questions:[],messages:[],conversationId:""}}}),conversationStore_descriptor15=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"conversationArray",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[{id:"SsbYVwwo9Ob15jF9LB69",messages:[]}]}}),conversationStore_descriptor16=Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"recommendedQuestions",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"setTrainAiderVisible",[conversationStore_dec],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"setTrainAiderVisible"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"storeRecommendedQuestions",[conversationStore_dec2],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"storeRecommendedQuestions"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"setMessagesLoading",[conversationStore_dec3],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"setMessagesLoading"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"setNotificationsLoading",[conversationStore_dec4],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"setNotificationsLoading"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"setScheduledMessagesLoading",[conversationStore_dec5],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"setScheduledMessagesLoading"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"setResponseLoading",[conversationStore_dec6],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"setResponseLoading"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"storeConversationData",[conversationStore_dec7],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"storeConversationData"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"storeProactiveMessageData",[conversationStore_dec8],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"storeProactiveMessageData"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"storeScheduledMessages",[conversationStore_dec9],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"storeScheduledMessages"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"storeFavoriteMessageData",[conversationStore_dec10],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"storeFavoriteMessageData"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"storeReadProactiveMessageData",[conversationStore_dec11],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"storeReadProactiveMessageData"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"tagMessageWithFeedback",[conversationStore_dec12],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"tagMessageWithFeedback"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"integrateFeedbackAnswerWithConversation",[conversationStore_dec13],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"integrateFeedbackAnswerWithConversation"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"setActiveConversationAsResumed",[conversationStore_dec14],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"setActiveConversationAsResumed"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"setScheduledMessage",[conversationStore_dec15],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"setScheduledMessage"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"loadPreviousMessages",[conversationStore_dec16],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"loadPreviousMessages"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"clearConversationData",[conversationStore_dec17],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"clearConversationData"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"renderMessageSentWindow",[conversationStore_dec18],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"renderMessageSentWindow"),conversationStore_class.prototype),Object(applyDecoratedDescriptor.a)(conversationStore_class.prototype,"sendingMessageIsLoading",[conversationStore_dec19],Object.getOwnPropertyDescriptor(conversationStore_class.prototype,"sendingMessageIsLoading"),conversationStore_class.prototype),conversationStore_class),dist=__webpack_require__(421),dist_default=__webpack_require__.n(dist),index_cjs=__webpack_require__(81),index_cjs_default=__webpack_require__.n(index_cjs),moment=__webpack_require__(128),moment_default=__webpack_require__.n(moment),aider_dot_t=__webpack_require__(422),aider_dot_t_default=__webpack_require__.n(aider_dot_t);function closeModal(e){if(e.preventDefault(),void 0!==e.target.className)try{Store_rootStore.conversationStore.renderMessageSentWindow(!1,null,null),this.closeHeaderDropdown();var testStr=e.target.className.split(/[ -]/),containsContainer=function contains(target,pattern){var value=0;return pattern.forEach((function(word){return value+=target.includes(word)})),1===value}(testStr,["feedback","dropdownOption","dropdown"])&&""!==e.target.className,containsMetadata=testStr.includes("metadata")&&""!==e.target.className,containsClient=e.target.className.split(/[ -]/).includes("client")&&""!==e.target.className;if("closeModal"===e.target.className||(this.state.feedbackModalVisible||this.state.clientModalVisible||this.state.metadataModalVisible||this.state.actionModalVisible||this.state.editClientModalVisible||this.state.editUserModalVisible)&&!containsContainer&&!containsClient&&!containsMetadata&&void 0!==e.target)return this.setState({editUserModalVisible:!1,editClientModalVisible:!1,infoModalVisible:!1,feedbackModalVisible:!1,actionModalVisible:!1,clientModalVisible:!1,metadataModalVisible:!1,feedbackElementId:null,messageId:null,messageToGiveFeedback:null,feedbackType:null,metaData:null,metadataApps:null,actionType:null});this.props.authStore.editUserModalVisible&&(console.log("close"),this.props.authStore.validateUserModal(null),this.props.authStore.renderEditUserModal(!1)),this.state.feedbackModalVisible}catch(err){console.log("render modal error: ",typeof e.target)}}var components_ConfirmationModal=function ConfirmationModal(props){return react.createElement("div",{id:"metadataModal",className:"confirm-modal-container-advisor",onClick:function onClick(e){e.preventDefault(),e.stopPropagation()},style:{zIndex:999}},react.createElement(lib.CardPanel,{className:"metadata-card"},react.createElement("h4",{className:"metadata",style:{color:"#4264ea"}},"Your invitation is on its way."),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},react.createElement("b",null,props.invitedUserDetails.displayName)," with the email address ",react.createElement("b",null,props.invitedUserDetails.email)),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},"will be able to create an Aider account by following the link in the email."),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},"Please make sure that ",react.createElement("b",null,props.invitedUserDetails.displayName)," checks all email folders for the invitation."),react.createElement("div",{style:{display:"flex",justifyContent:"center"}},react.createElement("div",{className:"actionButton",onClick:function onClick(){Store_rootStore.businessStore.renderConfirmationWindow(!1)}},"Okay"))))},components_ConfirmationMessage=(lib.CardPanel,function ConfirmationMessage(props){return react.createElement("div",{style:{marginBottom:8}},react.createElement("h4",{style:{color:"#4264ea",display:"flex",justifyContent:"center"}},props.recipients>0?"Message Delivered":"Message couldn't be delivered"),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},props.recipients>1?"The ".concat(props.type," has been delivered to ").concat(props.recipients," recipients."):1===props.recipients?"The ".concat(props.type," has been delivered to ").concat(props.recipients," recipient."):react.createElement("span",null,"No active users for this business.",react.createElement("br",null)," ",'Try inviting users to download the Aider app, by using the "Invite User" button on the left.',react.createElement("br",null)," ","Once these users are active you will be able to use the Action Centre for this business.")),react.createElement("div",{style:{display:"flex",justifyContent:"center"}},react.createElement("div",{className:"actionButton",onClick:function onClick(){Store_rootStore.conversationStore.renderMessageSentWindow(!1,null,null),props.closeModal()}},"Okay")))}),components_ConfirmationMessageModal=function ConfirmationMessageModal(props){return react.createElement("div",{id:"metadataModal",className:"confirm-modal-container",onClick:function onClick(e){e.preventDefault(),e.stopPropagation()}},react.createElement(lib.CardPanel,{className:"metadata-card"},react.createElement("h4",{style:{color:"#4264ea"}},props.recipients>0?"Message Delivered":"Message couldn't be delivered"),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},props.recipients>1?"The ".concat(props.type," has been delivered to ").concat(props.recipients," recipients."):1===props.recipients?"The ".concat(props.type," has been delivered to ").concat(props.recipients," recipient."):react.createElement("span",null,"No active users for this business.",react.createElement("br",null)," ",'Try inviting users to download the Aider app, by using the "Invite User" button on the left.',react.createElement("br",null)," ","Once these users are active you will be able to use the Action Centre for this business.")),react.createElement("div",{style:{display:"flex",justifyContent:"center"}},react.createElement("div",{className:"actionButton",onClick:function onClick(){Store_rootStore.conversationStore.renderMessageSentWindow(!1,null,null)}},"Okay"))))},components_AppAccountKickback=function AppAccountKickback(props){return react.createElement("div",{id:"metadataModal",className:"confirm-modal-container kickback"},react.createElement(lib.CardPanel,{className:"metadata-card"},react.createElement("h4",{style:{color:"#4264ea"}},"App Account Detected"),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},"Oops, it looks like you have signed into the Advisory Portal with a business account.",react.createElement("br",null),"Please click below to be redirected to the Aider mobile app, where you can sign in to the app."),react.createElement("div",{style:{display:"flex",justifyContent:"center"}},react.createElement("div",{onClick:function onClick(){window.open("https://aider.ai","_self")},style:{width:220},className:"actionButton"},"Redirect me to the App"))))},components_DuplicateBusinessWarning=function DuplicateBusinessWarning(props){return react.createElement("div",{id:"metadataModal",className:"confirm-modal-container kickback"},react.createElement(lib.CardPanel,{className:"metadata-card"},react.createElement("h4",{style:{color:"#4264ea"}},"Client Already Exists"),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},"Oops, it looks like client ",react.createElement("b",null,props.businessName)," already exists within the practice.",react.createElement("br",null),"Please contact your Practice Administrator for access to the existing business."),react.createElement("div",{style:{display:"flex",justifyContent:"center"}},react.createElement("div",{onClick:function onClick(){Store_rootStore.businessStore.renderDuplicateWarning(null)},style:{width:220},className:"actionButton"},"Okay"))))},components_ReconnectedBusinessWarning=function ReconnectedBusinessWarning(props){return react.createElement("div",{id:"metadataModal",className:"confirm-modal-container kickback"},react.createElement(lib.CardPanel,{className:"metadata-card"},react.createElement("h4",{style:{color:"#4264ea"}},"Client Reconnected"),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},"A client that already exists in the practice was reconnected to Xero.",react.createElement("br",null),"If you can not view the newly connected client, please contact your Practice Administrator for access."),react.createElement("div",{style:{display:"flex",justifyContent:"center"}},react.createElement("div",{onClick:function onClick(){Store_rootStore.businessStore.renderReconnectionConfirmation(null)},style:{width:220},className:"actionButton"},"Okay"))))},components_TakeMeToXero=function TakeMeToXero(props){return react.createElement("div",{id:"metadataModal",className:"confirm-modal-container"},react.createElement(lib.CardPanel,{className:"metadata-card"},react.createElement("h4",{style:{color:"#4264ea"}},"Xero",props.reconnection?" Reconnection":" Connection"),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},"Ill take you to Xeros login website, youll need to login with your Xero account.",react.createElement("br",null),props.reconnection?"Once there, just select the Xero business you would like to reconnect":""),react.createElement("div",{style:{display:"flex",justifyContent:"center",marginBottom:10}},react.createElement("div",{onClick:function onClick(){props.reconnection?reconnectConnection(Store_rootStore.authStore.links,Store_rootStore.businessStore.selectedBusinessAccessToken,Store_rootStore.businessStore.selectedBusinessId):props.initiateConnection()},style:{width:220},className:"actionButton"},"Go to Xero")),react.createElement("div",{style:{display:"flex",justifyContent:"center"}},react.createElement("div",{onClick:function onClick(){Store_rootStore.authStore.setTakeMeToXero(!1)},style:{width:220},className:"actionButton"},"Cancel"))))},components_ConfirmationPaymentModal=function ConfirmationPaymentModal(props){return react.createElement("div",{id:"metadataModal",className:"confirm-modal-container",onClick:function onClick(e){e.preventDefault(),e.stopPropagation()}},react.createElement(lib.CardPanel,{className:"metadata-card"},react.createElement("h4",{style:{color:"#4264ea"}},"Payment Accepted"),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},"Your subscription has been activated, thank you."),react.createElement("div",{style:{display:"flex",justifyContent:"center",marginBottom:10}},react.createElement("div",{style:{width:190},className:"actionButton",onClick:function onClick(){return Store_rootStore.authStore.initiateConnection(Store_rootStore.authStore.access_token)}},"Continue with Xero")),react.createElement("div",{style:{display:"flex",justifyContent:"center"}},react.createElement("div",{className:"actionButton",style:{width:190},onClick:function onClick(){Store_rootStore.authStore.renderPaymentConfirmation(!1)}},"Close"))))},components_ConfirmationDisconnectModal=function ConfirmationDisconnectModal(props){return react.createElement("div",{id:"metadataModal",className:"confirm-modal-container-dc fadedshort",onClick:function onClick(e){e.preventDefault(),e.stopPropagation()}},react.createElement(lib.CardPanel,{className:"metadata-card"},react.createElement("h4",{style:{color:"#4264ea"}},"Disconnect ",react.createElement("b",null,Store_rootStore.businessStore.selectedBusinessData.name)," from Xero?"),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},"The client will be disconnected."),react.createElement("div",{style:{display:"flex",justifyContent:"center"}},react.createElement("div",{className:"actionButton",onClick:function onClick(){Store_rootStore.businessStore.disconnectBusiness(),Store_rootStore.businessStore.renderDisconnectConfirmation(!1)}},"Yes")," ",react.createElement("div",{style:{marginLeft:20},className:"actionButton",onClick:function onClick(){Store_rootStore.businessStore.renderDisconnectConfirmation(!1)}},"No"))))},components_SubscriptionCancellationModal=function SubscriptionCancellationModal(props){return react.createElement("div",{id:"metadataModal",className:"confirm-modal-container",onClick:function onClick(e){e.preventDefault(),e.stopPropagation()}},react.createElement(lib.CardPanel,{className:"metadata-card"},react.createElement("h4",{style:{color:"#4264ea"}},"cancelled"===props.reason?"We're sorry to see you go!":"Error cancelling subscription"),react.createElement("p",{className:"metadata",style:{color:"#4264ea"}},"cancelled"===props.reason?"Your subscription has been cancelled, your account will still be active until the end of the month.":"There was an error cancelling your subscription."),react.createElement("div",{style:{display:"flex",justifyContent:"center"}},react.createElement("div",{className:"actionButton",onClick:function onClick(){Store_rootStore.authStore.renderSubscriptionCancellation(!1)}},"Okay"))))},InitialLoaderWithOverlay=(aider_dot_t_default.a,Object(mobxreact_esm.a)((function InitialLoaderWithOverlayComponent(props){return react.createElement("div",null,react.createElement("div",{style:{position:"relative",display:"flex",justifyContent:"center"}},react.createElement("div",{className:"animated forever bounce",style:{position:"absolute",top:178,display:"flex",justifyContent:"center",zIndex:999}},react.createElement("img",{src:aider_dot_t_default.a,width:97,height:90}))),react.createElement("div",{style:{height:"91%",position:"absolute",zIndex:998,opacity:Store_rootStore.businessStore.businessListData.length>=1?.5:.7,width:"100%"}},react.createElement("div",{className:"loading-container shallow",style:{paddingTop:250}})))})));function displaySignInError(error){switch(error.code){case"auth/user-disabled":return"Oops, your account has been disabled";case"auth/invalid-email":case"auth/user-not-found":case"auth/wrong-password":return"Invalid email or password";case"auth/email-already-in-use":return"A user with that email already exists";case"INVALID_DATA":case"other":return"Something went wrong with the information provided";default:return error.message}}function renderTopic(topic){switch(topic){case"notifications-etl-done-reminder":return"Connection Process Complete";case"finance-reconciliation-request":return"Reconciliation Request";case"finance-income-tax-estimate":return"Income Tax Estimate";case"finance-sales-tax-due":return"GST Payable";case"notifications-business-app-connected":return"Xero Connected";case"bill-overdue-summary":return"Bills Overdue";case"finance-total-costs":return"Total Cost";case"invoice-overdue":return"Invoices OverdueS";case"invoice-overdue-summary":return"Invoices Overdue";case"net-cash-position":return"Net Cash Position";case"finance-operating-expenses-details":return"Expense Report";case"bill-overdue":return"Bills OverduSe";case"gross-profit":return"Gross Profit";case"finance-net-profit":return"Net Profit";case"finance-average-daily-cash-comparison":return"Average Daily Cash Comparison";case"bills-due-proactive-message":return"Overdue Bills";case"finance-previous-week-cashflow":return"Cash Flow Previous Week";case"finance-cash-flow":case"finance-advisor-cash-flow":return"Cash Flow";case"finance-net-profit-margin":return"Net Profit";case"finance-average-creditor-days":return"Average Creditor";case"finance-gross-profit-margin":return"Gross Profit";case"finance-bank-account-summary":return"Bank Account";case"finance-operating-expenses-balance":return"Operating Expenses";case"finance-sales-tax":return"Sales Tax";case"bill-due":return"Bills Due";case"finance-accounts-payable-balance":return"Accounts Payable";case"invoice-largest-debtor":return"Largest Debtor";case"bill-largest-creditor":return"Largest Creditor";case"invoice-outstanding":return"Invoices Outstanding";case"bill-outstanding":return"Bills Outstanding";case"cashup-totals":case"cashup-total-by-type":return"Cash total";default:return"Did You Know..."}}function renderCard(card){var formattedCard=card,reformattedData=formattedCard.series[0].formattedData.map((function(string){return string.replace("\\n","\n").replace("\\n\\n","\n\n").replace("\\n","\n")}));return formattedCard.series[0].formattedData=reformattedData,formattedCard.cardType="discrete-graph-card",formattedCard.headers=card.title?[card.title]:[card.series[0].name,"","","","",""],"Cashflow for last week"!==card.title&&"Cashflow for last week"!==card.series[0].name&&"Cash Flow for last week"!==card.title&&"Cash Flow for last week"!==card.series[0].name&&"Cash Flow for this month"!==card.title&&"Cash Flow for this month"!==card.series[0].name&&"Cash Flow for last month"!==card.title&&"Cash Flow for last month"!==card.series[0].name||(formattedCard.headers=[""]),"Operating Expenses for this month"!==card.title&&"Operating Expenses for this month"!==card.series[0].name||(formattedCard.headers=["Operating Expenses for this month"]),formattedCard}function MoneyFormat(labelValue){return Math.abs(Number(labelValue))>=1e9?Math.abs(Number(labelValue))/1e9+"B":Math.abs(Number(labelValue))>=1e6?Math.abs(Number(labelValue))/1e6+"M":Math.abs(Number(labelValue))>=1e3?Math.abs(Number(labelValue))/1e3+"K":Math.abs(Number(labelValue))}function renderCurrency(unrounded){var number=unrounded;return"-"===(number=number>1e3?10*Math.ceil(unrounded/10):Math.ceil(unrounded)).toString()[0]?"-$"+MoneyFormat(number):"$"+MoneyFormat(number)}function renderCustomChartLabel(card){if("Cashflow for last week"===card.title||"Cashflow for last week"===card.series[0].name||"Cash Flow for this month"===card.title||"Cash Flow for this month"===card.series[0].name||"Cash Flow for last month"===card.title||"Cash Flow for last month"===card.series[0].name||"Cash Flow for last week"===card.title||"Cash Flow for last week"===card.series[0].name){var calculatedNumber=card.series[0].rawData[0]-card.series[0].rawData[1];return calculatedNumber!=calculatedNumber&&(calculatedNumber=0),react.createElement("div",{style:{position:"relative"}},react.createElement("div",{style:{fontSize:32,color:"#4264ea",width:200,height:60,position:"absolute",top:140,right:50,textAlign:"center"}},renderCurrency(calculatedNumber)),react.createElement("div",{style:{fontSize:14,color:"#4264ea",width:200,height:60,position:"absolute",top:190,right:50,textAlign:"center"}},card.title||card.series[0].name))}}try{closeModal.displayName="closeModal",closeModal.__docgenInfo={description:"",displayName:"closeModal",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#closeModal"]={docgenInfo:closeModal.__docgenInfo,name:"closeModal",path:"src/entities/components.tsx#closeModal"})}catch(__react_docgen_typescript_loader_error){}try{displaySignInError.displayName="displaySignInError",displaySignInError.__docgenInfo={description:"",displayName:"displaySignInError",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#displaySignInError"]={docgenInfo:displaySignInError.__docgenInfo,name:"displaySignInError",path:"src/entities/components.tsx#displaySignInError"})}catch(__react_docgen_typescript_loader_error){}try{renderTopic.displayName="renderTopic",renderTopic.__docgenInfo={description:"",displayName:"renderTopic",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#renderTopic"]={docgenInfo:renderTopic.__docgenInfo,name:"renderTopic",path:"src/entities/components.tsx#renderTopic"})}catch(__react_docgen_typescript_loader_error){}try{renderCard.displayName="renderCard",renderCard.__docgenInfo={description:"",displayName:"renderCard",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#renderCard"]={docgenInfo:renderCard.__docgenInfo,name:"renderCard",path:"src/entities/components.tsx#renderCard"})}catch(__react_docgen_typescript_loader_error){}try{renderCurrency.displayName="renderCurrency",renderCurrency.__docgenInfo={description:"",displayName:"renderCurrency",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#renderCurrency"]={docgenInfo:renderCurrency.__docgenInfo,name:"renderCurrency",path:"src/entities/components.tsx#renderCurrency"})}catch(__react_docgen_typescript_loader_error){}try{renderCustomChartLabel.displayName="renderCustomChartLabel",renderCustomChartLabel.__docgenInfo={description:"",displayName:"renderCustomChartLabel",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#renderCustomChartLabel"]={docgenInfo:renderCustomChartLabel.__docgenInfo,name:"renderCustomChartLabel",path:"src/entities/components.tsx#renderCustomChartLabel"})}catch(__react_docgen_typescript_loader_error){}try{components_ConfirmationModal.displayName="ConfirmationModal",components_ConfirmationModal.__docgenInfo={description:"",displayName:"ConfirmationModal",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#ConfirmationModal"]={docgenInfo:components_ConfirmationModal.__docgenInfo,name:"ConfirmationModal",path:"src/entities/components.tsx#ConfirmationModal"})}catch(__react_docgen_typescript_loader_error){}try{components_ConfirmationMessage.displayName="ConfirmationMessage",components_ConfirmationMessage.__docgenInfo={description:"",displayName:"ConfirmationMessage",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#ConfirmationMessage"]={docgenInfo:components_ConfirmationMessage.__docgenInfo,name:"ConfirmationMessage",path:"src/entities/components.tsx#ConfirmationMessage"})}catch(__react_docgen_typescript_loader_error){}try{components_ConfirmationMessageModal.displayName="ConfirmationMessageModal",components_ConfirmationMessageModal.__docgenInfo={description:"",displayName:"ConfirmationMessageModal",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#ConfirmationMessageModal"]={docgenInfo:components_ConfirmationMessageModal.__docgenInfo,name:"ConfirmationMessageModal",path:"src/entities/components.tsx#ConfirmationMessageModal"})}catch(__react_docgen_typescript_loader_error){}try{components_AppAccountKickback.displayName="AppAccountKickback",components_AppAccountKickback.__docgenInfo={description:"",displayName:"AppAccountKickback",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#AppAccountKickback"]={docgenInfo:components_AppAccountKickback.__docgenInfo,name:"AppAccountKickback",path:"src/entities/components.tsx#AppAccountKickback"})}catch(__react_docgen_typescript_loader_error){}try{components_DuplicateBusinessWarning.displayName="DuplicateBusinessWarning",components_DuplicateBusinessWarning.__docgenInfo={description:"",displayName:"DuplicateBusinessWarning",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#DuplicateBusinessWarning"]={docgenInfo:components_DuplicateBusinessWarning.__docgenInfo,name:"DuplicateBusinessWarning",path:"src/entities/components.tsx#DuplicateBusinessWarning"})}catch(__react_docgen_typescript_loader_error){}try{components_ReconnectedBusinessWarning.displayName="ReconnectedBusinessWarning",components_ReconnectedBusinessWarning.__docgenInfo={description:"",displayName:"ReconnectedBusinessWarning",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#ReconnectedBusinessWarning"]={docgenInfo:components_ReconnectedBusinessWarning.__docgenInfo,name:"ReconnectedBusinessWarning",path:"src/entities/components.tsx#ReconnectedBusinessWarning"})}catch(__react_docgen_typescript_loader_error){}try{components_TakeMeToXero.displayName="TakeMeToXero",components_TakeMeToXero.__docgenInfo={description:"",displayName:"TakeMeToXero",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#TakeMeToXero"]={docgenInfo:components_TakeMeToXero.__docgenInfo,name:"TakeMeToXero",path:"src/entities/components.tsx#TakeMeToXero"})}catch(__react_docgen_typescript_loader_error){}try{components_ConfirmationPaymentModal.displayName="ConfirmationPaymentModal",components_ConfirmationPaymentModal.__docgenInfo={description:"",displayName:"ConfirmationPaymentModal",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#ConfirmationPaymentModal"]={docgenInfo:components_ConfirmationPaymentModal.__docgenInfo,name:"ConfirmationPaymentModal",path:"src/entities/components.tsx#ConfirmationPaymentModal"})}catch(__react_docgen_typescript_loader_error){}try{components_ConfirmationDisconnectModal.displayName="ConfirmationDisconnectModal",components_ConfirmationDisconnectModal.__docgenInfo={description:"",displayName:"ConfirmationDisconnectModal",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#ConfirmationDisconnectModal"]={docgenInfo:components_ConfirmationDisconnectModal.__docgenInfo,name:"ConfirmationDisconnectModal",path:"src/entities/components.tsx#ConfirmationDisconnectModal"})}catch(__react_docgen_typescript_loader_error){}try{components_SubscriptionCancellationModal.displayName="SubscriptionCancellationModal",components_SubscriptionCancellationModal.__docgenInfo={description:"",displayName:"SubscriptionCancellationModal",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#SubscriptionCancellationModal"]={docgenInfo:components_SubscriptionCancellationModal.__docgenInfo,name:"SubscriptionCancellationModal",path:"src/entities/components.tsx#SubscriptionCancellationModal"})}catch(__react_docgen_typescript_loader_error){}try{InitialLoaderWithOverlay.displayName="InitialLoaderWithOverlay",InitialLoaderWithOverlay.__docgenInfo={description:"",displayName:"InitialLoaderWithOverlay",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/entities/components.tsx#InitialLoaderWithOverlay"]={docgenInfo:InitialLoaderWithOverlay.__docgenInfo,name:"InitialLoaderWithOverlay",path:"src/entities/components.tsx#InitialLoaderWithOverlay"})}catch(__react_docgen_typescript_loader_error){}var getIntercomVerification=function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(apiLinks,tokens){var headers,endpoint;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(console.log(Object(mobx_module.toJS)(tokens),"#tokens"),!tokens.access_token){_context.next=7;break}return headers={Authorization:"Bearer ".concat(tokens.access_token)},endpoint=apiLinks.intercomVerification.href.replace("{type}","web"),_context.abrupt("return",apiHelper_makeGetRequest(endpoint,headers).then((function(res){return businessService_BusinessService.refreshPracticeCredentials(),res})).catch((function(e){return console.log("fallback icv"),businessService_BusinessService.refreshPracticeCredentials().then((function(tokenRes){var headers={Authorization:"Bearer ".concat(tokenRes.access_token)},endpoint=apiLinks.intercomVerification.href.replace("{type}","web");return apiHelper_makeGetRequest(endpoint,headers).catch((function(e){console.log(e)}))}))})));case 7:return _context.abrupt("return",businessService_BusinessService.refreshPracticeCredentials().then((function(tokenRes){var headers={Authorization:"Bearer ".concat(tokenRes.access_token)},endpoint=apiLinks.intercomVerification.href.replace("{type}","web");return apiHelper_makeGetRequest(endpoint,headers).catch((function(e){console.log(e)}))})));case 8:case"end":return _context.stop()}}),_callee)})));return function getIntercomVerification(_x,_x2){return _ref.apply(this,arguments)}}(),loadIntercom=function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(config,apiLinks){var tokens,intercomVerification,appId,utm_source,utm_medium,utm_campaign,_getAcquisitionData,acquisition,decodedIdToken,company,business,_args2=arguments;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return tokens=_args2.length>2&&void 0!==_args2[2]?_args2[2]:{},_context2.next=3,getIntercomVerification(apiLinks,tokens);case 3:return intercomVerification=_context2.sent,appId=config.osp.intercom.appId,_getAcquisitionData=acquisitionHelper_getAcquisitionData(),acquisition=_getAcquisitionData.acquisition,Store_rootStore.authStore.setAcquisitionData(acquisition),acquisition&&(utm_source=acquisition.utmSource,utm_medium=acquisition.utmMedium,utm_campaign=acquisition.utmCampaign),(decodedIdToken=jsonwebtoken_default.a.decode(Store_rootStore.authStore.persistIdToken||Store_rootStore.authStore.id_token)).claims.businesses&&decodedIdToken.claims.businesses.length>0&&(business=decodedIdToken.claims.businesses[0],company={id:business.id,name:business.name,website:business.website,created_at:business.createdAt,area:business.area,country_code:business.countryCode,time_zone_id:business.timeZoneId}),window.intercomSettings={app_id:appId,hide_default_launcher:!0,user_id:decodedIdToken.sub,user_hash:intercomVerification._embedded.userVerification.hmac,name:decodedIdToken.claims.displayName,email:decodedIdToken.claims.email,phone:decodedIdToken.claims.phoneNumber,created_at:decodedIdToken.claims.createdAt,photo_url:decodedIdToken.claims.photoUrl,company:company,email_verified:decodedIdToken.claims.emailVerified,product:"advisory"},utm_source&&(window.intercomSettings.utm_source=utm_source),utm_medium&&(window.intercomSettings.utm_source=utm_medium),utm_campaign&&(window.intercomSettings.utm_source=utm_campaign),function(){var w=window,ic=w.Intercom;if("function"==typeof ic)ic("reattach_activator"),ic("update",w.intercomSettings);else{var d=document,i=function i(){i.c(arguments)};i.q=[],i.c=function(args){i.q.push(args)},w.Intercom=i;var s=d.createElement("script");s.type="text/javascript",s.async=!0,s.src="https://widget.intercom.io/widget/"+appId;var x=d.getElementsByTagName("script")[0];x.parentNode.insertBefore(s,x)}}(),_context2.abrupt("return",window.Intercom);case 16:case"end":return _context2.stop()}}),_callee2)})));return function loadIntercom(_x3,_x4){return _ref2.apply(this,arguments)}}(),dist_esm=__webpack_require__(76),react_router=__webpack_require__(1503),GoogleAnalytics_GoogleAnalytics=function(_Component){Object(inherits.a)(GoogleAnalytics,_Component);var _super=Object(createSuper.a)(GoogleAnalytics);function GoogleAnalytics(){return Object(classCallCheck.a)(this,GoogleAnalytics),_super.apply(this,arguments)}return Object(createClass.a)(GoogleAnalytics,[{key:"componentDidMount",value:function componentDidMount(){this.logPageChange(this.props.location.pathname,this.props.location.search)}},{key:"componentDidUpdate",value:function componentDidUpdate(_ref){var prevLocation=_ref.location,_this$props$location=this.props.location,pathname=_this$props$location.pathname,search=_this$props$location.search,isDifferentPathname=pathname!==prevLocation.pathname,isDifferentSearch=search!==prevLocation.search;(isDifferentPathname||isDifferentSearch)&&this.logPageChange(pathname,search)}},{key:"logPageChange",value:function logPageChange(pathname){var search=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",page=pathname+search,_window=window,location=_window.location;dist_esm.a.set(Object(objectSpread2.a)({page:page,location:"".concat(location.origin).concat(page)},this.props.options)),dist_esm.a.pageview(page)}},{key:"render",value:function render(){return null}}]),GoogleAnalytics}(react.Component),GoogleAnalytics_eventPipeline=function eventPipeline(eventType){var errorCode=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(eventType){case"signInError":dist_esm.a.exception({description:"An error ocurred when Signing In: ".concat(errorCode),fatal:!1});break;case"otherError":dist_esm.a.exception({description:"An error occurred: ".concat(errorCode),fatal:!1});break;case"selectBusiness":console.log("selectBusiness");break;case"signOut":dist_esm.a.event({category:"User",action:"Signed Out of an Account"}),console.log("signOut");break;case"signIn":dist_esm.a.event({category:"User",action:"Signed Into an Account"}),console.log("signIn");break;case"OAuth2InitOutbound":dist_esm.a.outboundLink({label:"Clicked Create an Account"},(function(){console.log("redirected")}));break;case"inviteBusiness":dist_esm.a.event({category:"User",action:"Invited a Business to the Practice"});break;case"inviteUser":dist_esm.a.event({category:"User",action:"Invited a User to the Platform"});break;case"sendMessage":dist_esm.a.event({category:"Conversation",action:"Sent a Message"});break;case"voteMessageUp":dist_esm.a.event({category:"Conversation",action:"Voted a Message Up"});break;case"voteMessageDown":dist_esm.a.event({category:"Conversation",action:"Voted a Message Down"});break;case"clearNotification":dist_esm.a.event({category:"Notifications",action:"Cleared Notifications"});break;case"addedApp":dist_esm.a.event({category:"User",action:"Added an App"})}},src_GoogleAnalytics={GoogleAnalytics:GoogleAnalytics_GoogleAnalytics,RouteTracker:function RouteTracker(){return react_default.a.createElement(react_router.a,{component:GoogleAnalytics_GoogleAnalytics})},init:function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(){var trackingId,_args=arguments;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _args.length>0&&void 0!==_args[0]?_args[0]:{},trackingId=_args.length>1?_args[1]:void 0,_context.abrupt("return",dist_esm.a.initialize(trackingId));case 3:case"end":return _context.stop()}}),_callee)})));return function init(){return _ref2.apply(this,arguments)}}()};function getParameterByName(name,url){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var results=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)").exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null}function removeURLParameter(url,parameter){var urlparts=url.split("?");if(urlparts.length>=2){for(var prefix=encodeURIComponent(parameter)+"=",pars=urlparts[1].split(/[&;]/g),i=pars.length;i-- >0;)-1!==pars[i].lastIndexOf(prefix,0)&&pars.splice(i,1);return urlparts[0]+(pars.length>0?"?"+pars.join("&"):"")}return url}var authStore_dec,authStore_dec2,authStore_dec3,authStore_dec4,authStore_dec5,authStore_dec6,authStore_dec7,authStore_dec8,authStore_dec9,authStore_dec10,authStore_dec11,authStore_dec12,authStore_dec13,authStore_dec14,authStore_dec15,authStore_dec16,authStore_dec17,authStore_dec18,authStore_dec19,authStore_dec20,authStore_dec21,authStore_dec22,authStore_dec23,authStore_dec24,authStore_dec25,authStore_dec26,authStore_dec27,authStore_dec28,authStore_dec29,authStore_dec30,authStore_dec31,authStore_dec32,authStore_dec33,authStore_dec34,authStore_dec35,authStore_dec36,authStore_dec37,authStore_dec38,authStore_dec39,authStore_dec40,authStore_dec41,authStore_dec42,authStore_class,authStore_descriptor,authStore_descriptor2,authStore_descriptor3,authStore_descriptor4,authStore_descriptor5,authStore_descriptor6,authStore_descriptor7,authStore_descriptor8,authStore_descriptor9,authStore_descriptor10,authStore_descriptor11,authStore_descriptor12,authStore_descriptor13,authStore_descriptor14,authStore_descriptor15,authStore_descriptor16,authStore_descriptor17,authStore_descriptor18,authStore_descriptor19,authStore_descriptor20,authStore_descriptor21,authStore_descriptor22,authStore_descriptor23,authStore_descriptor24,authStore_descriptor25,authStore_descriptor26,authStore_descriptor27,authStore_descriptor28,authStore_descriptor29,authStore_descriptor30,authStore_descriptor31,authStore_descriptor32,authStore_descriptor33,authStore_descriptor34,authStore_descriptor35,authStore_descriptor36,authStore_descriptor37,authStore_descriptor38,authStore_descriptor39,authStore_descriptor40,authStore_descriptor41,authStore_descriptor42,authStore_descriptor43,authStore_descriptor44,_descriptor45,_descriptor46,_descriptor47,_descriptor48,_descriptor49,_descriptor50,advisorChatStore_dec,advisorChatStore_dec2,advisorChatStore_dec3,advisorChatStore_dec4,advisorChatStore_dec5,advisorChatStore_dec6,advisorChatStore_dec7,advisorChatStore_dec8,advisorChatStore_dec9,advisorChatStore_dec10,advisorChatStore_dec11,advisorChatStore_dec12,advisorChatStore_dec13,advisorChatStore_dec14,advisorChatStore_dec15,advisorChatStore_dec16,advisorChatStore_dec17,advisorChatStore_class,advisorChatStore_descriptor,advisorChatStore_descriptor2,advisorChatStore_descriptor3,advisorChatStore_descriptor4,advisorChatStore_descriptor5,advisorChatStore_descriptor6,advisorChatStore_descriptor7,advisorChatStore_descriptor8,advisorChatStore_descriptor9,advisorChatStore_descriptor10,advisorChatStore_descriptor11,advisorChatStore_descriptor12,advisorChatStore_descriptor13,advisorChatStore_descriptor14,advisorChatStore_descriptor15,advisorChatStore_descriptor16,advisorChatStore_descriptor17,advisorChatStore_descriptor18,advisorChatStore_descriptor19,advisorChatStore_descriptor20,advisorChatStore_descriptor21,Store_dec,Store_class,Store_descriptor,authService_AuthService=function(){function AuthService(){Object(classCallCheck.a)(this,AuthService)}var _initializeAuthentication,_IfConnectionExistsThenCreateNewBusiness,_checkOutstandingConnectionClaim,_initializeNewBusinessTokens,_claimConnectionWithBusinessId,_initiateConnection,_getNewPracticeTokens,_initGA,_setApps,_checkRedirectKnowingFirebaseInitialized,_initializeTokens,_Intercom;return Object(createClass.a)(AuthService,null,[{key:"initializeFirebaseApp",value:function initializeFirebaseApp(config){return console.log(">>>",config),index_cjs_default.a.initializeApp(config),Object(firestorter_module.c)({firebase:index_cjs_default.a}),new Promise((function(resolve){if(index_cjs_default.a.auth().currentUser)resolve(!0);else var unsubscribe=index_cjs_default.a.auth().onAuthStateChanged((function(user){unsubscribe(),resolve(!!user)}))})).catch((function(e){esm.a(e),console.log("init error",e)}))}},{key:"Intercom",value:(_Intercom=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(type,eventName,params){return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId).then(function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(res){var parameters,intercom;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(parameters=Object.assign(params,{business_id:Store_rootStore.businessStore.selectedBusinessId}),console.log("intercom tracked event: ",type,eventName),!Store_rootStore.authStore.config||!Store_rootStore.authStore.links){_context.next=7;break}return _context.next=5,loadIntercom(Store_rootStore.authStore.config,Store_rootStore.authStore.links);case 5:return intercom=_context.sent,_context.abrupt("return",intercom(type,eventName,parameters));case 7:return _context.abrupt("return",null);case 8:case"end":return _context.stop()}}),_callee)})));return function(_x4){return _ref.apply(this,arguments)}}()).catch((function(e){console.log("intercom err",e)}));case 1:case"end":return _context2.stop()}}),_callee2)}))),function Intercom(_x,_x2,_x3){return _Intercom.apply(this,arguments)})},{key:"handleSignIn",value:function handleSignIn(email,password){Store_rootStore.authStore.setLoading(!0),Store_rootStore.authStore.setLoadingContent(["Signing You In..."]),index_cjs_default.a.auth().signInWithEmailAndPassword(email,password).catch((function(e){esm.a(e),Store_rootStore.registerGAEvent("signInError",e.code),Store_rootStore.authStore.setLoading(!1);var signInError=displaySignInError(e);Store_rootStore.authStore.setSignInError(signInError)})).then((function(authResult){Store_rootStore.registerGAEvent("signIn"),Store_rootStore.authStore.isUserAuthenticated(authResult)}))}},{key:"signUpUsingEmail",value:function signUpUsingEmail(fields){return Store_rootStore.authStore.setLoading(!0),index_cjs_default.a.auth().createUserWithEmailAndPassword(fields.email,fields.password).catch((function(error){Store_rootStore.authStore.setLoading(!1);var signInError=displaySignInError(error);return Store_rootStore.authStore.setSignInError(signInError)})).then((function(authResult){userDataHelper_addUser(authResult,Store_rootStore.authStore.links,!1,null,fields,"password").then((function(res){})).catch((function(e){if(esm.a(e),Store_rootStore.authStore.setLoading(!1),!Store_rootStore.authStore.signInError){var signInError=displaySignInError({code:"other",message:e});return Store_rootStore.authStore.setSignInError(signInError)}}))}))}},{key:"signUpUsingSocial",value:function signUpUsingSocial(type){if("google"===type&&(js_cookie_default.a.set("redirect","true",{domain:"http://localhost:3000"}),function signUpUsingGoogle(firebase){var provider=new firebase.auth.GoogleAuthProvider;provider.setCustomParameters({prompt:"select_account"}),firebase.auth().signInWithRedirect(provider)}(index_cjs_default.a),Store_rootStore.authStore.setLoading(!0)),"facebook"===type&&(!function signUpUsingFacebook(firebase){var provider=new firebase.auth.FacebookAuthProvider;provider.setCustomParameters({auth_type:"https"}),firebase.auth().signInWithRedirect(provider)}(index_cjs_default.a),Store_rootStore.authStore.setLoading(!0)),"xero"===type){var acquisition=acquisitionHelper_getAcquisitionData().acquisition;Store_rootStore.authStore.setAcquisitionData(acquisition),js_cookie_default.a.set("redirect","redirect-xero",{domain:"http://localhost:3000"}),signUpUsingXero(Store_rootStore.authStore.links).then((function(){Store_rootStore.authStore.setLoading(!0)}))}}},{key:"handleSignOut",value:function handleSignOut(){Store_rootStore.registerGAEvent("signOut"),index_cjs_default.a.auth().signOut().then((function(){js_cookie_default.a.remove("claimant"),js_cookie_default.a.remove("unclaimedConnection"),js_cookie_default.a.remove("inviteAdvisors"),js_cookie_default.a.remove("skipCreation"),js_cookie_default.a.remove("redirect"),Store_rootStore.authStore.invalidateCache(),Store_rootStore.authStore.isUserAuthenticated(!1),Store_rootStore.authStore.setUser(null),Store_rootStore.authStore.setLoading(!1),setTimeout((function(){window.location.reload()}),1e3)}))}},{key:"initializeTokens",value:(_initializeTokens=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(){var token,partnerCustomerTokenInRedirectURL,links,user,idToken,_yield$initializeBack,access_token,refresh_token,id_token,internalTokenAssignment,_internalTokenAssignment,_args3=arguments;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(token=_args3.length>0&&void 0!==_args3[0]?_args3[0]:"",partnerCustomerTokenInRedirectURL=_args3.length>1?_args3[1]:void 0,links=Store_rootStore.authStore.links,user=Store_rootStore.authStore.user,_context3.prev=4,idToken=token,token){_context3.next=10;break}return _context3.next=9,user.getIdToken();case 9:idToken=_context3.sent;case 10:if(!user){_context3.next=44;break}return _context3.next=13,userDataHelper_checkUserExists(links,user.uid);case 13:if(!0!==_context3.sent){_context3.next=24;break}return _context3.next=17,initializeBackendTokens(links,idToken);case 17:return _yield$initializeBack=_context3.sent,access_token=_yield$initializeBack.access_token,refresh_token=_yield$initializeBack.refresh_token,id_token=_yield$initializeBack.id_token,Store_rootStore.authStore.setTokens(access_token,refresh_token,id_token),Store_rootStore.authStore.isUserAuthenticated(user),_context3.abrupt("return",{access_token:access_token,refresh_token:refresh_token,id_token:id_token});case 24:if(!user.providerData[0]||"google.com"!==user.providerData[0].providerId){_context3.next=34;break}return _context3.next=27,userDataHelper_addUserWithGoogle(user,Store_rootStore.authStore.links,!1);case 27:return _context3.sent,_context3.next=30,initializeBackendTokens(links,idToken);case 30:return internalTokenAssignment=_context3.sent,Store_rootStore.authStore.setTokens(internalTokenAssignment.access_token,internalTokenAssignment.refresh_token,internalTokenAssignment.id_token),Store_rootStore.authStore.isUserAuthenticated(user),_context3.abrupt("return",{access_token:internalTokenAssignment.access_token,refresh_token:internalTokenAssignment.refresh_token,id_token:internalTokenAssignment.id_token});case 34:if(!partnerCustomerTokenInRedirectURL){_context3.next=44;break}return _context3.next=37,userDataHelper_addUserWithXero(user,Store_rootStore.authStore.links,partnerCustomerTokenInRedirectURL);case 37:return _context3.sent,_context3.next=40,initializeBackendTokens(links,idToken);case 40:return _internalTokenAssignment=_context3.sent,Store_rootStore.authStore.setTokens(_internalTokenAssignment.access_token,_internalTokenAssignment.refresh_token,_internalTokenAssignment.id_token),Store_rootStore.authStore.isUserAuthenticated(user),_context3.abrupt("return",{access_token:_internalTokenAssignment.access_token,refresh_token:_internalTokenAssignment.refresh_token,id_token:_internalTokenAssignment.id_token});case 44:_context3.next=50;break;case 46:_context3.prev=46,_context3.t0=_context3.catch(4),esm.a(_context3.t0),"User already exists"===_context3.t0.message&&(console.log("login unsuccessful, likely due to cross SSO implementation. Try email and password"),index_cjs_default.a.auth().signOut().then((function(){Store_rootStore.authStore.isUserAuthenticated(!1),Store_rootStore.authStore.setUser(null),Store_rootStore.authStore.setLoading(!1);var signInError=displaySignInError({code:"none",message:"Login Unsuccessful."});Store_rootStore.authStore.setSignInError(signInError)})));case 50:case"end":return _context3.stop()}}),_callee3,null,[[4,46]])}))),function initializeTokens(){return _initializeTokens.apply(this,arguments)})},{key:"checkRedirectKnowingFirebaseInitialized",value:(_checkRedirectKnowingFirebaseInitialized=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(redirect,links,user){var cat,partnerCustomerTokenInRedirectURL,url,authResult;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(cat=getParameterByName("cat",window.location.href),"redirect-xero"!==redirect&&!cat){_context4.next=20;break}if(Store_rootStore.authStore.setLoading(!0),partnerCustomerTokenInRedirectURL=getParameterByName("token",window.location.href),url=removeURLParameter(window.location.href,"cat"),url=removeURLParameter(url,"token"),window.history.replaceState(null,document.title,url),!cat){_context4.next=18;break}return _context4.next=10,index_cjs_default.a.auth().signInWithCustomToken(cat);case 10:return authResult=_context4.sent,_context4.next=13,userDataHelper_checkUserExists(Store_rootStore.authStore.links,authResult.user.uid);case 13:if(!0!==_context4.sent){_context4.next=17;break}return Store_rootStore.authStore.isUserAuthenticated(authResult),_context4.abrupt("return",partnerCustomerTokenInRedirectURL);case 17:return _context4.abrupt("return",partnerCustomerTokenInRedirectURL);case 18:_context4.next=22;break;case 20:if("true"!==redirect){_context4.next=22;break}return _context4.abrupt("return",!1);case 22:case"end":return _context4.stop()}}),_callee4)}))),function checkRedirectKnowingFirebaseInitialized(_x5,_x6,_x7){return _checkRedirectKnowingFirebaseInitialized.apply(this,arguments)})},{key:"checkRedirect",value:function checkRedirect(redirect){if(Store_rootStore.authStore.firebaseInitialized){if("true"===redirect)return Store_rootStore.authStore.setLoadingContent(["Redirecting you to the Portal...","Configuring Account Data..."]),Store_rootStore.authStore.setLoading(!0);if("redirect-xero"===redirect){var cat=getParameterByName("cat",window.location.href),partnerCustomerTokenInRedirectURL=getParameterByName("token",window.location.href);Store_rootStore.authStore.setPartnerCustomerTokenInRedirectURL(partnerCustomerTokenInRedirectURL);var url=removeURLParameter(window.location.href,"cat");url=removeURLParameter(url,"token"),window.history.replaceState(null,document.title,url),index_cjs_default.a.auth().signInWithCustomToken(cat).then((function(authResult){return Store_rootStore.authStore.isUserAuthenticated(authResult)})).catch((function(error){esm.a(error)}))}}else if("redirect-xero"===redirect)Store_rootStore.authStore.setLoading(!0),setTimeout((function(){var cat=getParameterByName("cat",window.location.href),partnerCustomerTokenInRedirectURL=getParameterByName("token",window.location.href),url=removeURLParameter(window.location.href,"cat");url=removeURLParameter(url,"token"),window.history.replaceState(null,document.title,url),cat&&index_cjs_default.a.auth().signInWithCustomToken(cat).then((function(authResult){return userDataHelper_checkUserExists(Store_rootStore.authStore.links,authResult.user.uid).then((function(res){if(!0===res)return Store_rootStore.authStore.isUserAuthenticated(authResult);partnerCustomerTokenInRedirectURL&&userDataHelper_addUser(authResult,Store_rootStore.authStore.links,!1,partnerCustomerTokenInRedirectURL,null,null).then((function(res){return Store_rootStore.authStore.isUserAuthenticated(authResult)}))}))})).catch((function(error){esm.a(error)}))}),1e3);else if("true"===redirect)return Store_rootStore.authStore.setLoading(!0)}},{key:"setApps",value:(_setApps=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee5(links){var configResponse;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,makeGetRequest(links.apps.href,{});case 2:configResponse=_context5.sent,Store_rootStore.authStore.setApps(configResponse._embedded.apps);case 4:case"end":return _context5.stop()}}),_callee5)}))),function setApps(_x8){return _setApps.apply(this,arguments)})},{key:"initGA",value:(_initGA=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee6(){var rootResponse,apiLinks,configResponse,config,_config$analytics,googleAnalytics,googleTagManager;return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,makeGetRequest("https://aider-ai-staging.appspot.com/api/v1/root",{});case 2:return rootResponse=_context6.sent,apiLinks=rootResponse._links,_context6.next=6,makeGetRequest(apiLinks.config.href,{});case 6:configResponse=_context6.sent,config=configResponse._embedded.configuration,_config$analytics=config.analytics,googleAnalytics=_config$analytics.googleAnalytics,googleTagManager=_config$analytics.googleTagManager,src_GoogleAnalytics.init({},googleAnalytics.trackingId),dist_default.a.initialize({gtmId:googleTagManager.advisorPortalContainerId});case 11:case"end":return _context6.stop()}}),_callee6)}))),function initGA(){return _initGA.apply(this,arguments)})},{key:"getNewPracticeTokens",value:(_getNewPracticeTokens=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee7(){var practiceId,user,idToken,businessLink,tokenLink,headers,body,backendTokens;return regenerator_default.a.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return practiceId=Store_rootStore.businessStore.practiceId.id,user=Store_rootStore.authStore.user,_context7.next=4,user.getIdToken();case 4:return idToken=_context7.sent,businessLink=Store_rootStore.authStore.links.businesses.href,tokenLink=Store_rootStore.authStore.links.tokens.href,headers={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat("h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z")))},body={grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:idToken,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",resource:"".concat(businessLink,"/").concat(practiceId)},_context7.next=11,apiHelper_makePostRequest(tokenLink,headers,qs_lib_default.a.stringify(body));case 11:return backendTokens=_context7.sent,_context7.abrupt("return",backendTokens);case 13:case"end":return _context7.stop()}}),_callee7)}))),function getNewPracticeTokens(){return _getNewPracticeTokens.apply(this,arguments)})},{key:"initiateConnection",value:(_initiateConnection=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee8(access_token){var tokens,res;return regenerator_default.a.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,businessService_BusinessService.refreshPracticeCredentials();case 2:return tokens=_context8.sent,_context8.next=5,createConnection(Store_rootStore.authStore.links,tokens.access_token);case 5:return res=_context8.sent,console.log("init",res),_context8.abrupt("return",res);case 8:case"end":return _context8.stop()}}),_callee8)}))),function initiateConnection(_x9){return _initiateConnection.apply(this,arguments)})},{key:"claimConnectionWithBusinessId",value:(_claimConnectionWithBusinessId=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee9(links,idToken,businessId,claimant,unclaimedConnection){var _yield$initializeNewX,access_token,claimed;return regenerator_default.a.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,initializeNewXeroBusinessBackendTokens(links,idToken,claimant,Store_rootStore.authStore);case 2:return _yield$initializeNewX=_context9.sent,access_token=_yield$initializeNewX.access_token,_yield$initializeNewX.refresh_token,_yield$initializeNewX.id_token,_yield$initializeNewX.expiresAt,_context9.next=9,claimConnection(Store_rootStore.authStore.links,access_token,unclaimedConnection);case 9:void 0!==(claimed=_context9.sent)&&(js_cookie_default.a.set("claimant","null"),js_cookie_default.a.set("unclaimedConnection","null"),console.log("CONNECTION SUCCESSFULLY CLAIMED",claimed),Store_rootStore.businessStore.selectBusinessAfterClaimingConnection(claimant,access_token),setTimeout((function(){Store_rootStore.businessStore.selectedBusinessAccessToken,Store_rootStore.businessStore.selectedBusinessId,Store_rootStore.businessStore.setBusinessFirstTimeSetup(!0),Store_rootStore.businessStore.setFirstTimeClientSetup(!1),Store_rootStore.businessStore.shouldConfigureBusiness(!0)}),1e3));case 11:case"end":return _context9.stop()}}),_callee9)}))),function claimConnectionWithBusinessId(_x10,_x11,_x12,_x13,_x14){return _claimConnectionWithBusinessId.apply(this,arguments)})},{key:"initializeNewBusinessTokens",value:(_initializeNewBusinessTokens=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee10(){var businessId,links,user,idToken,businessRegistry,unclaimedConnection,claimant,_businessRegistry$tok,_access_token,_refresh_token,_id_token,_expiresAt,selectedBusinessId,_yield$initializeNewB,access_token,refresh_token,id_token,expiresAt,_args10=arguments;return regenerator_default.a.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return businessId=_args10.length>0&&void 0!==_args10[0]?_args10[0]:"",links=Store_rootStore.authStore.links,user=Store_rootStore.authStore.user,_context10.next=5,user.getIdToken();case 5:if(idToken=_context10.sent,businessRegistry=Store_rootStore.authStore.registryExistsAndTokensNotExpired(businessId),unclaimedConnection=js_cookie_default.a.get("unclaimedConnection"),claimant=js_cookie_default.a.get("claimant"),"null"===unclaimedConnection&&void 0===unclaimedConnection||claimant!==businessId){_context10.next=12;break}return _context10.next=12,AuthService.claimConnectionWithBusinessId(links,idToken,businessId,claimant,unclaimedConnection);case 12:if(!businessRegistry){_context10.next=16;break}if("boolean"==typeof businessRegistry){_context10.next=16;break}return _businessRegistry$tok=businessRegistry.tokens,_access_token=_businessRegistry$tok.access_token,_refresh_token=_businessRegistry$tok.refresh_token,_id_token=_businessRegistry$tok.id_token,_expiresAt=_businessRegistry$tok.expiresAt,_context10.abrupt("return",{access_token:_access_token,refresh_token:_refresh_token,id_token:_id_token,expiresAt:_expiresAt});case 16:return selectedBusinessId=businessId,_context10.next=19,initializeNewBusinessBackendTokens(links,idToken,selectedBusinessId,Store_rootStore.authStore);case 19:return _yield$initializeNewB=_context10.sent,access_token=_yield$initializeNewB.access_token,refresh_token=_yield$initializeNewB.refresh_token,id_token=_yield$initializeNewB.id_token,expiresAt=_yield$initializeNewB.expiresAt,_context10.abrupt("return",{access_token:access_token,refresh_token:refresh_token,id_token:id_token,expiresAt:expiresAt});case 25:case"end":return _context10.stop()}}),_callee10)}))),function initializeNewBusinessTokens(){return _initializeNewBusinessTokens.apply(this,arguments)})},{key:"checkOutstandingConnectionClaim",value:(_checkOutstandingConnectionClaim=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee11(){var businessId,links,user,idToken,unclaimedConnection,claimant,_args11=arguments;return regenerator_default.a.wrap((function _callee11$(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return businessId=_args11.length>0&&void 0!==_args11[0]?_args11[0]:"",console.log("checking::",businessId),links=Store_rootStore.authStore.links,user=Store_rootStore.authStore.user,_context11.next=6,user.getIdToken();case 6:if(idToken=_context11.sent,unclaimedConnection=js_cookie_default.a.get("unclaimedConnection"),claimant=js_cookie_default.a.get("claimant"),"null"===unclaimedConnection&&void 0===unclaimedConnection||claimant!==businessId){_context11.next=13;break}return console.log("OUTSTANDING CLAIM: ATTEMPT",businessId),_context11.next=13,AuthService.claimConnectionWithBusinessId(links,idToken,businessId,claimant,unclaimedConnection);case 13:case"end":return _context11.stop()}}),_callee11)}))),function checkOutstandingConnectionClaim(){return _checkOutstandingConnectionClaim.apply(this,arguments)})},{key:"IfConnectionExistsThenCreateNewBusiness",value:(_IfConnectionExistsThenCreateNewBusiness=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee13(connectionID){var practiceId;return regenerator_default.a.wrap((function _callee13$(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:if("true"!==js_cookie_default.a.get("skipCreation")){_context13.next=6;break}return console.log("skipping creating business"),js_cookie_default.a.set("claimant","null"),js_cookie_default.a.set("unclaimedConnection","null"),js_cookie_default.a.set("skipCreation","null"),_context13.abrupt("return",window.location.href="http://localhost:3000");case 6:return console.log(".s",js_cookie_default.a.get("skipCreation")),_context13.next=9,businessService_BusinessService.fetchPracticeId(Store_rootStore.authStore.links,Store_rootStore.authStore.persistAccessToken);case 9:(practiceId=_context13.sent)&&checkConnection(Store_rootStore.authStore.links,Store_rootStore.authStore.persistAccessToken,connectionID).catch((function(e){console.log("error conn",e),esm.a(e)})).then(function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee12(status){var newBusinessParameters,newBusinessParametersObject,newBusiness,newBusinessId;return regenerator_default.a.wrap((function _callee12$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(!status||!status._embedded||"pending"!==status._embedded.connection.status){_context12.next=4;break}js_cookie_default.a.set("connID",connectionID),_context12.next=22;break;case 4:if(!status||!status._embedded||"pending"===status._embedded.connection.status){_context12.next=20;break}if("duplicate_client_connection"===status._embedded.connection.reason){_context12.next=15;break}return newBusinessParameters={phoneNumber:"",address:"",name:"",area:"",countryCode:"NZ",timeZoneId:"Pacific/Auckland"},status._embedded.connection.configuration&&(newBusinessParameters=status._embedded.connection.configuration.entities[0]),newBusinessParametersObject={phoneNumber:newBusinessParameters.phoneNumber||"",address:newBusinessParameters.address||"",name:newBusinessParameters.name||"",area:newBusinessParameters.area||"Auckland",countryCode:newBusinessParameters.countryCode||"NZ",timeZoneId:newBusinessParameters.timeZoneId||"Pacific/Auckland"},_context12.next=11,Store_rootStore.businessStore.createBusinessFromXeroConnection(Store_rootStore.authStore.links,Store_rootStore.authStore.persistAccessToken,newBusinessParametersObject,practiceId);case 11:(newBusiness=_context12.sent)?(newBusinessId=newBusiness.data._embedded.business.id,js_cookie_default.a.set("unclaimedConnection",status._embedded.connection.id),js_cookie_default.a.set("claimant",newBusinessId),window.location.href="http://localhost:3000"):(esm.b("Could not create new business from connection"),console.log("error creating the new business",newBusiness),window.location.href="http://localhost:3000"),_context12.next=18;break;case 15:return console.log(".duplicate detected"),js_cookie_default.a.set("duplicateConnection","".concat(status._embedded.connection.configuration?status._embedded.connection.configuration.entities[0].name:"Duplicate Business")),_context12.abrupt("return",window.location.href="http://localhost:3000");case 18:_context12.next=22;break;case 20:console.log("something went seriously wrong with connection",status),window.location.href="http://localhost:3000";case 22:case"end":return _context12.stop()}}),_callee12)})));return function(_x16){return _ref2.apply(this,arguments)}}());case 11:case"end":return _context13.stop()}}),_callee13)}))),function IfConnectionExistsThenCreateNewBusiness(_x15){return _IfConnectionExistsThenCreateNewBusiness.apply(this,arguments)})},{key:"initializeAuthentication",value:(_initializeAuthentication=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee16(){var proxyOK,rootResponse,apiLinks,configResponse,config,redirect,firebaseIsInitialized,partnerCustomerTokenInRedirectURL,_this=this;return regenerator_default.a.wrap((function _callee16$(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:return _context16.next=2,Store_rootStore.businessStore.pingProxyServer();case 2:return proxyOK=_context16.sent,console.log("proxy:",proxyOK.status,proxyOK.statusText),200!==proxyOK.status&&esm.b("proxy failure, using fallback"),console.log("#begin",moment_default()().format("hh:mm:ss")),Store_rootStore.businessStore.setProxyStatus(proxyOK.status),Store_rootStore.authStore.setLoadingContent(["Signing In..."]),_context16.next=10,makeGetRequest("https://aider-ai-staging.appspot.com/api/v1/root",{});case 10:return rootResponse=_context16.sent,apiLinks=rootResponse._links,_context16.next=14,makeGetRequest(apiLinks.config.href,{});case 14:return configResponse=_context16.sent,config=configResponse._embedded.configuration,Store_rootStore.authStore.registerLinks(apiLinks),Store_rootStore.authStore.setConfig(config),redirect=js_cookie_default.a.get("redirect"),_context16.next=21,AuthService.initializeFirebaseApp(config.firebase);case 21:if(firebaseIsInitialized=_context16.sent,partnerCustomerTokenInRedirectURL=null,!firebaseIsInitialized){_context16.next=33;break}return Store_rootStore.authStore.setFireBaseInitialized(),_context16.next=27,AuthService.checkRedirectKnowingFirebaseInitialized(redirect,apiLinks,Store_rootStore.authStore.user);case 27:partnerCustomerTokenInRedirectURL=_context16.sent,js_cookie_default.a.set("redirect","false",{domain:"http://localhost:3000"}),Store_rootStore.authStore.setLoading(!1),console.log("#fb1",moment_default()().format("hh:mm:ss")),_context16.next=40;break;case 33:return Store_rootStore.authStore.setFireBaseInitialized(),_context16.next=36,AuthService.checkRedirectKnowingFirebaseInitialized(redirect,apiLinks,Store_rootStore.authStore.user);case 36:partnerCustomerTokenInRedirectURL=_context16.sent,js_cookie_default.a.set("redirect","false",{domain:"http://localhost:3000"}),Store_rootStore.authStore.setLoading(!1),console.log("#fb",moment_default()().format("hh:mm:ss"));case 40:return _context16.prev=40,_context16.abrupt("return",index_cjs_default.a.auth().onAuthStateChanged(function(){var _ref3=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee15(userAuth){var info,tokens,user,_config$analytics2,googleTagManager,query,connectionID,duplicateConnection,reconnectedConnection,practice;return regenerator_default.a.wrap((function _callee15$(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:return console.log("#cb",moment_default()().format("hh:mm:ss")),Store_rootStore.authStore.setLoading(!0),_context15.next=4,AuthService.setApps(apiLinks);case 4:if(Store_rootStore.authStore.setUser(userAuth),info=null,!Store_rootStore.authStore.user){_context15.next=81;break}if(console.log("#user",moment_default()().format("hh:mm:ss")),Store_rootStore.authStore.setSignInError(null),!Store_rootStore.authStore.persistAccessToken||!Store_rootStore.authStore.persistIdToken||"true"===js_cookie_default.a.get("inviteAdvisors")){_context15.next=17;break}console.log("use persisted data"),tokens={access_token:Store_rootStore.authStore.persistAccessToken,refresh_token:Store_rootStore.authStore.persistRefreshToken,id_token:Store_rootStore.authStore.persistIdToken,expiresAt:Store_rootStore.authStore.persistExpiry},Store_rootStore.authStore.setTokens(tokens.access_token,tokens.refresh_token,tokens.id_token),Store_rootStore.authStore.isUserAuthenticated(Store_rootStore.authStore.user),console.log("#tokenSet",moment_default()().format("hh:mm:ss")),_context15.next=20;break;case 17:return _context15.next=19,_this.initializeTokens(null,partnerCustomerTokenInRedirectURL);case 19:tokens=_context15.sent;case 20:if(!tokens&&!Store_rootStore.authStore.access_token){_context15.next=78;break}if(console.log(!Object(mobx_module.toJS)(Store_rootStore.authStore.persistPracticeUser)),Object(mobx_module.toJS)(Store_rootStore.authStore.persistPracticeUser)){_context15.next=28;break}return _context15.next=25,getUser(apiLinks,Store_rootStore.authStore.user.uid,null);case 25:user=_context15.sent,_context15.next=29;break;case 28:user=Store_rootStore.authStore.persistPracticeUser;case 29:if(!user){_context15.next=36;break}console.log("#userResponse",moment_default()().format("hh:mm:ss")),Store_rootStore.authStore.setPracticeUser(user),(_config$analytics2=config.analytics).googleAnalytics,googleTagManager=_config$analytics2.googleTagManager,dist_default.a.initialize({gtmId:googleTagManager.advisorPortalContainerId,dataLayer:{userId:Store_rootStore.authStore.user.uid,userProject:"aider-ai"}}),_context15.next=37;break;case 36:throw"user does not exist";case 37:return info=jsonwebtoken_default.a.decode(tokens.id_token),console.log("INFORMATION:",info),console.log("_USER_",info,Store_rootStore.authStore.loading,"___",Object(mobx_module.toJS)(user)),console.log("#decoded",moment_default()().format("hh:mm:ss")),_context15.next=43,businessService_BusinessService.refreshPracticeCredentials().then(function(){var _ref4=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee14(tokenSet){return regenerator_default.a.wrap((function _callee14$(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return _context14.next=2,loadIntercom(config,apiLinks,tokenSet);case 2:case"end":return _context14.stop()}}),_callee14)})));return function(_x18){return _ref4.apply(this,arguments)}}());case 43:if(Store_rootStore.authStore.setLoading(!1),query=qs_lib_default.a.parse(window.location.search.replace("?","")),connectionID=query.connectionId,duplicateConnection=js_cookie_default.a.get("duplicateConnection"),reconnectedConnection=js_cookie_default.a.get("reconnectedConnection"),duplicateConnection&&Store_rootStore.businessStore.renderDuplicateWarning(duplicateConnection),reconnectedConnection&&Store_rootStore.businessStore.renderReconnectionConfirmation(reconnectedConnection),""===connectionID||null==connectionID){_context15.next=55;break}return _context15.next=53,AuthService.IfConnectionExistsThenCreateNewBusiness(connectionID);case 53:_context15.next=76;break;case 55:if(!(info.claims.businesses.length>=1&&info.claims.businesses.filter((function(business){return"management"===business.businessClass})).length<1||"advisory_portal"!==info.claims.accountType)){_context15.next=58;break}return esm.b("digital_app account detected"),_context15.abrupt("return",Store_rootStore.authStore.setRenderAppAccountKickback(!0));case 58:return console.log("a"),(!info.claims.businesses||info.claims.businesses.length<1)&&Store_rootStore.businessStore.shouldSetUpPractice(!0),_context15.next=62,Store_rootStore.businessStore.fetchBusinessAccessTokens(Store_rootStore.authStore.links,tokens.access_token,tokens.id_token).then((function(){console.log("b")}));case 62:if(console.log("#info",info),practice=info.claims.businesses.filter((function(i){return"management"===i.businessClass}))[0],console.log(info.claims.businesses,practice,"<> ?"),js_cookie_default.a.remove("selectedBusiness"),!practice){_context15.next=74;break}return Store_rootStore.businessStore.setPracticeId(practice),Store_rootStore.businessStore.fetchSubscription(Store_rootStore.authStore.links,Store_rootStore.authStore.access_token),_context15.next=71,Store_rootStore.businessStore.getPracticeAdvisors(Store_rootStore.authStore.links);case 71:"true"===js_cookie_default.a.get("inviteAdvisors")&&Store_rootStore.authStore.renderAdvisorsModal(!0),_context15.next=76;break;case 74:Store_rootStore.authStore.setLoading(!1),console.log("no practice",practice);case 76:_context15.next=79;break;case 78:console.log("no tokens",tokens);case 79:_context15.next=83;break;case 81:console.log("no user",Store_rootStore.authStore.user),Store_rootStore.authStore.setLoading(!1);case 83:case"end":return _context15.stop()}}),_callee15)})));return function(_x17){return _ref3.apply(this,arguments)}}()));case 44:_context16.prev=44,_context16.t0=_context16.catch(40),esm.a(_context16.t0),console.log("fallback error:",_context16.t0),Store_rootStore.authStore.setLoading(!1);case 49:case"end":return _context16.stop()}}),_callee16,null,[[40,44]])}))),function initializeAuthentication(){return _initializeAuthentication.apply(this,arguments)})}]),AuthService}(),mobx_persist_lib=__webpack_require__(113),authStore_AuthStore=(authStore_dec=Object(mobx_persist_lib.persist)("object"),authStore_dec2=mobx_module.action.bound,authStore_dec3=mobx_module.action.bound,authStore_dec4=mobx_module.action.bound,authStore_dec5=mobx_module.action.bound,authStore_dec6=mobx_module.action.bound,authStore_dec7=mobx_module.action.bound,authStore_dec8=mobx_module.action.bound,authStore_dec9=mobx_module.action.bound,authStore_dec10=mobx_module.action.bound,authStore_dec11=mobx_module.action.bound,authStore_dec12=mobx_module.action.bound,authStore_dec13=mobx_module.action.bound,authStore_dec14=mobx_module.action.bound,authStore_dec15=mobx_module.action.bound,authStore_dec16=mobx_module.action.bound,authStore_dec17=mobx_module.action.bound,authStore_dec18=mobx_module.action.bound,authStore_dec19=mobx_module.action.bound,authStore_dec20=mobx_module.action.bound,authStore_dec21=mobx_module.action.bound,authStore_dec22=mobx_module.action.bound,authStore_dec23=mobx_module.action.bound,authStore_dec24=mobx_module.action.bound,authStore_dec25=mobx_module.action.bound,authStore_dec26=mobx_module.action.bound,authStore_dec27=mobx_module.action.bound,authStore_dec28=mobx_module.action.bound,authStore_dec29=mobx_module.action.bound,authStore_dec30=mobx_module.action.bound,authStore_dec31=mobx_module.action.bound,authStore_dec32=mobx_module.action.bound,authStore_dec33=mobx_module.action.bound,authStore_dec34=mobx_module.action.bound,authStore_dec35=mobx_module.action.bound,authStore_dec36=mobx_module.action.bound,authStore_dec37=mobx_module.action.bound,authStore_dec38=mobx_module.action.bound,authStore_dec39=mobx_module.action.bound,authStore_dec40=mobx_module.action.bound,authStore_dec41=mobx_module.action.bound,authStore_dec42=mobx_module.action.bound,authStore_class=function(){function AuthStore(rootStore){Object(classCallCheck.a)(this,AuthStore),this.rootStore=void 0,this.initializeAuthentication=void 0,this.initGA=void 0,this.initializeFirebaseApp=void 0,this.initializeTokens=void 0,this.checkRedirect=void 0,this.initializeNewBusinessTokens=void 0,this.checkOutstandingConnectionClaim=void 0,this.handleSignIn=void 0,this.handleSignOut=void 0,this.Intercom=void 0,this.signUpUsingEmail=void 0,this.signUpUsingSocial=void 0,this.initiateConnection=void 0,Object(initializerDefineProperty.a)(this,"config",authStore_descriptor,this),Object(initializerDefineProperty.a)(this,"loading",authStore_descriptor2,this),Object(initializerDefineProperty.a)(this,"shallowLoading",authStore_descriptor3,this),Object(initializerDefineProperty.a)(this,"tokenRegistry",authStore_descriptor4,this),Object(initializerDefineProperty.a)(this,"loadingInfoContent",authStore_descriptor5,this),Object(initializerDefineProperty.a)(this,"signInError",authStore_descriptor6,this),Object(initializerDefineProperty.a)(this,"businessNavigatorPopupOpen",authStore_descriptor7,this),Object(initializerDefineProperty.a)(this,"notificationsPopupOpen",authStore_descriptor8,this),Object(initializerDefineProperty.a)(this,"messagingPopUpOpen",authStore_descriptor9,this),Object(initializerDefineProperty.a)(this,"trainAiderPopUpOpen",authStore_descriptor10,this),Object(initializerDefineProperty.a)(this,"favoritesPopupOpen",authStore_descriptor11,this),Object(initializerDefineProperty.a)(this,"actionCentrePopupOpen",authStore_descriptor12,this),Object(initializerDefineProperty.a)(this,"currentConversation",authStore_descriptor13,this),Object(initializerDefineProperty.a)(this,"firebaseInitialized",authStore_descriptor14,this),Object(initializerDefineProperty.a)(this,"redirected",authStore_descriptor15,this),Object(initializerDefineProperty.a)(this,"isAuthed",authStore_descriptor16,this),Object(initializerDefineProperty.a)(this,"authResult",authStore_descriptor17,this),Object(initializerDefineProperty.a)(this,"user",authStore_descriptor18,this),Object(initializerDefineProperty.a)(this,"apps",authStore_descriptor19,this),Object(initializerDefineProperty.a)(this,"partnerCustomerTokenInRedirectURL",authStore_descriptor20,this),Object(initializerDefineProperty.a)(this,"links",authStore_descriptor21,this),Object(initializerDefineProperty.a)(this,"links2",authStore_descriptor22,this),Object(initializerDefineProperty.a)(this,"access_token",authStore_descriptor23,this),Object(initializerDefineProperty.a)(this,"refresh_token",authStore_descriptor24,this),Object(initializerDefineProperty.a)(this,"id_token",authStore_descriptor25,this),Object(initializerDefineProperty.a)(this,"practiceUser",authStore_descriptor26,this),Object(initializerDefineProperty.a)(this,"userModalErrors",authStore_descriptor27,this),Object(initializerDefineProperty.a)(this,"GAInitialized",authStore_descriptor28,this),Object(initializerDefineProperty.a)(this,"dropdownOpen",authStore_descriptor29,this),Object(initializerDefineProperty.a)(this,"editUserModalVisible",authStore_descriptor30,this),Object(initializerDefineProperty.a)(this,"exceededQuota",authStore_descriptor31,this),Object(initializerDefineProperty.a)(this,"paymentConfirmation",authStore_descriptor32,this),Object(initializerDefineProperty.a)(this,"subscriptionCancellation",authStore_descriptor33,this),Object(initializerDefineProperty.a)(this,"subscriptionCreationError",authStore_descriptor34,this),Object(initializerDefineProperty.a)(this,"renderAppAccountKickback",authStore_descriptor35,this),Object(initializerDefineProperty.a)(this,"takeMeToXero",authStore_descriptor36,this),Object(initializerDefineProperty.a)(this,"fallbackPaymentModal",authStore_descriptor37,this),Object(initializerDefineProperty.a)(this,"utm",authStore_descriptor38,this),Object(initializerDefineProperty.a)(this,"editAdvisorsModalVisible",authStore_descriptor39,this),Object(initializerDefineProperty.a)(this,"showConfigureAccessTab",authStore_descriptor40,this),Object(initializerDefineProperty.a)(this,"advisorTokens",authStore_descriptor41,this),Object(initializerDefineProperty.a)(this,"practiceTokenExpiry",authStore_descriptor42,this),Object(initializerDefineProperty.a)(this,"practiceTokens",authStore_descriptor43,this),Object(initializerDefineProperty.a)(this,"persistUserString",authStore_descriptor44,this),Object(initializerDefineProperty.a)(this,"persistIsAuthed",_descriptor45,this),Object(initializerDefineProperty.a)(this,"persistAccessToken",_descriptor46,this),Object(initializerDefineProperty.a)(this,"persistExpiry",_descriptor47,this),Object(initializerDefineProperty.a)(this,"persistIdToken",_descriptor48,this),Object(initializerDefineProperty.a)(this,"persistRefreshToken",_descriptor49,this),Object(initializerDefineProperty.a)(this,"persistPracticeUser",_descriptor50,this),this.rootStore=rootStore,this.initializeAuthentication=authService_AuthService.initializeAuthentication,this.initializeFirebaseApp=authService_AuthService.initializeFirebaseApp,this.initGA=authService_AuthService.initGA,this.initializeTokens=authService_AuthService.initializeTokens,this.initializeNewBusinessTokens=authService_AuthService.initializeNewBusinessTokens,this.checkOutstandingConnectionClaim=authService_AuthService.checkOutstandingConnectionClaim,this.initiateConnection=authService_AuthService.initiateConnection,this.handleSignIn=authService_AuthService.handleSignIn,this.signUpUsingEmail=authService_AuthService.signUpUsingEmail,this.signUpUsingSocial=authService_AuthService.signUpUsingSocial,this.handleSignOut=authService_AuthService.handleSignOut,this.Intercom=authService_AuthService.Intercom,this.checkRedirect=authService_AuthService.checkRedirect}return Object(createClass.a)(AuthStore,[{key:"storeAdvisorTokens",value:function storeAdvisorTokens(tokens){this.persistAccessToken=tokens.access_token,this.advisorTokens=tokens}},{key:"invalidateCache",value:function invalidateCache(){this.persistUserString="",this.persistIsAuthed=!1,this.persistAccessToken=null,this.persistExpiry=null,this.persistIdToken=null,this.persistRefreshToken=null,this.persistPracticeUser=null}},{key:"storeAdvisorTokensAndUpdateExpiry",value:function storeAdvisorTokensAndUpdateExpiry(tokens){this.persistAccessToken=tokens.access_token,this.persistExpiry=Math.floor(Date.now()/1e3)+tokens.expires_in,this.practiceTokenExpiry=Math.floor(Date.now()/1e3)+tokens.expires_in,console.log("--ex",tokens.expires_in),this.practiceTokens=tokens}},{key:"hasExceededQuota",value:function hasExceededQuota(exceeded){this.exceededQuota=exceeded}},{key:"renderFallbackPaymentModal",value:function renderFallbackPaymentModal(fallback){this.fallbackPaymentModal=fallback}},{key:"setAcquisitionData",value:function setAcquisitionData(utm){js_cookie_default.a.set("utm",utm),this.utm=utm;var url=removeURLParameter(window.location.href,"utm_source");url=removeURLParameter(url,"utm_medium"),url=removeURLParameter(url,"utm_campaign"),window.history.replaceState(null,document.title,url)}},{key:"setLoadingContent",value:function setLoadingContent(contentArray){var _this$loadingInfoCont;(_this$loadingInfoCont=this.loadingInfoContent).push.apply(_this$loadingInfoCont,Object(toConsumableArray.a)(contentArray))}},{key:"setLoading",value:function setLoading(loading){this.loading=loading}},{key:"setShallowLoader",value:function setShallowLoader(loading){this.shallowLoading=loading}},{key:"setRenderAppAccountKickback",value:function setRenderAppAccountKickback(renderKickback){this.renderAppAccountKickback=renderKickback}},{key:"setPracticeUser",value:function setPracticeUser(user){this.practiceUser=user}},{key:"closeActionCentrePopup",value:function closeActionCentrePopup(){this.actionCentrePopupOpen=!1}},{key:"renderPaymentConfirmation",value:function renderPaymentConfirmation(showConfirmation){this.paymentConfirmation=showConfirmation}},{key:"renderSubscriptionCancellation",value:function renderSubscriptionCancellation(showConfirmation){this.subscriptionCancellation=showConfirmation}},{key:"renderSubscriptionCreationError",value:function renderSubscriptionCreationError(showConfirmation){this.subscriptionCreationError=showConfirmation}},{key:"closeNotificationsPopup",value:function closeNotificationsPopup(){this.notificationsPopupOpen=!1}},{key:"closeMessagingPopup",value:function closeMessagingPopup(){this.messagingPopUpOpen=!1}},{key:"closeTrainAiderPopup",value:function closeTrainAiderPopup(){this.trainAiderPopUpOpen=!1}},{key:"setTakeMeToXero",value:function setTakeMeToXero(renderModal){this.takeMeToXero=renderModal}},{key:"closeFavoritesPopup",value:function closeFavoritesPopup(){this.favoritesPopupOpen=!1}},{key:"closeBusinessNavigatorPopup",value:function closeBusinessNavigatorPopup(){this.businessNavigatorPopupOpen=!1}},{key:"validateUserModal",value:function validateUserModal(error){this.userModalErrors=error}},{key:"setConfig",value:function setConfig(config){this.config=config}},{key:"setSignInError",value:function setSignInError(error){this.signInError=error}},{key:"setFireBaseInitialized",value:function setFireBaseInitialized(){this.firebaseInitialized=!0}},{key:"isUserAuthenticated",value:function isUserAuthenticated(authResult){this.persistIsAuthed="undefined"!==authResult||!1!==authResult,this.isAuthed=void 0!==authResult||!1!==authResult,this.authResult=authResult,this.loading=!1}},{key:"setUser",value:function setUser(user){this.persistUserString=".user",this.user=user,null!==user&&esm.c((function(scope){scope.setUser({id:user&&user.uid||null,email:user&&user.email||null,name:user&&user.name||null}),scope.setLevel("warning")}))}},{key:"setApps",value:function setApps(apps){this.apps=apps}},{key:"setPartnerCustomerTokenInRedirectURL",value:function setPartnerCustomerTokenInRedirectURL(cat){this.partnerCustomerTokenInRedirectURL=cat}},{key:"registerLinks",value:function registerLinks(links){this.links=links}},{key:"registerLinks2",value:function registerLinks2(links){this.links2=links}},{key:"registryExistsAndTokensNotExpired",value:function registryExistsAndTokensNotExpired(businessId){var _this=this,businessRegistry=this.tokenRegistry.find((function(business){return business.id===businessId}));return void 0!==businessRegistry&&(new Date(1e3*parseInt(businessRegistry.tokens.expiresAt))>new Date||(console.log("expired token detected","".concat(new Date(1e3*parseInt(businessRegistry.tokens.expiresAt))),new Date,new Date(1e3*parseInt(businessRegistry.tokens.expiresAt))<new Date),refreshTokensVerbose(Store_rootStore.authStore.links,businessRegistry.tokens).then((function(updatedTokens){_this.refreshBusinessTokens(updatedTokens,businessId)}))),businessRegistry)}},{key:"triggerDropdownOpen",value:function triggerDropdownOpen(isOpen){this.dropdownOpen=isOpen}},{key:"setConfigureAccessTab",value:function setConfigureAccessTab(isOpen){this.showConfigureAccessTab=isOpen}},{key:"renderAdvisorsModal",value:function renderAdvisorsModal(isOpen,redirect){return"share"===redirect?(this.editAdvisorsModalVisible=!0,this.showConfigureAccessTab=!0):"invite"===redirect?(this.editAdvisorsModalVisible=!0,this.showConfigureAccessTab=!1):(this.editAdvisorsModalVisible&&"true"===js_cookie_default.a.get("inviteAdvisors")&&js_cookie_default.a.remove("inviteAdvisors"),this.editAdvisorsModalVisible=isOpen)}},{key:"renderEditUserModal",value:function renderEditUserModal(isOpen){this.editUserModalVisible=isOpen}},{key:"refreshBusinessTokens",value:function refreshBusinessTokens(tokens,businessId){var registryExists=this.tokenRegistry.find((function(registry){return registry.id===businessId}));return Store_rootStore.businessStore.setBusinessAccessToken(tokens.access_token),registryExists.tokens=tokens}},{key:"refreshBusinessTokensVerbose",value:function refreshBusinessTokensVerbose(businessId){try{var businessRegistry=Store_rootStore.authStore.tokenRegistry.find((function(business){return business.id===businessId}));refreshTokensVerbose(Store_rootStore.authStore.links,businessRegistry.tokens).then((function(updatedTokens){return businessRegistry.tokens=updatedTokens}))}catch(e){console.log("refresh token error",e)}}},{key:"registerNewBusinessToken",value:function registerNewBusinessToken(tokens,businessId){if(this.registryExistsAndTokensNotExpired(businessId));else{var registryExists=this.tokenRegistry.find((function(registry){return registry.id===businessId}));registryExists&&(registryExists.tokens=tokens),this.tokenRegistry.push({id:businessId,tokens:tokens})}}},{key:"setTokens",value:function setTokens(access_token,refresh_token,id_token){this.persistAccessToken=access_token,this.persistIdToken=id_token,this.persistRefreshToken=refresh_token,this.access_token=access_token,this.refresh_token=refresh_token,this.id_token=id_token}},{key:"getBusinessToken",value:function getBusinessToken(businessId){var _this2=this,business=this.registryExistsAndTokensNotExpired(businessId);if(business)return business.tokens.access_token;this.initializeNewBusinessTokens(businessId).then((function(){var business=_this2.registryExistsAndTokensNotExpired(businessId);return"boolean"!=typeof business?business.tokens.access_token:null}))}}]),AuthStore}(),authStore_descriptor=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"config",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),authStore_descriptor2=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"loading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),authStore_descriptor3=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"shallowLoading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),authStore_descriptor4=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"tokenRegistry",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[{id:"123",tokens:{id_token:"nothing here",expiresAt:new Date,access_token:"",refresh_token:""}}]}}),authStore_descriptor5=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"loadingInfoContent",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return["Initializing Portal..."]}}),authStore_descriptor6=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"signInError",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),authStore_descriptor7=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"businessNavigatorPopupOpen",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),authStore_descriptor8=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"notificationsPopupOpen",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),authStore_descriptor9=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"messagingPopUpOpen",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),authStore_descriptor10=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"trainAiderPopUpOpen",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),authStore_descriptor11=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"favoritesPopupOpen",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),authStore_descriptor12=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"actionCentrePopupOpen",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),authStore_descriptor13=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"currentConversation",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),authStore_descriptor14=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"firebaseInitialized",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor15=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"redirected",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor16=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"isAuthed",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor17=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"authResult",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),authStore_descriptor18=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"user",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),authStore_descriptor19=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"apps",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),authStore_descriptor20=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"partnerCustomerTokenInRedirectURL",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),authStore_descriptor21=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"links",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),authStore_descriptor22=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"links2",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),authStore_descriptor23=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"access_token",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return""}}),authStore_descriptor24=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"refresh_token",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return""}}),authStore_descriptor25=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"id_token",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return""}}),authStore_descriptor26=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"practiceUser",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),authStore_descriptor27=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"userModalErrors",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),authStore_descriptor28=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"GAInitialized",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor29=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"dropdownOpen",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor30=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"editUserModalVisible",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor31=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"exceededQuota",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor32=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"paymentConfirmation",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor33=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"subscriptionCancellation",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor34=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"subscriptionCreationError",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor35=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"renderAppAccountKickback",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor36=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"takeMeToXero",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor37=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"fallbackPaymentModal",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor38=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"utm",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),authStore_descriptor39=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"editAdvisorsModalVisible",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor40=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"showConfigureAccessTab",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),authStore_descriptor41=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"advisorTokens",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{access_token:"",refresh_token:"",id_token:""}}}),authStore_descriptor42=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"practiceTokenExpiry",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),authStore_descriptor43=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"practiceTokens",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{access_token:"",refresh_token:"",id_token:"",expires_in:""}}}),authStore_descriptor44=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"persistUserString",[mobx_persist_lib.persist,mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return""}}),_descriptor45=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"persistIsAuthed",[mobx_persist_lib.persist,mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),_descriptor46=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"persistAccessToken",[mobx_persist_lib.persist,mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor47=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"persistExpiry",[mobx_persist_lib.persist,mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor48=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"persistIdToken",[mobx_persist_lib.persist,mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor49=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"persistRefreshToken",[mobx_persist_lib.persist,mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),_descriptor50=Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"persistPracticeUser",[authStore_dec,mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"storeAdvisorTokens",[authStore_dec2],Object.getOwnPropertyDescriptor(authStore_class.prototype,"storeAdvisorTokens"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"invalidateCache",[authStore_dec3],Object.getOwnPropertyDescriptor(authStore_class.prototype,"invalidateCache"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"storeAdvisorTokensAndUpdateExpiry",[authStore_dec4],Object.getOwnPropertyDescriptor(authStore_class.prototype,"storeAdvisorTokensAndUpdateExpiry"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"hasExceededQuota",[authStore_dec5],Object.getOwnPropertyDescriptor(authStore_class.prototype,"hasExceededQuota"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"renderFallbackPaymentModal",[authStore_dec6],Object.getOwnPropertyDescriptor(authStore_class.prototype,"renderFallbackPaymentModal"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setAcquisitionData",[authStore_dec7],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setAcquisitionData"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setLoadingContent",[authStore_dec8],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setLoadingContent"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setLoading",[authStore_dec9],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setLoading"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setShallowLoader",[authStore_dec10],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setShallowLoader"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setRenderAppAccountKickback",[authStore_dec11],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setRenderAppAccountKickback"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setPracticeUser",[authStore_dec12],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setPracticeUser"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"closeActionCentrePopup",[authStore_dec13],Object.getOwnPropertyDescriptor(authStore_class.prototype,"closeActionCentrePopup"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"renderPaymentConfirmation",[authStore_dec14],Object.getOwnPropertyDescriptor(authStore_class.prototype,"renderPaymentConfirmation"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"renderSubscriptionCancellation",[authStore_dec15],Object.getOwnPropertyDescriptor(authStore_class.prototype,"renderSubscriptionCancellation"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"renderSubscriptionCreationError",[authStore_dec16],Object.getOwnPropertyDescriptor(authStore_class.prototype,"renderSubscriptionCreationError"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"closeNotificationsPopup",[authStore_dec17],Object.getOwnPropertyDescriptor(authStore_class.prototype,"closeNotificationsPopup"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"closeMessagingPopup",[authStore_dec18],Object.getOwnPropertyDescriptor(authStore_class.prototype,"closeMessagingPopup"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"closeTrainAiderPopup",[authStore_dec19],Object.getOwnPropertyDescriptor(authStore_class.prototype,"closeTrainAiderPopup"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setTakeMeToXero",[authStore_dec20],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setTakeMeToXero"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"closeFavoritesPopup",[authStore_dec21],Object.getOwnPropertyDescriptor(authStore_class.prototype,"closeFavoritesPopup"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"closeBusinessNavigatorPopup",[authStore_dec22],Object.getOwnPropertyDescriptor(authStore_class.prototype,"closeBusinessNavigatorPopup"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"validateUserModal",[authStore_dec23],Object.getOwnPropertyDescriptor(authStore_class.prototype,"validateUserModal"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setConfig",[authStore_dec24],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setConfig"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setSignInError",[authStore_dec25],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setSignInError"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setFireBaseInitialized",[authStore_dec26],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setFireBaseInitialized"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"isUserAuthenticated",[authStore_dec27],Object.getOwnPropertyDescriptor(authStore_class.prototype,"isUserAuthenticated"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setUser",[authStore_dec28],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setUser"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setApps",[authStore_dec29],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setApps"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setPartnerCustomerTokenInRedirectURL",[authStore_dec30],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setPartnerCustomerTokenInRedirectURL"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"registerLinks",[authStore_dec31],Object.getOwnPropertyDescriptor(authStore_class.prototype,"registerLinks"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"registerLinks2",[authStore_dec32],Object.getOwnPropertyDescriptor(authStore_class.prototype,"registerLinks2"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"registryExistsAndTokensNotExpired",[authStore_dec33],Object.getOwnPropertyDescriptor(authStore_class.prototype,"registryExistsAndTokensNotExpired"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"triggerDropdownOpen",[authStore_dec34],Object.getOwnPropertyDescriptor(authStore_class.prototype,"triggerDropdownOpen"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setConfigureAccessTab",[authStore_dec35],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setConfigureAccessTab"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"renderAdvisorsModal",[authStore_dec36],Object.getOwnPropertyDescriptor(authStore_class.prototype,"renderAdvisorsModal"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"renderEditUserModal",[authStore_dec37],Object.getOwnPropertyDescriptor(authStore_class.prototype,"renderEditUserModal"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"refreshBusinessTokens",[authStore_dec38],Object.getOwnPropertyDescriptor(authStore_class.prototype,"refreshBusinessTokens"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"refreshBusinessTokensVerbose",[authStore_dec39],Object.getOwnPropertyDescriptor(authStore_class.prototype,"refreshBusinessTokensVerbose"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"registerNewBusinessToken",[authStore_dec40],Object.getOwnPropertyDescriptor(authStore_class.prototype,"registerNewBusinessToken"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"setTokens",[authStore_dec41],Object.getOwnPropertyDescriptor(authStore_class.prototype,"setTokens"),authStore_class.prototype),Object(applyDecoratedDescriptor.a)(authStore_class.prototype,"getBusinessToken",[authStore_dec42],Object.getOwnPropertyDescriptor(authStore_class.prototype,"getBusinessToken"),authStore_class.prototype),authStore_class),advisorChatService_AdvisorChatService=function(){function AdvisorChatService(){Object(classCallCheck.a)(this,AdvisorChatService)}var _createChatWithUserId,_createChat,_getConversationMessagesWithUserIdLoading,_getConversationPreviousMessages,_getConversationMessagesWithUserId,_getConversationMessages,_getChats;return Object(createClass.a)(AdvisorChatService,null,[{key:"getChats",value:(_getChats=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(){var tokens;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return Store_rootStore.advisorChatStore.setChatLoading(!0),_context.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:tokens=_context.sent,makeGetRequest("".concat("https://aider-ai-staging.appspot.com","/api/v2/conversations/chats"),{Authorization:"Bearer ".concat(tokens.access_token)}).then((function(data){Store_rootStore.advisorChatStore.storeChatsList(data,Store_rootStore.businessStore.selectedBusinessId).then((function(res){Store_rootStore.advisorChatStore.setChatLoading(!1)}),(function(e){console.log(e),Store_rootStore.advisorChatStore.setChatLoading(!1)}))}),(function(error){Store_rootStore.registerGAEvent("otherError"),Store_rootStore.advisorChatStore.setChatLoading(!1),console.log("err:",error)})).catch((function(e){esm.a(e),console.log("other error",e),Store_rootStore.advisorChatStore.setChatLoading(!1)}));case 5:case"end":return _context.stop()}}),_callee)}))),function getChats(){return _getChats.apply(this,arguments)})},{key:"getConversationMessages",value:(_getConversationMessages=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(chatId){var tokens;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context3.sent,Store_rootStore.advisorChatStore.setChatLoading(!0),_context3.abrupt("return",makeGetRequest("".concat("https://aider-ai-staging.appspot.com","/api/v2/conversations/chats/").concat(chatId,"/messages"),{Authorization:"Bearer ".concat(tokens.access_token)}).then(function(){var _ref=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(data){return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",Store_rootStore.advisorChatStore.storeConversation(data).then((function(res){return Store_rootStore.advisorChatStore.setChatLoading(!1),res}),(function(e){console.log(e),Store_rootStore.advisorChatStore.setChatLoading(!1)})));case 1:case"end":return _context2.stop()}}),_callee2)})));return function(_x2){return _ref.apply(this,arguments)}}(),(function(error){Store_rootStore.registerGAEvent("otherError"),Store_rootStore.advisorChatStore.setChatLoading(!1),console.log("err:",error)})).catch((function(e){esm.a(e),console.log("other error",e),Store_rootStore.advisorChatStore.setChatLoading(!1)})));case 5:case"end":return _context3.stop()}}),_callee3)}))),function getConversationMessages(_x){return _getConversationMessages.apply(this,arguments)})},{key:"getConversationMessagesWithUserId",value:(_getConversationMessagesWithUserId=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee5(userId,cbTokens){var tokens;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(null!==Store_rootStore.advisorChatStore.selectedConversationId&&null!==Store_rootStore.advisorChatStore.selectedConversationName&&Store_rootStore.advisorChatStore.selectedUserId===userId){_context5.next=2;break}return _context5.abrupt("return",!1);case 2:if(!cbTokens){_context5.next=6;break}tokens=cbTokens,_context5.next=9;break;case 6:return _context5.next=8,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 8:tokens=_context5.sent;case 9:return _context5.abrupt("return",makeGetRequest("".concat("https://aider-ai-staging.appspot.com","/api/v2/conversations/chats/advisorChat/messages?clientId=").concat(userId),{Authorization:"Bearer ".concat(tokens.access_token)}).then(function(){var _ref2=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(data){return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",Store_rootStore.advisorChatStore.storeConversation(data));case 1:case"end":return _context4.stop()}}),_callee4)})));return function(_x5){return _ref2.apply(this,arguments)}}(),(function(error){Store_rootStore.registerGAEvent("otherError"),console.log("err:",error)})).catch((function(e){esm.a(e),console.log("other error",e)})));case 10:case"end":return _context5.stop()}}),_callee5)}))),function getConversationMessagesWithUserId(_x3,_x4){return _getConversationMessagesWithUserId.apply(this,arguments)})},{key:"getConversationPreviousMessages",value:(_getConversationPreviousMessages=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee7(){var tokens;return regenerator_default.a.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:return tokens=_context7.sent,_context7.abrupt("return",makeGetRequest("".concat(Store_rootStore.advisorChatStore.previousMessagesLink),{Authorization:"Bearer ".concat(tokens.access_token)}).then(function(){var _ref3=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee6(data){return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.abrupt("return",Store_rootStore.advisorChatStore.storePreviousMessages(data));case 1:case"end":return _context6.stop()}}),_callee6)})));return function(_x6){return _ref3.apply(this,arguments)}}(),(function(error){Store_rootStore.registerGAEvent("otherError"),console.log("err:",error)})).catch((function(e){esm.a(e),console.log("other error",e)})));case 4:case"end":return _context7.stop()}}),_callee7)}))),function getConversationPreviousMessages(){return _getConversationPreviousMessages.apply(this,arguments)})},{key:"getConversationMessagesWithUserIdLoading",value:(_getConversationMessagesWithUserIdLoading=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee9(userId,cbTokens){var tokens;return regenerator_default.a.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(Store_rootStore.authStore.Intercom("trackEvent","advisorChat-select-conversation",{recipient_id:userId,user_id:Store_rootStore.authStore.user?Store_rootStore.authStore.user.uid:null}),!cbTokens){_context9.next=5;break}tokens=cbTokens,_context9.next=8;break;case 5:return _context9.next=7,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 7:tokens=_context9.sent;case 8:return Store_rootStore.advisorChatStore.setChatLoading(!0),_context9.abrupt("return",makeGetRequest("".concat("https://aider-ai-staging.appspot.com","/api/v2/conversations/chats/advisorChat/messages?clientId=").concat(userId),{Authorization:"Bearer ".concat(tokens.access_token)}).then(function(){var _ref4=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee8(data){return regenerator_default.a.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return Store_rootStore.advisorChatStore.setIsReloading(!1),_context8.abrupt("return",Store_rootStore.advisorChatStore.storeConversation(data));case 2:case"end":return _context8.stop()}}),_callee8)})));return function(_x9){return _ref4.apply(this,arguments)}}(),(function(error){Store_rootStore.registerGAEvent("otherError"),Store_rootStore.advisorChatStore.setChatLoading(!1),console.log("err:",error)})).catch((function(e){esm.a(e),console.log("other error",e),Store_rootStore.advisorChatStore.setChatLoading(!1)})));case 10:case"end":return _context9.stop()}}),_callee9)}))),function getConversationMessagesWithUserIdLoading(_x7,_x8){return _getConversationMessagesWithUserIdLoading.apply(this,arguments)})},{key:"createChat",value:(_createChat=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee10(messageText,id){var tokens;return regenerator_default.a.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 2:tokens=_context10.sent,axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com","/api/v2/conversations/chats/").concat(id,"/messages"),data:{_embedded:{messageText:"".concat(messageText)}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(data){console.log("message:",data),AdvisorChatService.getConversationMessages(id)}),(function(error){Store_rootStore.registerGAEvent("otherError"),Store_rootStore.advisorChatStore.setChatLoading(!1),console.log("err:",error)})).catch((function(e){esm.a(e),console.log("other error",e),Store_rootStore.advisorChatStore.setChatLoading(!1)}));case 4:case"end":return _context10.stop()}}),_callee10)}))),function createChat(_x10,_x11){return _createChat.apply(this,arguments)})},{key:"createChatWithUserId",value:(_createChatWithUserId=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee11(messageText,id){var tokens;return regenerator_default.a.wrap((function _callee11$(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return Store_rootStore.authStore.Intercom("trackEvent","advisorChat-send-message",{recipient_id:id,user_id:Store_rootStore.authStore.user.uid}),_context11.next=3,Store_rootStore.businessStore.refreshTokensIfExpired(Store_rootStore.businessStore.selectedBusinessId);case 3:return tokens=_context11.sent,_context11.abrupt("return",axios_default()({method:"post",url:"".concat("https://aider-ai-staging.appspot.com","/api/v2/conversations/chats/advisorChat/messages?clientId=").concat(id),data:{_embedded:{messageText:"".concat(messageText)}},headers:{Authorization:"Bearer ".concat(tokens.access_token),"X-API-Key":"h5VQmNnHHKRMpmYYUxf0Xy3rofomPZxC3d8y5AcK7j8b21Oc4z"}}).then((function(data){return console.log("message:",data),AdvisorChatService.getConversationMessagesWithUserId(id,tokens)}),(function(error){Store_rootStore.registerGAEvent("otherError"),Store_rootStore.advisorChatStore.setChatLoading(!1),console.log("err:",error)})).catch((function(e){esm.a(e),console.log("other error",e),Store_rootStore.advisorChatStore.setChatLoading(!1)})));case 5:case"end":return _context11.stop()}}),_callee11)}))),function createChatWithUserId(_x12,_x13){return _createChatWithUserId.apply(this,arguments)})}]),AdvisorChatService}(),advisorChatStore_ConversationStore=(advisorChatStore_dec=mobx_module.action.bound,advisorChatStore_dec2=mobx_module.action.bound,advisorChatStore_dec3=mobx_module.action.bound,advisorChatStore_dec4=mobx_module.action.bound,advisorChatStore_dec5=mobx_module.action.bound,advisorChatStore_dec6=mobx_module.action.bound,advisorChatStore_dec7=mobx_module.action.bound,advisorChatStore_dec8=mobx_module.action.bound,advisorChatStore_dec9=mobx_module.action.bound,advisorChatStore_dec10=mobx_module.action.bound,advisorChatStore_dec11=mobx_module.action.bound,advisorChatStore_dec12=mobx_module.action.bound,advisorChatStore_dec13=mobx_module.action.bound,advisorChatStore_dec14=mobx_module.action.bound,advisorChatStore_dec15=mobx_module.action.bound,advisorChatStore_dec16=mobx_module.action.bound,advisorChatStore_dec17=mobx_module.action.bound,advisorChatStore_class=function(){function ConversationStore(rootStore){Object(classCallCheck.a)(this,ConversationStore),this.rootStore=void 0,this.getChats=void 0,this.getConversationMessages=void 0,this.createChat=void 0,this.getConversationMessagesWithUserId=void 0,this.getConversationMessagesWithUserIdLoading=void 0,this.createChatWithUserId=void 0,this.loadPreviousMessages=void 0,Object(initializerDefineProperty.a)(this,"conversations",advisorChatStore_descriptor,this),Object(initializerDefineProperty.a)(this,"chatLoading",advisorChatStore_descriptor2,this),Object(initializerDefineProperty.a)(this,"lastTimestampRecievedForAllUsers",advisorChatStore_descriptor3,this),Object(initializerDefineProperty.a)(this,"selectedConversationName",advisorChatStore_descriptor4,this),Object(initializerDefineProperty.a)(this,"newMessageRecievedForSelectedBusiness",advisorChatStore_descriptor5,this),Object(initializerDefineProperty.a)(this,"selectedChatId",advisorChatStore_descriptor6,this),Object(initializerDefineProperty.a)(this,"selectedConversationId",advisorChatStore_descriptor7,this),Object(initializerDefineProperty.a)(this,"selectedChat",advisorChatStore_descriptor8,this),Object(initializerDefineProperty.a)(this,"hasNewMessages",advisorChatStore_descriptor9,this),Object(initializerDefineProperty.a)(this,"selectedConversation",advisorChatStore_descriptor10,this),Object(initializerDefineProperty.a)(this,"selectedUserId",advisorChatStore_descriptor11,this),Object(initializerDefineProperty.a)(this,"previousMessagesLink",advisorChatStore_descriptor12,this),Object(initializerDefineProperty.a)(this,"lastTimeRecieved",advisorChatStore_descriptor13,this),Object(initializerDefineProperty.a)(this,"pollIsPaused",advisorChatStore_descriptor14,this),Object(initializerDefineProperty.a)(this,"selectedConversationsMessages",advisorChatStore_descriptor15,this),Object(initializerDefineProperty.a)(this,"isReloadingMessages",advisorChatStore_descriptor16,this),Object(initializerDefineProperty.a)(this,"singleChat",advisorChatStore_descriptor17,this),Object(initializerDefineProperty.a)(this,"chatArrayObserver",advisorChatStore_descriptor18,this),Object(initializerDefineProperty.a)(this,"businessSelected",advisorChatStore_descriptor19,this),Object(initializerDefineProperty.a)(this,"scrollUp",advisorChatStore_descriptor20,this),Object(initializerDefineProperty.a)(this,"notificationsToggled",advisorChatStore_descriptor21,this),this.rootStore=rootStore,this.getChats=advisorChatService_AdvisorChatService.getChats,this.getConversationMessages=advisorChatService_AdvisorChatService.getConversationMessages,this.createChat=advisorChatService_AdvisorChatService.createChat,this.createChatWithUserId=advisorChatService_AdvisorChatService.createChatWithUserId,this.getConversationMessagesWithUserId=advisorChatService_AdvisorChatService.getConversationMessagesWithUserId,this.getConversationMessagesWithUserIdLoading=advisorChatService_AdvisorChatService.getConversationMessagesWithUserIdLoading,this.loadPreviousMessages=advisorChatService_AdvisorChatService.getConversationPreviousMessages}var _storePreviousMessages,_storeConversation,_setIsReloading,_storeChatsList;return Object(createClass.a)(ConversationStore,[{key:"storeChatsList",value:(_storeChatsList=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee(data,businessId){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:data&&(this.conversations=data._embedded.conversations);case 1:case"end":return _context.stop()}}),_callee,this)}))),function storeChatsList(_x,_x2){return _storeChatsList.apply(this,arguments)})},{key:"scrollUpHappened",value:function scrollUpHappened(_scrollUpHappened){this.scrollUp=_scrollUpHappened}},{key:"pausePoll",value:function pausePoll(isPaused){this.pollIsPaused=isPaused}},{key:"setHasNewMessages",value:function setHasNewMessages(hasNewMessages){this.hasNewMessages=hasNewMessages}},{key:"setNotificationsIsToggled",value:function setNotificationsIsToggled(isToggled){this.notificationsToggled=isToggled}},{key:"setBusinessSelected",value:function setBusinessSelected(isSelected){this.businessSelected=isSelected}},{key:"setNewMessageRecievedForSelectedBusiness",value:function setNewMessageRecievedForSelectedBusiness(newMessageRecieved){this.newMessageRecievedForSelectedBusiness=newMessageRecieved}},{key:"setLastTimeRecievedForAllUsers",value:function setLastTimeRecievedForAllUsers(timestamp){this.lastTimestampRecievedForAllUsers=timestamp}},{key:"setIsReloading",value:(_setIsReloading=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee2(isReloading){return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:this.isReloadingMessages=isReloading;case 1:case"end":return _context2.stop()}}),_callee2,this)}))),function setIsReloading(_x3){return _setIsReloading.apply(this,arguments)})},{key:"storeConversation",value:(_storeConversation=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee3(data){return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!this.isReloadingMessages){_context3.next=3;break}return Store_rootStore.advisorChatStore.setChatLoading(!1),_context3.abrupt("return",data);case 3:if(!data){_context3.next=10;break}return this.selectedConversationsMessages=data._embedded.conversation.messages,this.selectedConversationId=data._embedded.conversation.id,this.selectedChat=data._embedded.conversation,this.previousMessagesLink=data._links.previousMessages?data._links.previousMessages.href:null,Store_rootStore.advisorChatStore.setChatLoading(!1),_context3.abrupt("return",data);case 10:this.selectedConversationsMessages=[],this.selectedConversationId=null,this.selectedChat=null,Store_rootStore.advisorChatStore.setChatLoading(!1);case 14:case"end":return _context3.stop()}}),_callee3,this)}))),function storeConversation(_x4){return _storeConversation.apply(this,arguments)})},{key:"storePreviousMessages",value:(_storePreviousMessages=Object(asyncToGenerator.a)(regenerator_default.a.mark((function _callee4(data){var _data$_embedded$conve,messages,postData;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:this.isReloadingMessages=!0,_data$_embedded$conve=data._embedded.conversation,messages=_data$_embedded$conve.messages,_data$_embedded$conve.id,postData=messages,this.previousMessagesLink=data._links.previousMessages?data._links.previousMessages.href:null,this.selectedConversationsMessages=postData.concat(this.selectedConversationsMessages),this.setChatLoading(!1);case 6:case"end":return _context4.stop()}}),_callee4,this)}))),function storePreviousMessages(_x5){return _storePreviousMessages.apply(this,arguments)})},{key:"setChatLoading",value:function setChatLoading(isLoading){this.chatLoading=isLoading}},{key:"setLastTimeReceived",value:function setLastTimeReceived(nanosecondTimestamp){this.lastTimeRecieved=nanosecondTimestamp}},{key:"setSelectedChatId",value:function setSelectedChatId(chatId){this.selectedChatId=chatId}},{key:"setSelectedConversationToRefresh",value:function setSelectedConversationToRefresh(id){this.selectedConversation=id}},{key:"setSelectedUserIdToRefresh",value:function setSelectedUserIdToRefresh(id){var singleChathasUpdated=new firestorter_module.b("clientSync/".concat(id));this.singleChat=singleChathasUpdated,this.selectedUserId=id}},{key:"setSelectedConversationNameToRefresh",value:function setSelectedConversationNameToRefresh(name){this.selectedConversationName=name}}]),ConversationStore}(),advisorChatStore_descriptor=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"conversations",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),advisorChatStore_descriptor2=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"chatLoading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),advisorChatStore_descriptor3=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"lastTimestampRecievedForAllUsers",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),advisorChatStore_descriptor4=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"selectedConversationName",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),advisorChatStore_descriptor5=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"newMessageRecievedForSelectedBusiness",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),advisorChatStore_descriptor6=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"selectedChatId",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),advisorChatStore_descriptor7=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"selectedConversationId",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),advisorChatStore_descriptor8=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"selectedChat",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),advisorChatStore_descriptor9=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"hasNewMessages",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),advisorChatStore_descriptor10=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"selectedConversation",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),advisorChatStore_descriptor11=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"selectedUserId",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),advisorChatStore_descriptor12=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"previousMessagesLink",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),advisorChatStore_descriptor13=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"lastTimeRecieved",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return null}}),advisorChatStore_descriptor14=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"pollIsPaused",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),advisorChatStore_descriptor15=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"selectedConversationsMessages",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),advisorChatStore_descriptor16=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"isReloadingMessages",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),advisorChatStore_descriptor17=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"singleChat",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return{}}}),advisorChatStore_descriptor18=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"chatArrayObserver",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return[]}}),advisorChatStore_descriptor19=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"businessSelected",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),advisorChatStore_descriptor20=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"scrollUp",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),advisorChatStore_descriptor21=Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"notificationsToggled",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!0}}),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"storeChatsList",[advisorChatStore_dec],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"storeChatsList"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"scrollUpHappened",[advisorChatStore_dec2],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"scrollUpHappened"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"pausePoll",[advisorChatStore_dec3],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"pausePoll"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setHasNewMessages",[advisorChatStore_dec4],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setHasNewMessages"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setNotificationsIsToggled",[advisorChatStore_dec5],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setNotificationsIsToggled"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setBusinessSelected",[advisorChatStore_dec6],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setBusinessSelected"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setNewMessageRecievedForSelectedBusiness",[advisorChatStore_dec7],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setNewMessageRecievedForSelectedBusiness"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setLastTimeRecievedForAllUsers",[advisorChatStore_dec8],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setLastTimeRecievedForAllUsers"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setIsReloading",[advisorChatStore_dec9],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setIsReloading"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"storeConversation",[advisorChatStore_dec10],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"storeConversation"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"storePreviousMessages",[advisorChatStore_dec11],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"storePreviousMessages"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setChatLoading",[advisorChatStore_dec12],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setChatLoading"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setLastTimeReceived",[advisorChatStore_dec13],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setLastTimeReceived"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setSelectedChatId",[advisorChatStore_dec14],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setSelectedChatId"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setSelectedConversationToRefresh",[advisorChatStore_dec15],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setSelectedConversationToRefresh"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setSelectedUserIdToRefresh",[advisorChatStore_dec16],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setSelectedUserIdToRefresh"),advisorChatStore_class.prototype),Object(applyDecoratedDescriptor.a)(advisorChatStore_class.prototype,"setSelectedConversationNameToRefresh",[advisorChatStore_dec17],Object.getOwnPropertyDescriptor(advisorChatStore_class.prototype,"setSelectedConversationNameToRefresh"),advisorChatStore_class.prototype),advisorChatStore_class);Object(mobx_module.configure)({enforceActions:"observed"});var hydrate=Object(mobx_persist_lib.create)({storage:localStorage,jsonify:!0}),Store_rootStore=new(Store_dec=mobx_module.action.bound,Store_class=function(){function RootStore(){var _this=this;Object(classCallCheck.a)(this,RootStore),this.businessStore=void 0,this.conversationStore=void 0,this.authStore=void 0,this.advisorChatStore=void 0,Object(initializerDefineProperty.a)(this,"loading",Store_descriptor,this),this.businessStore=new businessStore_BusinessStore(this),this.conversationStore=new conversationStore_ConversationStore(this),this.authStore=new authStore_AuthStore(this),this.advisorChatStore=new advisorChatStore_ConversationStore(this),hydrate("auth",this.authStore).then((function(){return _this.authStore.setLoading(!1)}))}return Object(createClass.a)(RootStore,[{key:"setLoading",value:function setLoading(loading){this.loading=loading}},{key:"registerGAEvent",value:function registerGAEvent(eventType){var code=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return GoogleAnalytics_eventPipeline(eventType,code)}}]),RootStore}(),Store_descriptor=Object(applyDecoratedDescriptor.a)(Store_class.prototype,"loading",[mobx_module.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function initializer(){return!1}}),Object(applyDecoratedDescriptor.a)(Store_class.prototype,"setLoading",[Store_dec],Object.getOwnPropertyDescriptor(Store_class.prototype,"setLoading"),Store_class.prototype),Store_class),Header_Header=function(_React$Component){Object(inherits.a)(Header,_React$Component);var _super=Object(createSuper.a)(Header);function Header(props,state){var _this;return Object(classCallCheck.a)(this,Header),(_this=_super.call(this,props)).state={displayDropdown:!1},_this}return Object(createClass.a)(Header,[{key:"displayDropdown",value:function displayDropdown(dropdown){this.setState({displayDropdown:dropdown})}},{key:"openLink",value:function openLink(url){this.props.authStore.triggerDropdownOpen(!1),window.open(url,"_blank")}},{key:"renderDisplayName",value:function renderDisplayName(practice,firebaseUser,aiderUser){return practice&&practice.name&&aiderUser&&aiderUser.user?react.createElement("span",{className:"faded"},aiderUser.user.displayName):practice&&practice.name&&this.props.user?react.createElement("span",{className:"faded"},this.props.user.displayName&&this.props.user.displayName.replace(/(.{25})..+/,"$1...")||this.props.user.email):react.createElement("span",null," ")}},{key:"render",value:function render(){var _this2=this;return react.createElement(lib.Row,{className:"no-padding header"},react.createElement("div",{onClick:function onClick(){_this2.props.authStore.triggerDropdownOpen(!1)},className:"headerComponent",style:{width:"100%",height:75,backgroundColor:"#4264ea",color:"#13dfe0"}},react.createElement("div",{style:{marginLeft:45,paddingTop:20,color:"white",width:125,float:"left"}},react.createElement("img",{src:logo_default.a,alt:"logo",width:107.5,height:30})," ")," ",react.createElement("span",{style:{position:"absolute",top:17,left:170,fontSize:32,color:"#13dfe0",whiteSpace:"nowrap"}},"Advisory Intelligence",react.createElement("sup",null,"")),react.createElement("div",{style:{float:"right"}},react.createElement("div",{style:{float:"right"}},react.createElement("div",{style:{float:"left",color:"white",paddingTop:15,minWidth:200}},react.createElement("div",null,react.createElement("b",{style:{fontSize:18,float:"right",height:20}},this.props.user&&this.renderDisplayName(this.props.practiceId,this.props.user,this.props.practiceUser)),react.createElement("br",null)," ",react.createElement("div",{style:{float:"right"}},this.props.practiceId&&this.props.practiceId.name&&this.props.user?react.createElement("span",{className:"faded"},this.props.practiceId.name.replace(/(.{25})..+/,"$1...")):react.createElement("span",null," "))),react.createElement("div",null,this.props.authStore.dropdownOpen?react.createElement("div",{style:{paddingTop:20,paddingLeft:80,zIndex:1e3,position:"fixed",fontSize:14}},react.createElement("div",null,react.createElement("div",{style:{height:170,width:160,border:"2px solid #4264ea",borderRadius:4}},react.createElement("div",{style:{borderRadius:4,top:95,height:"auto",width:"100%",backgroundColor:"#ececec",border:"0.5px solid #f5f4fa"}},react.createElement("div",{className:"dropdownOption",onClick:function onClick(){_this2.props.authStore.triggerDropdownOpen(!1),Store_rootStore.authStore.renderAdvisorsModal(!0)}},"Manage Practice")),react.createElement("div",{style:{borderRadius:4,top:130,height:"auto",width:"100%",backgroundColor:"#ececec",border:"0.5px solid #f5f4fa"}},react.createElement("div",{className:"dropdownOption",onClick:function onClick(){_this2.props.authStore.triggerDropdownOpen(!1),_this2.props.authStore.renderEditUserModal(!0)}}," ","Account Settings")),react.createElement("div",{style:{borderRadius:4,top:130,height:"auto",width:"100%",backgroundColor:"#ececec",border:"0.5px solid #f5f4fa"}},react.createElement("div",{className:"dropdownOption",onClick:function onClick(){_this2.openLink("https://ask.aider.ai/knowledge")}}," ","Knowledge Base")),react.createElement("div",{style:{borderRadius:4,top:165,height:"auto",width:"100%",backgroundColor:"#ececec",border:"0.5px solid #f5f4fa"}},react.createElement("div",{className:"dropdownOption",onClick:function onClick(){_this2.openLink("http://go.aider.ai/aip-beta-feedback")}}," ","Provide Feedback")),react.createElement("div",{style:{borderRadius:4,top:95,height:"auto",width:"100%",backgroundColor:"#ececec",border:"0.5px solid #f5f4fa"}},react.createElement("div",{className:"dropdownOption",onClick:function onClick(){_this2.props.authStore.triggerDropdownOpen(!1),_this2.props.handleSignOut()}},"Sign Out ",react.createElement("i",{style:{float:"right",fontSize:22,color:"#4264ea"},className:"material-icons"},"exit_to_app")))))):null)),this.props.user?react.createElement("div",{style:{float:"right",width:50,marginRight:5}}," ",react.createElement("div",{onClick:function onClick(e){e.preventDefault(),e.stopPropagation(),_this2.props.authStore.triggerDropdownOpen(!_this2.props.authStore.dropdownOpen)},style:{float:"right",color:"#13dfe0",cursor:"pointer",paddingTop:35}},react.createElement("i",{className:"material-icons white-text-hover"}))):react.createElement("div",{style:{float:"right",width:50,marginRight:5}})))))}}]),Header}(react.Component),storybook_Header=Object(mobxreact_esm.a)(Header_Header);try{Header_Header.displayName="Header",Header_Header.__docgenInfo={description:"",displayName:"Header",props:{handleSignOut:{defaultValue:null,description:"",name:"handleSignOut",required:!1,type:{name:"any"}},store:{defaultValue:null,description:"",name:"store",required:!1,type:{name:"any"}},businessStore:{defaultValue:null,description:"",name:"businessStore",required:!1,type:{name:"any"}},authStore:{defaultValue:null,description:"",name:"authStore",required:!1,type:{name:"any"}},user:{defaultValue:null,description:"",name:"user",required:!1,type:{name:"any"}},practiceId:{defaultValue:null,description:"",name:"practiceId",required:!0,type:{name:"any"}},practiceUser:{defaultValue:null,description:"",name:"practiceUser",required:!0,type:{name:"any"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/storybook/Header.tsx#Header"]={docgenInfo:Header_Header.__docgenInfo,name:"Header",path:"src/components/storybook/Header.tsx#Header"})}catch(__react_docgen_typescript_loader_error){}var components_Header_Header=function(_React$Component){Object(inherits.a)(Header,_React$Component);var _super=Object(createSuper.a)(Header);function Header(props,state){var _this;return Object(classCallCheck.a)(this,Header),(_this=_super.call(this,props)).state={displayDropdown:!1},_this}return Object(createClass.a)(Header,[{key:"displayDropdown",value:function displayDropdown(dropdown){this.setState({displayDropdown:dropdown})}},{key:"openLink",value:function openLink(url){this.props.authStore.triggerDropdownOpen(!1),window.open(url,"_blank")}},{key:"renderDisplayName",value:function renderDisplayName(practice,firebaseUser,aiderUser){return practice&&practice.name&&aiderUser&&aiderUser.user?react.createElement("span",{className:"faded"},aiderUser.user.displayName):practice&&practice.name&&this.props.user?react.createElement("span",{className:"faded"},this.props.user.displayName&&this.props.user.displayName.replace(/(.{25})..+/,"$1...")||this.props.user.email):react.createElement("span",null," ")}},{key:"render",value:function render(){var _this2=this;return console.log("user",this.props.user,Object(mobx_module.toJS)(this.props.authStore.practiceUser),Object(mobx_module.toJS)(this.props.businessStore.practiceId)),react.createElement(lib.Row,{className:"no-padding header"},react.createElement("div",{onClick:function onClick(){_this2.props.authStore.triggerDropdownOpen(!1)},className:"headerComponent",style:{width:"100%",height:75,backgroundColor:"#4264ea",color:"#13dfe0"}},react.createElement("div",{style:{marginLeft:45,paddingTop:20,color:"white",width:125,float:"left"}},react.createElement("img",{src:logo_default.a,alt:"logo",width:107.5,height:30})," ")," ",react.createElement("span",{style:{position:"absolute",top:17,left:170,fontSize:32,color:"#13dfe0",whiteSpace:"nowrap"}},"Advisory Intelligence",react.createElement("sup",null,"")),react.createElement("div",{style:{float:"right"}},react.createElement("div",{style:{float:"right"}},react.createElement("div",{style:{float:"left",color:"white",paddingTop:15,minWidth:200}},react.createElement("div",null,react.createElement("b",{style:{fontSize:18,float:"right",height:20}},this.props.user&&this.renderDisplayName(this.props.businessStore.practiceId,this.props.user,this.props.authStore.practiceUser)),react.createElement("br",null)," ",react.createElement("div",{style:{float:"right"}},this.props.businessStore.practiceId&&this.props.businessStore.practiceId.name&&this.props.user?react.createElement("span",{className:"faded"},this.props.businessStore.practiceId.name.replace(/(.{25})..+/,"$1...")):react.createElement("span",null," "))),react.createElement("div",null,this.props.authStore.dropdownOpen?react.createElement("div",{style:{paddingTop:20,paddingLeft:80,zIndex:1e3,position:"fixed",fontSize:14}},react.createElement("div",null,react.createElement("div",{style:{height:170,width:160,border:"2px solid #4264ea",borderRadius:4}},react.createElement("div",{style:{borderRadius:4,top:95,height:"auto",width:"100%",backgroundColor:"#ececec",border:"0.5px solid #f5f4fa"}},react.createElement("div",{className:"dropdownOption",onClick:function onClick(){_this2.props.authStore.triggerDropdownOpen(!1),Store_rootStore.authStore.renderAdvisorsModal(!0)}},"Manage Practice")),react.createElement("div",{style:{borderRadius:4,top:130,height:"auto",width:"100%",backgroundColor:"#ececec",border:"0.5px solid #f5f4fa"}},react.createElement("div",{className:"dropdownOption",onClick:function onClick(){_this2.props.authStore.triggerDropdownOpen(!1),_this2.props.authStore.renderEditUserModal(!0)}}," ","Account Settings")),react.createElement("div",{style:{borderRadius:4,top:130,height:"auto",width:"100%",backgroundColor:"#ececec",border:"0.5px solid #f5f4fa"}},react.createElement("div",{className:"dropdownOption",onClick:function onClick(){_this2.openLink("https://ask.aider.ai/knowledge")}}," ","Knowledge Base")),react.createElement("div",{style:{borderRadius:4,top:165,height:"auto",width:"100%",backgroundColor:"#ececec",border:"0.5px solid #f5f4fa"}},react.createElement("div",{className:"dropdownOption",onClick:function onClick(){_this2.openLink("http://go.aider.ai/aip-beta-feedback")}}," ","Provide Feedback")),react.createElement("div",{style:{borderRadius:4,top:95,height:"auto",width:"100%",backgroundColor:"#ececec",border:"0.5px solid #f5f4fa"}},react.createElement("div",{className:"dropdownOption",onClick:function onClick(){_this2.props.authStore.triggerDropdownOpen(!1),_this2.props.handleSignOut()}},"Sign Out ",react.createElement("i",{style:{float:"right",fontSize:22,color:"#4264ea"},className:"material-icons"},"exit_to_app")))))):null)),this.props.user?react.createElement("div",{style:{float:"right",width:50,marginRight:5}}," ",react.createElement("div",{onClick:function onClick(e){e.preventDefault(),e.stopPropagation(),_this2.props.authStore.triggerDropdownOpen(!_this2.props.authStore.dropdownOpen)},style:{float:"right",color:"#13dfe0",cursor:"pointer",paddingTop:35}},react.createElement("i",{className:"material-icons white-text-hover"},"keyboard_arrow_down"))):react.createElement("div",{style:{float:"right",width:50,marginRight:5}})))))}}]),Header}(react.Component);Object(mobxreact_esm.a)(components_Header_Header);try{components_Header_Header.displayName="Header",components_Header_Header.__docgenInfo={description:"",displayName:"Header",props:{handleSignOut:{defaultValue:null,description:"",name:"handleSignOut",required:!1,type:{name:"any"}},store:{defaultValue:null,description:"",name:"store",required:!1,type:{name:"any"}},businessStore:{defaultValue:null,description:"",name:"businessStore",required:!1,type:{name:"any"}},authStore:{defaultValue:null,description:"",name:"authStore",required:!1,type:{name:"any"}},user:{defaultValue:null,description:"",name:"user",required:!1,type:{name:"any"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Header.tsx#Header"]={docgenInfo:components_Header_Header.__docgenInfo,name:"Header",path:"src/components/Header.tsx#Header"})}catch(__react_docgen_typescript_loader_error){}__webpack_require__(317),__webpack_require__(280);var storybook_addon_designs_esm=__webpack_require__(281),Header_stories_user={uid:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",displayName:"TESTER",photoURL:null,email:"testpermissions@aider.ai",emailVerified:!1,phoneNumber:null,isAnonymous:!1,tenantId:null,providerData:[{uid:"testpermissions@aider.ai",displayName:"test testse",photoURL:null,email:"testpermissions@aider.ai",phoneNumber:null,providerId:"password"}],apiKey:"AIzaSyAtdbeBBMDQza5uD4ccd0V_EINypq0dvCk",appName:"[DEFAULT]",authDomain:"aider-ai-staging.firebaseapp.com",stsTokenManager:{apiKey:"AIzaSyAtdbeBBMDQza5uD4ccd0V_EINypq0dvCk",refreshToken:"AG8BCnf_3J0UvzTbReGTplcgnGkur86VQNb3pQ-k-yHeJr3Cg1pfS0t3RRTl-X6hkyej3a8-dCb1c4RV-xITy_gKZ9P1QgbrXDZy0Dj6j8hvqn4KlMt_GFA1RXLxG1NoZ_Ohg6b9VXMAXRjjkOwkbO4t-6m5O_wLIR-qyUq2OuyS9-H8H_7fU1ibefW77xokp3xS9aiaZX1T1qYrvD2Lw0h18yM6Vwm-Ujh2Fwd8GQ4UeUuq7Pyzoxo",accessToken:"eyJhbGciOiJSUzI1NiIsImtpZCI6IjVmOTcxMmEwODczMTcyMGQ2NmZkNGEyYTU5MmU0ZGZjMmI1ZGU1OTUiLCJ0eXAiOiJKV1QifQ.eyJuYW1lIjoidGVzdCB0ZXN0c2UiLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vYWlkZXItYWktc3RhZ2luZyIsImF1ZCI6ImFpZGVyLWFpLXN0YWdpbmciLCJhdXRoX3RpbWUiOjE2MTA0MDc1MDYsInVzZXJfaWQiOiIzcFVIc2ppeDBZaDZKdmtrVnA2VUJHZThxQTAyIiwic3ViIjoiM3BVSHNqaXgwWWg2SnZra1ZwNlVCR2U4cUEwMiIsImlhdCI6MTYxMDQwNzUwNiwiZXhwIjoxNjEwNDExMTA2LCJlbWFpbCI6InRlc3RwZXJtaXNzaW9uc0BhaWRlci5haSIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwiZmlyZWJhc2UiOnsiaWRlbnRpdGllcyI6eyJlbWFpbCI6WyJ0ZXN0cGVybWlzc2lvbnNAYWlkZXIuYWkiXX0sInNpZ25faW5fcHJvdmlkZXIiOiJwYXNzd29yZCJ9fQ.tpQZR96gn1U8JJPJG6vzrXe6idnJ8PiLuJ9IZl3MVTOXaG7gwfjmxYnALTRQXBYfLkgulsku-iJA56XqzGJSq9h7HyZj6j4F6jo9SjyWyMi2gf11bQqGtRmXa4oTrObUGQ_rNTo1n3vleMUU02wzvCcOYuYD51JivxZ-9l3Z-OcchkEc7AMa_nqHdcTx6244IuCh-PMdtJTuZSEtF9_v853XSxdFJ750pDe3C3LFviW7nJJ7XYGQ29H55UU8a59kVUDfpvGaxxUP6Oiw_-5Tu_NoSKWgZJY60iJ7WwL1bgVqX8dNwALKg0CuT5Te_nFNsTal_0lKsdZRTHt6Q0LIXg",expirationTime:1610411106e3},redirectEventId:null,lastLoginAt:"1610407506909",createdAt:"1605572547410",multiFactor:{enrolledFactors:[]}},temp3={id:"Q5c90vrldsXHdGrlp3rm",name:"test",area:"Auckland",countryCode:"NZ",timeZoneId:"Pacific/Auckland",website:null,createdAt:1605572562,businessClass:"management"},temp4={user:{givenName:"test",familyName:"test",displayName:"test testse",photoUrl:null,email:"testpermissions@aider.ai",emailVerified:!1,phoneNumber:null,gender:null,partnerData:null},businesses:[{businessClass:"smb",address:null,phoneNumber:null,rawOffsetInMinutesFromGoogle:0,website:null,dstOffsetInMinutesFromGoogle:0,profile:{fringeBenefitTax:"",payrollTax:"",reconciledDays:null,address:"23 Main StreetX, Central CityX, Marineville, 1234, 456",incomeTax:"",operationalExpensesSource:"",taxRate:"29",dividendWithholdingTax:"",taxAgent:"",purchasesSource:"",salesSource:""},timeZoneId:"Pacific/Auckland",managedBy:"Q5c90vrldsXHdGrlp3rm",hubspotId:"4946627117",name:"Demo Company (NZ)",location:null,postalCode:null,photoUrl:null,iconUrl:null,area:"Auckland",types:null,createdBy:"CjXnjKciD8TVboz3rwGss6FxeLD3",createdAt:"2020-12-03T04:19:27.488Z",countryCode:"NZ",updatedAt:"2020-12-09T00:30:37.446Z",status:"active",utcOffsetInMinutesFromGoogle:0,updatedBy:"CjXnjKciD8TVboz3rwGss6FxeLD3",id:"HscUV9yhTH6qGHAbwa3v",connectedApps:[{ospKey:"xero",appKey:"accounting"}],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{businessClass:"smb",createdAt:"2020-11-17T01:38:28.780Z",phoneNumber:null,status:"active",address:null,dstOffsetInMinutesFromGoogle:0,name:"Demo Company (NZ)",managedBy:"Q5c90vrldsXHdGrlp3rm",timeZoneId:"Pacific/Auckland",countryCode:"NZ",location:null,area:"Auckland",photoUrl:null,postalCode:null,createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",website:null,profile:{taxRate:28},rawOffsetInMinutesFromGoogle:0,utcOffsetInMinutesFromGoogle:0,types:null,hubspotId:"4838531347",iconUrl:null,id:"6Aihr98CbJWuPtonaTju",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{address:null,businessClass:"smb",postalCode:null,countryCode:"NZ",createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",hubspotId:"4839751106",status:"active",photoUrl:null,dstOffsetInMinutesFromGoogle:0,createdAt:"2020-11-17T01:41:55.972Z",iconUrl:null,rawOffsetInMinutesFromGoogle:0,area:"Auckland",types:null,location:null,managedBy:"Q5c90vrldsXHdGrlp3rm",utcOffsetInMinutesFromGoogle:0,name:"Demo Company (NZ)",website:null,profile:{taxRate:28},timeZoneId:"Pacific/Auckland",phoneNumber:null,id:"qZ8os7DyqFMbm3D01evD",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{hubspotId:"4838736729",status:"active",dstOffsetInMinutesFromGoogle:0,postalCode:null,types:null,profile:{purchasesSource:"",operationalExpensesSource:"",salesSource:"",dividendWithholdingTax:"",payrollTax:"",incomeTax:"",taxRate:28,reconciledDays:null,salesTax:"",fringeBenefitTax:""},address:null,utcOffsetInMinutesFromGoogle:0,phoneNumber:null,managedBy:"Q5c90vrldsXHdGrlp3rm",updatedBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",website:null,businessClass:"smb",timeZoneId:"Pacific/Auckland",area:"Auckland",rawOffsetInMinutesFromGoogle:0,createdAt:"2020-11-17T02:42:35.490Z",countryCode:"NZ",iconUrl:null,name:"Demo Company (NZ)",location:null,photoUrl:null,updatedAt:"2020-11-17T02:42:54.661Z",createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",id:"VosaTLH9fsowFkl94CKJ",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{iconUrl:null,postalCode:null,address:null,phoneNumber:null,countryCode:"NZ",name:"Demo Company (NZ)",dstOffsetInMinutesFromGoogle:0,rawOffsetInMinutesFromGoogle:0,managedBy:"Q5c90vrldsXHdGrlp3rm",businessClass:"smb",createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",hubspotId:"4838392774",photoUrl:null,createdAt:"2020-11-17T01:55:38.082Z",timeZoneId:"Pacific/Auckland",website:null,area:"Auckland",location:null,status:"active",utcOffsetInMinutesFromGoogle:0,types:null,profile:{taxRate:28},id:"SlK5h3l1VJgzEy0I1385",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{hubspotId:"4837456819",profile:{numberOfAccountants:"12",accountingSoftware:["xero"],numberOfClients:"14"},address:"Auckland 0627, New Zealand",status:"active",createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",location:{longitude:174.7510457,latitude:-36.78432279999999},name:"test",photoUrl:null,utcOffsetInMinutesFromGoogle:780,dstOffsetInMinutesFromGoogle:3600,createdAt:"2020-11-17T00:22:42.743Z",area:"Auckland",phoneNumber:null,website:null,timeZoneId:"Pacific/Auckland",types:["transit_station","point_of_interest","establishment"],postalCode:null,businessClass:"management",countryCode:"NZ",iconUrl:null,rawOffsetInMinutesFromGoogle:43200,id:"Q5c90vrldsXHdGrlp3rm",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[{status:"accepted",givenName:"alex",reminders:[{sendAt:{_seconds:1605745431,_nanoseconds:123e6},reminderKey:"twoDayReminder",status:"pending"},{reminderKey:"sevenDayReminder",status:"pending",sendAt:{_seconds:1606177431,_nanoseconds:123e6}}],familyName:"cashmur",roleKey:"practice_user",createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",email:"alex+testpermissions@aider.ai",businessId:"Q5c90vrldsXHdGrlp3rm",createdAt:"2020-11-17T00:23:51.123Z",invitedAt:{_seconds:1605572631,_nanoseconds:123e6},expiresAt:"2020-11-24T00:23:51.000Z",displayName:"alex cashmur",id:"74dWyRSWonJ00ZvPbicw"}],cancelledInvitations:[]}},{utcOffsetInMinutesFromGoogle:0,website:null,photoUrl:null,hubspotId:"4884149689",location:null,phoneNumber:null,managedBy:"Q5c90vrldsXHdGrlp3rm",profile:{taxRate:28},rawOffsetInMinutesFromGoogle:0,address:null,status:"active",iconUrl:null,businessClass:"smb",dstOffsetInMinutesFromGoogle:0,createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",createdAt:"2020-11-23T00:39:42.125Z",countryCode:"NZ",timeZoneId:"Pacific/Auckland",name:"Demo Company (NZ)",area:"Auckland",types:null,postalCode:null,id:"eS2xOOMOv6903Dv02zcr",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{website:null,area:"Auckland",rawOffsetInMinutesFromGoogle:0,iconUrl:null,types:null,timeZoneId:"Pacific/Auckland",hubspotId:"4837456937",photoUrl:null,updatedBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",managedBy:"Q5c90vrldsXHdGrlp3rm",profile:{dividendWithholdingTax:"",salesSource:"",operationalExpensesSource:"",taxRate:"3",purchasesSource:"",fringeBenefitTax:"",salesTax:"",incomeTax:"",payrollTax:"",reconciledDays:null},createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",location:null,countryCode:"NZ",name:"Xero Trial Business",status:"active",postalCode:null,phoneNumber:null,businessClass:"smb",utcOffsetInMinutesFromGoogle:0,address:null,dstOffsetInMinutesFromGoogle:0,updatedAt:"2020-11-17T00:29:08.396Z",createdAt:"2020-11-17T00:28:54.397Z",id:"nb4npUfiDZH2jKS0FtOw",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",postalCode:null,address:null,createdAt:"2020-11-23T00:33:55.410Z",name:"Demo Company (NZ)",status:"active",managedBy:"Q5c90vrldsXHdGrlp3rm",updatedBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",location:null,businessClass:"smb",area:"Auckland",photoUrl:null,utcOffsetInMinutesFromGoogle:0,website:null,iconUrl:null,hubspotId:"4884119093",phoneNumber:null,countryCode:"NZ",updatedAt:"2020-11-23T00:34:09.725Z",rawOffsetInMinutesFromGoogle:0,profile:{taxRate:28,salesSource:"",reconciledDays:null,purchasesSource:"",dividendWithholdingTax:"",fringeBenefitTax:"",salesTax:"",payrollTax:"",incomeTax:"",operationalExpensesSource:""},dstOffsetInMinutesFromGoogle:0,types:null,timeZoneId:"Pacific/Auckland",id:"Z6otv1M9lDmC2lavzoge",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{rawOffsetInMinutesFromGoogle:0,types:null,location:null,utcOffsetInMinutesFromGoogle:0,createdAt:"2020-11-17T02:43:35.632Z",createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",updatedAt:"2020-11-17T02:44:06.862Z",address:null,timeZoneId:"Pacific/Auckland",hubspotId:"4838746026",countryCode:"NZ",dstOffsetInMinutesFromGoogle:0,businessClass:"smb",status:"active",website:null,managedBy:"Q5c90vrldsXHdGrlp3rm",phoneNumber:null,area:"Auckland",updatedBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",photoUrl:null,postalCode:null,profile:{fringeBenefitTax:"fbt",salesTax:"gst",salesSource:"",incomeTax:"shareholders",reconciledDays:1,purchasesSource:"",dividendWithholdingTax:"noDwt",taxRate:"29.9",payrollTax:"noPaye",operationalExpensesSource:""},name:"Xero Trial Business",iconUrl:null,id:"kI2H6uP1ZeCwIbmdSh6k",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{phoneNumber:null,location:null,countryCode:"NZ",dstOffsetInMinutesFromGoogle:0,businessClass:"smb",website:null,managedBy:"Q5c90vrldsXHdGrlp3rm",iconUrl:null,createdAt:"2020-12-03T04:15:07.740Z",rawOffsetInMinutesFromGoogle:0,utcOffsetInMinutesFromGoogle:0,postalCode:null,area:"Auckland",address:null,status:"active",timeZoneId:"Pacific/Auckland",hubspotId:"4946151652",types:null,photoUrl:null,createdBy:"CjXnjKciD8TVboz3rwGss6FxeLD3",name:"Demo Company (NZ)",updatedBy:"CjXnjKciD8TVboz3rwGss6FxeLD3",profile:{fringeBenefitTax:"",taxAgent:"",incomeTax:"",reconciledDays:null,taxRate:"27",purchasesSource:"",payrollTax:"",salesSource:"",address:"23 Main StreetXX, Central CityXXX",operationalExpensesSource:"",dividendWithholdingTax:""},updatedAt:"2020-12-09T00:32:01.903Z",id:"vDfwduxEeeNE0m4NBPL9",connectedApps:[{ospKey:"xero",appKey:"accounting"}],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{createdAt:"2020-11-23T00:44:26.185Z",status:"active",hubspotId:"4884559597",updatedBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",countryCode:"NZ",iconUrl:null,types:null,timeZoneId:"Pacific/Auckland",address:null,area:"Auckland",name:"Demo Company (NZ)",updatedAt:"2020-11-23T00:44:53.118Z",photoUrl:null,phoneNumber:null,managedBy:"Q5c90vrldsXHdGrlp3rm",location:null,dstOffsetInMinutesFromGoogle:0,profile:{dividendWithholdingTax:"",reconciledDays:null,salesSource:"",operationalExpensesSource:"",taxRate:28,salesTax:"",purchasesSource:"",payrollTax:"",fringeBenefitTax:"",incomeTax:""},businessClass:"smb",utcOffsetInMinutesFromGoogle:0,rawOffsetInMinutesFromGoogle:0,postalCode:null,createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",website:null,id:"XKEnVJLUfDUHWxp1Rsnw",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{iconUrl:null,photoUrl:null,utcOffsetInMinutesFromGoogle:0,businessClass:"smb",dstOffsetInMinutesFromGoogle:0,area:"Auckland",rawOffsetInMinutesFromGoogle:0,address:null,createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",updatedBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",updatedAt:"2020-11-17T02:36:25.665Z",status:"active",website:null,managedBy:"Q5c90vrldsXHdGrlp3rm",profile:{payrollTax:"",dividendWithholdingTax:"",taxRate:"29.5",purchasesSource:"",operationalExpensesSource:"",salesTax:"",incomeTax:"",fringeBenefitTax:"",salesSource:"",reconciledDays:null},countryCode:"NZ",phoneNumber:null,types:null,createdAt:"2020-11-17T02:36:02.407Z",timeZoneId:"Pacific/Auckland",name:"Demo Company (NZ)",postalCode:null,location:null,hubspotId:"4838532180",id:"hj5wQAumNPWulwWK6v9q",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{area:"Auckland",photoUrl:null,name:"Demo Company (NZ)",createdAt:"2020-11-17T01:50:20.587Z",phoneNumber:null,status:"active",managedBy:"Q5c90vrldsXHdGrlp3rm",address:null,rawOffsetInMinutesFromGoogle:0,profile:{address:"  Address2",payrollTax:"",fringeBenefitTax:"",purchasesSource:"",reconciledDays:null,salesSource:"",operationalExpensesSource:"",dividendWithholdingTax:"",salesTax:"",incomeTax:"",taxRate:"29"},website:null,dstOffsetInMinutesFromGoogle:0,updatedBy:"CjXnjKciD8TVboz3rwGss6FxeLD3",businessClass:"smb",createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",hubspotId:"4838544338",countryCode:"NZ",updatedAt:"2020-12-03T04:08:48.344Z",types:null,utcOffsetInMinutesFromGoogle:0,postalCode:null,timeZoneId:"Pacific/Auckland",location:null,iconUrl:null,id:"BWUYHIKfT0b7I33MoC3m",connectedApps:[{ospKey:"google",appKey:"google_calendar"},{ospKey:"xero",appKey:"accounting"}],invitations:{pendingInvitations:[],acceptedInvitations:[{expiresAt:"2020-11-25T22:54:45.000Z",displayName:"alex cashmore",email:"alex+ac13@aider.ai",businessId:"BWUYHIKfT0b7I33MoC3m",createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",status:"accepted",reminders:[{sendAt:{_seconds:1605912885,_nanoseconds:611e6},status:"pending",reminderKey:"twoDayReminder"},{status:"pending",reminderKey:"sevenDayReminder",sendAt:{_seconds:1606344885,_nanoseconds:611e6}}],familyName:"cashmore",createdAt:"2020-11-18T22:54:45.611Z",givenName:"alex",invitedAt:{_seconds:1605740085,_nanoseconds:611e6},roleKey:"admin",id:"R4bZ6EWisl7q6fv54spy"},{displayName:"MR Cashmore",createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",invitedAt:{_seconds:1606427324,_nanoseconds:511e6},reminders:[{sendAt:{_seconds:1606600124,_nanoseconds:511e6},status:"pending",reminderKey:"twoDayReminder"},{status:"pending",sendAt:{_seconds:1607032124,_nanoseconds:511e6},reminderKey:"sevenDayReminder"}],email:"alex+mrc@aider.ai",familyName:"Cashmore",status:"accepted",createdAt:"2020-11-26T21:48:44.511Z",expiresAt:"2020-12-03T21:48:44.000Z",givenName:"MR",businessId:"BWUYHIKfT0b7I33MoC3m",roleKey:"admin",id:"YcQPy4j7xxoPp86aWH6J"}],cancelledInvitations:[]}},{rawOffsetInMinutesFromGoogle:0,countryCode:"NZ",phoneNumber:null,managedBy:"Q5c90vrldsXHdGrlp3rm",updatedBy:"CjXnjKciD8TVboz3rwGss6FxeLD3",businessClass:"smb",area:"Auckland",postalCode:null,updatedAt:"2020-11-30T21:45:04.557Z",types:null,website:null,location:null,iconUrl:null,profile:{incomeTax:"",reconciledDays:null,operationalExpensesSource:"",taxRate:28,fringeBenefitTax:"",dividendWithholdingTax:"",salesSource:"",salesTax:"",purchasesSource:"",payrollTax:""},name:"Open Sauce Development",status:"active",photoUrl:null,createdBy:"CjXnjKciD8TVboz3rwGss6FxeLD3",dstOffsetInMinutesFromGoogle:0,hubspotId:"4928800335",timeZoneId:"Pacific/Auckland",utcOffsetInMinutesFromGoogle:0,createdAt:"2020-11-30T21:44:37.219Z",address:null,id:"gdjOMtfBUxJH39wRNHAj",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[{createdAt:"2020-11-30T21:45:32.426Z",expiresAt:"2020-12-07T21:45:32.000Z",roleKey:"admin",email:"alex+testname@aider.ai",status:"accepted",familyName:"cashmur",createdBy:"CjXnjKciD8TVboz3rwGss6FxeLD3",invitedAt:{_seconds:1606772732,_nanoseconds:426e6},reminders:[{sendAt:{_seconds:1606945532,_nanoseconds:426e6},reminderKey:"twoDayReminder",status:"pending"},{status:"pending",reminderKey:"sevenDayReminder",sendAt:{_seconds:1607377532,_nanoseconds:426e6}}],givenName:"alex",businessId:"gdjOMtfBUxJH39wRNHAj",displayName:"alex cashmur",id:"Z2EceCnfOuQR3MANBAYm"}],cancelledInvitations:[]}},{area:"Auckland",types:null,updatedBy:"CjXnjKciD8TVboz3rwGss6FxeLD3",createdAt:"2020-11-23T00:33:17.796Z",postalCode:null,rawOffsetInMinutesFromGoogle:0,createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",status:"active",countryCode:"NZ",utcOffsetInMinutesFromGoogle:0,phoneNumber:null,name:"Demo Company (NZ)",businessClass:"smb",photoUrl:null,hubspotId:"4884549660",updatedAt:"2020-12-03T04:11:34.105Z",timeZoneId:"Pacific/Auckland",website:null,profile:{salesTax:"noGst",taxRate:28,incomeTax:"shareholders",address:"87 Island Bay Rd",dividendWithholdingTax:"",reconciledDays:null,payrollTax:"paye",operationalExpensesSource:"",fringeBenefitTax:"",purchasesSource:"",salesSource:""},managedBy:"Q5c90vrldsXHdGrlp3rm",location:null,dstOffsetInMinutesFromGoogle:0,iconUrl:null,address:null,id:"lDFg3Q2VciwVRZOOKFok",connectedApps:[{ospKey:"xero",appKey:"accounting"}],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}},{profile:{payrollTax:"",salesTax:"",fringeBenefitTax:"",reconciledDays:null,incomeTax:"",salesSource:"",dividendWithholdingTax:"",taxRate:"0",purchasesSource:"",operationalExpensesSource:""},updatedBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",phoneNumber:null,photoUrl:null,postalCode:null,createdBy:"3pUHsjix0Yh6JvkkVp6UBGe8qA02",rawOffsetInMinutesFromGoogle:0,countryCode:"NZ",location:null,timeZoneId:"Pacific/Auckland",businessClass:"smb",hubspotId:"4884612038",status:"active",updatedAt:"2020-11-23T00:53:09.237Z",managedBy:"Q5c90vrldsXHdGrlp3rm",types:null,area:"Auckland",iconUrl:null,website:null,address:null,name:"Demo Company (NZ)",createdAt:"2020-11-23T00:52:45.253Z",dstOffsetInMinutesFromGoogle:0,utcOffsetInMinutesFromGoogle:0,id:"k6xIh0BGECkXWIY9K8Oo",connectedApps:[],invitations:{pendingInvitations:[],acceptedInvitations:[],cancelledInvitations:[]}}],subscriptions:[]},Header_stories_LoggedIn=function LoggedIn(){return react_default.a.createElement(storybook_Header,{handleSignOut:function handleSignOut(){},user:Header_stories_user,practiceId:temp3,practiceUser:temp4,authStore:Store_rootStore.authStore,businessStore:Store_rootStore.businessStore})},Header_stories_LoggedOut=function LoggedOut(){return react_default.a.createElement(storybook_Header,{handleSignOut:function handleSignOut(){},user:null,practiceId:temp3,practiceUser:temp4,authStore:Store_rootStore.authStore,businessStore:Store_rootStore.businessStore})};__webpack_exports__.default={title:"Headers",component:storybook_Header,decorators:[storybook_addon_designs_esm.a]};Header_stories_LoggedIn.parameters={design:{type:"figma",url:"https://www.figma.com/file/Lh4m51A56pHUS6hzIhb0yr/Advisor-Portal-(v3)?node-id=0%3A1021"}},Header_stories_LoggedOut.parameters={design:{type:"figma",url:"https://www.figma.com/file/Lh4m51A56pHUS6hzIhb0yr/Advisor-Portal-(v3)?node-id=0%3A1155"}},Header_stories_LoggedIn.parameters=Object(objectSpread2.a)({storySource:{source:"() => <Header handleSignOut={()=>{}} user={user} practiceId={temp3} practiceUser={temp4} authStore={rootStore.authStore} businessStore={rootStore.businessStore} />"}},Header_stories_LoggedIn.parameters),Header_stories_LoggedOut.parameters=Object(objectSpread2.a)({storySource:{source:"() => <Header handleSignOut={()=>{}} user={null} practiceId={temp3} practiceUser={temp4} authStore={rootStore.authStore} businessStore={rootStore.businessStore} />"}},Header_stories_LoggedOut.parameters),Header_stories_LoggedIn.__docgenInfo={description:"",methods:[],displayName:"LoggedIn"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\components\\storybook\\Header.stories.js"]={name:"LoggedIn",docgenInfo:Header_stories_LoggedIn.__docgenInfo,path:"src\\components\\storybook\\Header.stories.js"}),Header_stories_LoggedOut.__docgenInfo={description:"",methods:[],displayName:"LoggedOut"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\components\\storybook\\Header.stories.js"]={name:"LoggedOut",docgenInfo:Header_stories_LoggedOut.__docgenInfo,path:"src\\components\\storybook\\Header.stories.js"})},280:function(module,__webpack_exports__,__webpack_require__){"use strict";var C_Users_Alex_WebstormProjects_advisory_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(669),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);__webpack_require__(1290),__webpack_require__(1291);function Button(props){var _props$variant=props.variant,variant=void 0===_props$variant?"primary":_props$variant,children=props.children;Object(C_Users_Alex_WebstormProjects_advisory_portal_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__.a)(props,["variant","children"]);return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement("div",{className:"actionButton ".concat(variant)},children)}Button.__docgenInfo={description:"",methods:[],displayName:"Button"},__webpack_exports__.a=Button,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src\\components\\storybook\\button.js"]={name:"Button",docgenInfo:Button.__docgenInfo,path:"src\\components\\storybook\\button.js"})},283:function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"static/media/logo.077284c6.png"},422:function(module,exports){module.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIcAAAB8CAYAAABDsqPQAAASP0lEQVR4Xu1deXSV1bX/fcMdMpIAIQmQyOAQIg8ZhedDBIo+QUqpIlIFfbYVnlpU1PqK+rR16bNWAcdCUdonuEpVHksBsYK0IrgYpEYGFaQKScg8j/fmTuetczExubk39/u+c77hJveslZU/7hn3/n377LPP2XsLiJeIFNi4vYWcq/CjoTkAdxuBq42gxUXgchP4/QRJCSJkGUh0CnA6BGQNkJA5UAz+nz01QYh10sb8Angx4LcbGsmx015U1PhBCK9egcEZEvKGy7hkmA03XpMYU/SOqcnyYxmwelMjKfjKi5JKP89uo/Y1ME3ElDF23H9rquVpb/kJRqW2igqb328h733sRmmVsYCINMWkBAEzJjksC5Q+AY57n6kjx097VcDI+Kojc2T8aEYC5k6zjq7Sq8Fx55O15NRZn/GcZhgxPVXEgqsT8JPZSabzxvQJMNAxYtP/eLSGFJVbY+vQuj4KkiU/TMT8GeYpsb0KHCtfqCeHjnu08sOS7eh28+rj/U3hkymD8ubCxm0tZPP7rWjzcjyD8p4kQ3+CAMy83IFH7uhnKL8MHYyBPhGb3v5YDSksje0tRCldBvQT8faqgYbxzLCBlBJATb05d1cRarnsS4VKkeuudBpy/I1JcDy9oZHsPuDuS5jottZLhslY+6i+ukjMgeNnj9eSMyWxdTzVC8WD+ov4y+/022ZiChyLV9YQq1g39WK42n4THALeeyVDFz7q0qnaBSqpf/2KalLfFFBStc/VkURgxZIUzLmSr3U1JsBx3d1VhF6Xx0tkClBFdc+rg7jyk2tnejBv3j1VpLk1DgwltBVF4MP1/ABiaXAseKCa1DbEtxIlwGivQx8f7VrHByCWBcctK2tImUWu1tUwxwp1HTYB769lV1ItCY5lT9SS00Xx4yoL0DLSRbz5LNsx13LgWLOpiWzf62KhC3PbgAw0Dg6gOSuA1nQCV/8AXGmAz0EQsJ3/T4voo38CbC7A0SQgoe78X0qFiNRzImwuc8k7Ls+GVQ+ma56E5obMHIjQwcyfV5qifbYMDKAy34+6YQE0DgkgIDGukABJNSLSvxUx6KSEfsUiBBNWtujaRCxdkKyJz5oaMZItYvO5y6tIq8s4CvqcBKXj/Cgf7Udzpr6Kr71ZQNZxCUOPyHA2GEd2liOucbOMgigjX225UwMonuJH6Vgf/Ha9oB6+XyEADDwtYdg+GSnloiGD00fNbz2nXv+wBDi27mklL29u1p1QfjvB2ak+FE/2IyAZJ6HCLYxuMZknJIz4yGaIJJk/MwH33Jyiit+qKuvFvR8uryLUWUjPUjHah9OzfPAk6zuO2jVIXmDE320Y+qmsq06iZXsxHRxPvdpA9hxqU0tTxfXpyeLUbB8oOKxc0opE5L9jg7NRv61mxFAZr/1a+TW/6eD4wR2VhKeHWWcANGUFcGKBB640a0mLSCC1twoYvcUOChS9yv23pih2fzAVHHr6k9SMDODEDW2GK5ysTBUCAvJ2ysj+XGbtKmx76sf752cGKOK7okq6zBKAXjaN8jF+fDXXCyLGhsToRl8CXPyBLXjs1aMolR6mgeOhNfXkyBf83Qgq8v34cr4HRD/JrAe/uvdJAbLrvKLKuyiVHqaBQw+pUXOhH8cWxrDECEEBPe6O3uJAxin+SH/wtuiPg0wBxxPrGshHR/ieUFoyAjhye+zpGNGkguQBxm90cDeYjRpuwyuP9HzvYgo4Zt9ZRXg6IFErJwUGBUhvLAn1Ai5f74Dk4cuuv73W87sPvqMp4Mz2j1xkzRtNCmoqr/LVPA/KxvRux6bBBTLy3rMpJ4qCmtRh+66bIltNDQfH8qfryBff8AuHUDs8gM9v4btFhdK1vyhissOB9zPDf2lXlpWTwx4P2vQy2Hw3ocs2OzDgG376R1qKiK1rIt+5GA4OnkYv+u7i8FI3WvvzP7KmiCKacnNU0+faigrygcsN/jMCkqrF4PZCL+94lZ62FtWLZ5nUn3e2kNe2trB00aVt4RU+fDOTnxSindODo2/YBcx0mVpWTva38ZdoQfsHx+NtTxdyzERQw+kHV9WTz77iY9vw24ADy93wJPL7RofLMs4MHcKVJuLZQsLxQwc1sV/xojP4Co1HGZopYeNT4S2mXAkRbbKz76oibR4+zCye7MPpq/lJjckOOw5lZ+tCj6TCItLCUR8Ztd2O7KOsT9W+51akrUUXYkQCCS/DFxGAA79ww92PD9DG2u34fLA+wGinhb2wiHg4ASSpUsDk9c5o36Li3+9bnIx507tHEDIMHP/7bjPZuL1V8YR7qlg3zI+CxXy2pwxJRFWOesVT00LOFvJBM4BJGxxIKeNzcqGBYR5d2j0wjGHg4KlvcLVrcFA+VQGFE0ByD8i4cA8fu8ewwTL++ET3dx6GgeOmX1aTqjp21YxeqO17wN3hHqCKMSGVr3Y6sTsr0zAa0OFTi4pJY4CdDvSR8hUv8dlaZAnY9YfuNhzDCMPLvkHdBqipnEsxWmq0T5qT9PjXV5xBPxkeJZxSyqdnBbPjpYye/Tcfvp3BfkqZZLfjU52V0Ehk6VdUTBo4SI9R2+zIPsbn1NIrwHF0kQf0ap65mCU1OEoPnvctNObp7T/q6vxkiOTYtKOF/OkdPpZReoTl8ia0F4CDetFNeN3B/J3QDuZNT8B9i7tewhkCjt+/2US27Gb3f6V3KXsfcjG/8hogiqjRcG/ChQvfdcLD7kGtpVNX81FKr5rowOP/2fU4awg4Vm9sJDs+Zo/+15JBcGgZez//nuDEB5nGnlJCgZVfUkq+9LLrTtOedUJuY2fj2DwbVoc4XbP3quBzenJ9A/nbYfYTRn1uAJ/dyt4PzN5SOOodE//kQGoJuzFs+BAZG37T1dZhCDgeeameHDjKbtGsGenH0Z+w99ObwJG/zY4sDieWcI+ODQHHimfryNFT7CKUhkg4cX0cHJ2F9YUfysg9yG4ppenG3ni66+2sMeD4XR05+jU7OKjbwRdxcHTZyEfslTFsHzs4crIkvP6kCeDg5aNSfXEAxxbGdY7O6OAFjpjXOWpHBPD5zXFw6AGOC3NkrA/J62LItsLLk57Xvcp4ux2fmWQ677IncLhj4SU58kfa8PLKrn4shoBj7VtN5O1d7EawtlSCT+5ht3Pweieq4BTfcxULgWP6RAceM8MI9pe/tpD1W9jN5/QF2N5fudiDuVGWWcHWYSFw3HhNAu5caIL5nPKC163swbs4uSLEwdFFqt11UzIWXN31qaAh2wpPcBxf4EFVHvutrEMQ0HZBrmHrD7u/WEhy9Iore66+KmZLjzg4zn8zCx+sJtX17M/j6i7wo2AJByspAKcgwG2m9LAIOOw2AX8NEyvdMLH63680kE8K2G0UNLIwfUNKw0byKFc5HdiblWUYHax4lL10pA0vhRxj6TwNIwpPV0heekcHo8zaXiwiOW6YlYC7F3X3tjcMHDyVUhrz68t5fLYWUwFiEXBYwuONlzskjS36yb10a+GxsZzvg34lxGgJEgfH9wzkmWv+1BwvSsZz8ibujDFOAKEO1BmShIqcoZGlswXAEe5OpZ0chm4rPGOc0ywHh+9gV3DDyZ50UUSdxjemV5WXk73u7+eVLUkoiwQQC4DjtnlJuG1eUlgcGAoOyohZSysJB5eNIE+PLfSg+mJ2g1ikzUktSKSzhSTcbIZIEkrCAcQC4LBM8BbKhBWcHv7QvloGERy+ww1656J3oRbVS2wyjg0e3DHauNIyctLrhUuB93yOLKF4aMgWYzI4hgySsOl/IkczNoCsXdnGO2AcV6dqnRHWDSAmg2PxdYn46Y8jZ3EyHByU/nN/UUVa3XyMWN5E4NBSt+VSZUTCWa4so6g9epCJ4KBZrHdHyUFrCjhWb2okO/ayv8toZwDVO6j+EStlpCzjGwoQE8ExfZIDjy3rHpOjMw1NAQdPg1j7Yk7N8aBkvH7KqVWBp/UlWLQAtYaaz0OJy9PmQfumGRJotB/q+BQLhcbX4BG2Sgs4LsqV8YfHoiflMU1y6CE9qP7xj9va0DrA2gDp/62ItCIJ305nd9eg0X1olB81RYnUMFVy0MF5hoJqJw7N4VZwi8eycdCpxKAujDUjAqAnLdZCU39lnVAOjkg3sOHmYark0CtdKI1NSt0mm7KtJUFobtkJGx1IqBWCGa+P/JTdwjtlrQOJNcp8ZdUmATQVHLxCQYVDPQ3XcHKOB/QG1wqFAuKyN+0djKSxzfbf5wLdCrUWGu568jrl8TmmTXDg13f2fEKxxGlFD50jHJFLJvjxzx94uT0O0sLI9EIJo//PDltIpM2vr/Xi3ETtl4dqthSbLOCDdRmqhIGqyloIE6nN8280kW0fsfuyKJkTzUD99Wwfqi8yVorQENTDP7Yh96AcNph9WwoBfU1PQ3WrLVSppVkUaDYnJWXpDUlYNDv8BVuk9qaBY8nDNaSk0lhmUXfKM1d60ZCjvy6SfkYMJvGjor+nEowc8GOPqjd5yZUCxm1ywOZSxr5/uciGF/6r56xMllJIefmxKPlqQuvQCMjnJvpRcxFNW66lh8htaE5YmoJcTW5YCpBT13oU6R+ZX0rI22FTnLUp0Slgx8vqtpP21SmDHl/6Yec+F3nudb7ZmrRM0eckqMgPBEFCjWf0hZmWQmNz0bz0NFh9coWyk0PoOJ4kgtKxflCg0LcqnQsN60ST8Az5VEZasbr+lST6s9S2wsuxWgsjI7Whp4fmrAAaswhcAwLBBD+udAKfnQSfI1LgiAEhqFTaWoVgcFjKKBrRL6Vc5JogJyAReJMQTBdibxGCf1oS8Mya4sTDP0/VLAA0N2RhzIIHqkltg/77PsscY72tVj2j87pNAYeZ+kasM13J/MOFcFLSLrSO4eB4e1crWftWs5a5xtsooEBqsoh3no+c1E9BFx1VDAfHwy/Wk4PH2O8U1Cyyr9RNThSw7UVtJxNLHGXnLq8irS5tp4K+wmQt60xJEvDuC/yAQedguOSI6xtaWN9zm/79RGxZxWcrMU0h5ZnKiz+JY7PHzAESNj8T+QU5y6oMlRz3/LaOnPgn+wMXlgX3prZjLrbh+YfUm8WV0sBQcFyzrJL4GK9TRBGgOcnOlPigwF1EKR1iqh59l7HwmkQsuzGyWwGPBRkKDq36RtZACRPzbbj/1q7WvkUPVZPK2r5lTEtMELDjJb6KZyQgWRIcSQkCxubZMSHfhvkzuuc77byYpzc0kt0H+Lk58Pji9OpjXJ4Nq0LSXug1luGnletXVJP6pu5fOnWwGTXChgn59ohOvdGIEKnvaO1i4Xeehi016zVUctCJ0XejpZV+pKWKGJ9nx70hqaPUTD607votzWTrHhc83t5hR6G6Bb08W/kz7ZdnLPQ0HBwsk1XalmaG2rnfDV7e/ErH5Vlv/Cg7nnsgzVT+mDo4T2KG6+uJdQ1kf0EbWE9Ies+zvX8qKaaMseOp5eaComM+Ri3czHFe29pMdu5zI5y+Y+a82semCvjMy51YsaR70DYz56dIckRLkptns+HkkO/jVpi5oGhj/+r5elJw0guvz1y9hEoJasRa80v9jFjRaBHt9x7BEQ0UoZ1PtNtxxAqpKqKt+rvf6bZz6LgHrjZjgJKSKGDcKDsmXWrHddMSFH2YCpeiS7WIExTOFmoyQA6SJFT2FCRNl2Wwd/ru31vJyTM+nDzrRVGZn9n6KkvA0EwZw4dIGJkj4+Y56twC2FfE3kN4cDDGjRgoiqjWGHCNfUl8e6CPoStr/aCW2M4Sxu8H3B6C1CQB/ZLF4F9qsoD5M3s22vGdnb69dQMHj0zJdMpTHA4czDYpbLS+NOszvXcBx5yKSrLTxdELjVNMzz7DDYsttKvkYNxOQtd2md2OozGkoFqMN6ZPR1dwBFcXlx6mM1nrBDrAMbWsnOxvY48X0W0icXBo5Y3p7TrAkXuuhBT5tIcDiLiSODhMZ7LWCXSAI7GwiLRqsmxEGToODq28Mb1dBziyi8+RMnp4513i4OBNUcP66wDHhNIy8g+PDs5GcXAYxkzeA8VPK7wp2ov60xUcgyUJpTF4z9KL+Mu0lC7guLSklHzh5ehXEt9SmJhjduPuF2+crKRxqWE2a9nH1+VWlsbT9cWlBjt3TO4hLDhmlVeQD93afEFoxKpAHBgms5XP8D2/RlK5xSQLAprNTP/NhybxXr6jQNSnajSPWUEU+0dcWvROPEUFR+dlTysvJ2U+PxoIQaYo4niMPCrunazTf1X/D20VpNem6I/zAAAAAElFTkSuQmCC"},673:function(module,exports,__webpack_require__){__webpack_require__(674),__webpack_require__(845),__webpack_require__(846),__webpack_require__(1e3),__webpack_require__(1217),__webpack_require__(1249),__webpack_require__(1254),__webpack_require__(1266),__webpack_require__(1268),__webpack_require__(1273),__webpack_require__(1275),module.exports=__webpack_require__(1277)},748:function(module,exports){},846:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(317)}},[[673,1,2]]]);
//# sourceMappingURL=main.975b8d31312aa7a80ea9.bundle.js.map